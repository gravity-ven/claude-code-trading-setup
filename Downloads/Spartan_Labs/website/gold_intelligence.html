<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Cache Prevention -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0, post-check=0, pre-check=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-control" content="max-age=0">
    <meta name="last-modified" content="2025-11-18 00:00:00">
    <meta name="build-version" content="v1.0-GOLD-INTELLIGENCE">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spartan Research Station - Gold Intelligence Dashboard</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Spartan Theme -->
    <style>
        :root {
            /* Spartan Color Palette */
            --primary-color: #8B0000;        /* Spartan Red */
            --secondary-color: #B22222;      /* Spartan Firebrick */
            --accent-color: #DC143C;         /* Spartan Crimson */
            --accent-2-color: #FF5252;       /* Bright Red */
            --accent-3-color: #FF6B6B;       /* Light Red */
            --gold-color: #FFD700;           /* Gold */
            --silver-color: #C0C0C0;         /* Silver */
            --platinum-color: #E5E4E2;       /* Platinum */
            --bg-dark: #0a1628;              /* Main Background */
            --bg-darker: #050b14;            /* Darker Background */
            --bg-card: #12203a;              /* Card Background */
            --text-primary: #ffffff;         /* White Text */
            --text-secondary: #b0b8c8;       /* Gray Text */
            --text-muted: #7a8a9a;           /* Muted Gray */
            --border-color: #1e3a5f;         /* Border Color */
            --success-color: #00ff88;        /* Success Green */
            --warning-color: #ff9500;        /* Warning Orange */
            --danger-color: #FF5252;         /* Danger Red */
            --info-color: #0096FF;           /* Info Blue */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1700px;
            margin: 0 auto;
        }

        /* Spartan Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--bg-darker));
            border-radius: 12px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-2-color), var(--accent-color));
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        .header h1 {
            color: var(--gold-color);
            font-size: 2.8rem;
            margin: 0 0 10px 0;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.2rem;
            margin: 0 0 20px 0;
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        .back-btn {
            display: inline-block;
            padding: 12px 30px;
            background: var(--accent-color);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 10px;
        }

        .back-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 20, 60, 0.4);
        }

        /* Hero Section - Gold Price */
        .hero-section {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-darker));
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 40px;
            border: 2px solid var(--gold-color);
            box-shadow: 0 10px 40px rgba(255, 215, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .hero-section::before {
            content: 'ü•á';
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 6rem;
            opacity: 0.1;
        }

        .hero-section h2 {
            color: var(--gold-color);
            font-size: 2rem;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .price-display {
            font-size: 4rem;
            font-weight: 800;
            color: var(--gold-color);
            margin: 20px 0;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .change-indicators {
            display: flex;
            gap: 30px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .change-item {
            flex: 1;
            min-width: 200px;
            padding: 20px;
            background: rgba(255, 215, 0, 0.05);
            border-radius: 10px;
            border-left: 4px solid var(--gold-color);
        }

        .change-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .change-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-top: 5px;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-2-color));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .metric-card:hover::before {
            opacity: 1;
        }

        .metric-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(139, 0, 0, 0.15);
            border-color: var(--accent-color);
        }

        .metric-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .metric-title {
            font-size: 1.1rem;
            color: var(--accent-color);
            margin: 0 0 15px 0;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metric-value {
            font-size: 2.2rem;
            font-weight: 800;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .metric-value.positive {
            color: var(--success-color);
        }

        .metric-value.negative {
            color: var(--danger-color);
        }

        .metric-value.neutral {
            color: var(--text-primary);
        }

        .metric-change {
            font-size: 1rem;
            margin: 8px 0;
            font-weight: 500;
        }

        .metric-subtext {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 10px;
        }

        /* Charts Container */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(650px, 1fr));
            gap: 35px;
            margin-bottom: 40px;
        }

        .chart-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .chart-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, transparent 50%, var(--accent-color) 50%);
            border-radius: 0 12px 0 12px;
            opacity: 0.8;
        }

        .chart-title {
            font-size: 1.6rem;
            color: var(--accent-color);
            margin: 0 0 25px 0;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        /* Section Styles */
        .section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 35px;
            margin-bottom: 35px;
            border: 1px solid var(--border-color);
        }

        .section h2 {
            color: var(--accent-color);
            font-size: 1.8rem;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
        }

        /* Metals Grid */
        .metals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metal-card {
            background: rgba(139, 0, 0, 0.08);
            border-radius: 10px;
            padding: 25px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
        }

        .metal-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(139, 0, 0, 0.2);
        }

        .metal-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metal-price {
            font-size: 2rem;
            font-weight: 800;
            margin: 10px 0;
        }

        .metal-change {
            font-size: 1rem;
            font-weight: 600;
        }

        /* Ratio Display */
        .ratio-display {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 20px;
        }

        .ratio-item {
            background: rgba(220, 20, 60, 0.08);
            padding: 20px 30px;
            border-radius: 10px;
            border-left: 4px solid var(--accent-color);
            flex: 1;
            min-width: 200px;
        }

        .ratio-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .ratio-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--gold-color);
        }

        .ratio-status {
            font-size: 0.85rem;
            margin-top: 8px;
            font-weight: 600;
        }

        /* Technical Analysis Grid */
        .technicals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .technical-item {
            background: rgba(139, 0, 0, 0.08);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--border-color);
        }

        .technical-label {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .technical-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        /* Signal Indicator */
        .signal-indicator {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1.3rem;
            margin: 15px 0;
        }

        .signal-indicator.buy {
            background: rgba(0, 255, 136, 0.15);
            color: var(--success-color);
            border: 2px solid var(--success-color);
        }

        .signal-indicator.sell {
            background: rgba(255, 82, 82, 0.15);
            color: var(--danger-color);
            border: 2px solid var(--danger-color);
        }

        .signal-indicator.hold {
            background: rgba(255, 149, 0, 0.15);
            color: var(--warning-color);
            border: 2px solid var(--warning-color);
        }

        /* Signal Factors */
        .signal-factors {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .factor-item {
            background: rgba(139, 0, 0, 0.08);
            padding: 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .factor-name {
            color: var(--text-secondary);
            font-weight: 600;
        }

        .factor-signal {
            font-weight: 700;
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .factor-signal.bullish {
            background: rgba(0, 255, 136, 0.2);
            color: var(--success-color);
        }

        .factor-signal.bearish {
            background: rgba(255, 82, 82, 0.2);
            color: var(--danger-color);
        }

        .factor-signal.neutral {
            background: rgba(255, 149, 0, 0.2);
            color: var(--warning-color);
        }

        /* Currency Correlation */
        .currency-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .currency-item {
            background: rgba(139, 0, 0, 0.08);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .currency-pair {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 10px;
        }

        .correlation-value {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 10px 0;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--gold-color);
            border-radius: 50%;
            animation: spartan-spin 1s linear infinite;
        }

        @keyframes spartan-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Status Messages */
        .status-message {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: 600;
            text-align: center;
        }

        .status-message.success {
            background: rgba(0, 255, 136, 0.15);
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }

        .status-message.error {
            background: rgba(255, 82, 82, 0.15);
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
        }

        .status-message.info {
            background: rgba(0, 150, 255, 0.15);
            color: var(--info-color);
            border: 1px solid var(--info-color);
        }

        /* Last Updated */
        .last-updated {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 30px;
            padding: 15px;
            background: rgba(139, 0, 0, 0.05);
            border-radius: 8px;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .price-display {
                font-size: 3rem;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .metals-grid {
                grid-template-columns: 1fr;
            }

            .change-indicators {
                flex-direction: column;
            }
        }

        /* Data Quality Badge */
        .data-quality-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .data-quality-badge.live {
            background: rgba(0, 255, 136, 0.2);
            color: var(--success-color);
        }

        .data-quality-badge.delayed {
            background: rgba(255, 149, 0, 0.2);
            color: var(--warning-color);
        }

        /* Info Panel */
        .info-panel {
            background: rgba(0, 150, 255, 0.08);
            border-left: 4px solid var(--info-color);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .info-panel h3 {
            color: var(--info-color);
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .info-panel p {
            color: var(--text-secondary);
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="header">
            <h1>ü•á Gold Intelligence Dashboard</h1>
            <p>Real-Time Precious Metals Market Intelligence</p>
            <span class="data-quality-badge live" id="dataQualityBadge">LIVE DATA</span>
            <br>
            <a href="intelligence_reports.html" class="back-btn">‚Üê Back to Market Intelligence</a>
        </div>

        <!-- Hero Section - Gold Price -->
        <div class="hero-section">
            <h2>Gold Spot Price (GC=F)</h2>
            <div class="price-display" id="goldPrice">
                <span class="loading"></span> Loading...
            </div>
            <div class="change-indicators" id="goldChangeIndicators">
                <div class="change-item">
                    <div class="change-label">Daily Change</div>
                    <div class="change-value" id="dailyChange">--</div>
                </div>
                <div class="change-item">
                    <div class="change-label">Weekly Change</div>
                    <div class="change-value" id="weeklyChange">--</div>
                </div>
                <div class="change-item">
                    <div class="change-label">Monthly Change</div>
                    <div class="change-value" id="monthlyChange">--</div>
                </div>
                <div class="change-item">
                    <div class="change-label">YTD Change</div>
                    <div class="change-value" id="ytdChange">--</div>
                </div>
            </div>
        </div>

        <!-- Precious Metals Complex -->
        <div class="section">
            <h2>üíé Precious Metals Complex</h2>
            <div class="metals-grid">
                <div class="metal-card" id="goldCard">
                    <div class="metric-icon">ü•á</div>
                    <div class="metal-name" style="color: var(--gold-color);">Gold</div>
                    <div class="metal-price" id="goldMetalPrice" style="color: var(--gold-color);">--</div>
                    <div class="metal-change" id="goldMetalChange">--</div>
                    <div class="metric-subtext">GC=F</div>
                </div>
                <div class="metal-card" id="silverCard">
                    <div class="metric-icon">ü•à</div>
                    <div class="metal-name" style="color: var(--silver-color);">Silver</div>
                    <div class="metal-price" id="silverPrice" style="color: var(--silver-color);">--</div>
                    <div class="metal-change" id="silverChange">--</div>
                    <div class="metric-subtext">SI=F</div>
                </div>
                <div class="metal-card" id="platinumCard">
                    <div class="metric-icon">‚ö™</div>
                    <div class="metal-name" style="color: var(--platinum-color);">Platinum</div>
                    <div class="metal-price" id="platinumPrice" style="color: var(--platinum-color);">--</div>
                    <div class="metal-change" id="platinumChange">--</div>
                    <div class="metric-subtext">PL=F</div>
                </div>
                <div class="metal-card" id="palladiumCard">
                    <div class="metric-icon">üîò</div>
                    <div class="metal-name" style="color: #E8E8E8;">Palladium</div>
                    <div class="metal-price" id="palladiumPrice" style="color: #E8E8E8;">--</div>
                    <div class="metal-change" id="palladiumChange">--</div>
                    <div class="metric-subtext">PA=F</div>
                </div>
            </div>
        </div>

        <!-- Key Ratios -->
        <div class="section">
            <h2>üìä Key Precious Metals Ratios</h2>
            <div class="ratio-display">
                <div class="ratio-item">
                    <div class="ratio-label">Gold/Silver Ratio</div>
                    <div class="ratio-value" id="goldSilverRatioValue">--</div>
                    <div class="ratio-status" id="goldSilverRatioStatus">--</div>
                </div>
                <div class="ratio-item">
                    <div class="ratio-label">Gold/Platinum Ratio</div>
                    <div class="ratio-value" id="goldPlatinumRatioValue">--</div>
                    <div class="ratio-status" id="goldPlatinumRatioStatus">--</div>
                </div>
                <div class="ratio-item">
                    <div class="ratio-label">Platinum/Palladium Ratio</div>
                    <div class="ratio-value" id="platinumPalladiumRatioValue">--</div>
                    <div class="ratio-status" id="platinumPalladiumRatioStatus">--</div>
                </div>
            </div>

            <div class="info-panel">
                <h3>Understanding Gold/Silver Ratio</h3>
                <p>
                    <strong>Historical Average:</strong> ~60-70 |
                    <strong>Above 80:</strong> Silver undervalued vs Gold (Bullish Silver) |
                    <strong>Below 50:</strong> Gold undervalued vs Silver (Bullish Gold)
                </p>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="charts-container">
            <!-- Gold Price Chart -->
            <div class="chart-card">
                <h3 class="chart-title">üìà Gold Price - 1 Year</h3>
                <div class="chart-wrapper">
                    <canvas id="goldPriceChart"></canvas>
                </div>
            </div>

            <!-- Gold/Silver Ratio Chart -->
            <div class="chart-card">
                <h3 class="chart-title">üìä Gold/Silver Ratio - 1 Year</h3>
                <div class="chart-wrapper">
                    <canvas id="goldSilverRatioChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Gold Miners Analysis -->
        <div class="section">
            <h2>‚õèÔ∏è Gold Miners vs Gold</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon">‚õèÔ∏è</div>
                    <div class="metric-title">GDX - VanEck Gold Miners ETF</div>
                    <div class="metric-value neutral" id="gdxPrice">--</div>
                    <div class="metric-change" id="gdxChange">--</div>
                    <div class="metric-subtext">Large Cap Gold Miners</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">‚öíÔ∏è</div>
                    <div class="metric-title">GDXJ - Junior Gold Miners ETF</div>
                    <div class="metric-value neutral" id="gdxjPrice">--</div>
                    <div class="metric-change" id="gdxjChange">--</div>
                    <div class="metric-subtext">Small Cap Gold Miners</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">üìä</div>
                    <div class="metric-title">GDX/Gold Ratio</div>
                    <div class="metric-value neutral" id="gdxGoldRatio">--</div>
                    <div class="metric-change" id="gdxGoldRatioChange">--</div>
                    <div class="metric-subtext">Miner Sentiment Indicator</div>
                </div>
            </div>

            <div class="chart-card" style="margin-top: 25px;">
                <h3 class="chart-title">‚õèÔ∏è Gold Miners Performance - 1 Year</h3>
                <div class="chart-wrapper">
                    <canvas id="minersChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Real Rates Impact -->
        <div class="section">
            <h2>üíπ Real Rates & Gold Correlation</h2>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon">üìâ</div>
                    <div class="metric-title">10-Year TIPS Yield (Real Rate)</div>
                    <div class="metric-value neutral" id="realRateValue">--</div>
                    <div class="metric-change" id="realRateChange">--</div>
                    <div class="metric-subtext">FRED: DFII10</div>
                </div>
                <div class="metric-card">
                    <div class="metric-icon">üí∞</div>
                    <div class="metric-title">Real Rate Impact on Gold</div>
                    <div class="metric-value" id="realRateImpact">--</div>
                    <div class="metric-subtext" id="realRateImpactText">--</div>
                </div>
            </div>

            <div class="info-panel">
                <h3>Real Rates & Gold Relationship</h3>
                <p>
                    <strong>Negative Real Rates:</strong> Bullish for Gold (cost of holding gold is low) |
                    <strong>Positive Real Rates:</strong> Bearish for Gold (opportunity cost of holding gold increases) |
                    Gold typically performs best when real rates are negative or falling.
                </p>
            </div>

            <div class="chart-card" style="margin-top: 25px;">
                <h3 class="chart-title">üíπ Real Rates vs Gold - 1 Year</h3>
                <div class="chart-wrapper">
                    <canvas id="realRatesChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Currency Correlation -->
        <div class="section">
            <h2>üí± Currency Correlation with Gold</h2>
            <div class="currency-grid">
                <div class="currency-item">
                    <div class="currency-pair">USD Index</div>
                    <div class="correlation-value" id="usdPrice">--</div>
                    <div class="metal-change" id="usdChange">--</div>
                    <div class="metric-subtext">DX-Y.NYB</div>
                </div>
                <div class="currency-item">
                    <div class="currency-pair">EUR/USD</div>
                    <div class="correlation-value" id="eurPrice">--</div>
                    <div class="metal-change" id="eurChange">--</div>
                    <div class="metric-subtext">EURUSD=X</div>
                </div>
                <div class="currency-item">
                    <div class="currency-pair">JPY/USD</div>
                    <div class="correlation-value" id="jpyPrice">--</div>
                    <div class="metal-change" id="jpyChange">--</div>
                    <div class="metric-subtext">JPYUSD=X</div>
                </div>
            </div>

            <div class="info-panel">
                <h3>Gold & Currency Correlation</h3>
                <p>
                    Gold typically has an <strong>inverse correlation</strong> with the US Dollar.
                    When USD strengthens, gold tends to weaken (and vice versa).
                    Gold is also positively correlated with EUR and inversely correlated with real interest rates.
                </p>
            </div>
        </div>

        <!-- Technical Analysis -->
        <div class="section">
            <h2>üìà Technical Analysis</h2>
            <div class="technicals-grid">
                <div class="technical-item">
                    <div class="technical-label">50-Day MA</div>
                    <div class="technical-value neutral" id="ma50">--</div>
                </div>
                <div class="technical-item">
                    <div class="technical-label">200-Day MA</div>
                    <div class="technical-value neutral" id="ma200">--</div>
                </div>
                <div class="technical-item">
                    <div class="technical-label">RSI (14)</div>
                    <div class="technical-value neutral" id="rsi">--</div>
                </div>
                <div class="technical-item">
                    <div class="technical-label">52-Week High</div>
                    <div class="technical-value neutral" id="week52High">--</div>
                </div>
                <div class="technical-item">
                    <div class="technical-label">52-Week Low</div>
                    <div class="technical-value neutral" id="week52Low">--</div>
                </div>
                <div class="technical-item">
                    <div class="technical-label">ATR (14)</div>
                    <div class="technical-value neutral" id="atr">--</div>
                </div>
            </div>
        </div>

        <!-- Trading Signals -->
        <div class="section">
            <h2>‚ö° Trading Signals</h2>
            <div class="signal-indicator" id="overallSignal">
                <span class="loading"></span> Calculating...
            </div>

            <div class="signal-factors">
                <div class="factor-item">
                    <span class="factor-name">Technical Trend</span>
                    <span class="factor-signal neutral" id="signalTrend">--</span>
                </div>
                <div class="factor-item">
                    <span class="factor-name">RSI Signal</span>
                    <span class="factor-signal neutral" id="signalRsi">--</span>
                </div>
                <div class="factor-item">
                    <span class="factor-name">Real Rates</span>
                    <span class="factor-signal neutral" id="signalRealRates">--</span>
                </div>
                <div class="factor-item">
                    <span class="factor-name">USD Strength</span>
                    <span class="factor-signal neutral" id="signalUsd">--</span>
                </div>
                <div class="factor-item">
                    <span class="factor-name">Gold/Silver Ratio</span>
                    <span class="factor-signal neutral" id="signalGoldSilver">--</span>
                </div>
                <div class="factor-item">
                    <span class="factor-name">Miners Sentiment</span>
                    <span class="factor-signal neutral" id="signalMiners">--</span>
                </div>
            </div>

            <div class="info-panel" style="margin-top: 25px;">
                <h3>Signal Methodology</h3>
                <p>
                    Trading signals are generated by analyzing multiple factors:
                    <strong>Technical indicators</strong> (moving averages, RSI),
                    <strong>Real interest rates</strong> (negative = bullish),
                    <strong>USD strength</strong> (inverse correlation),
                    <strong>Gold/Silver ratio</strong> (extreme readings), and
                    <strong>Miner/Gold ratio</strong> (sentiment indicator).
                    Signals are for informational purposes only - not investment advice.
                </p>
            </div>
        </div>

        <!-- Last Updated -->
        <div class="last-updated" id="lastUpdated">
            Last Updated: --
        </div>
    </div>

    <script>
        // Configuration
        const FRED_API_KEY = '0a08e7a69f8dbd1b02e19e7af5a82b61';
        const REFRESH_INTERVAL = 120000; // 120 seconds

        // Global data storage
        let goldData = null;
        let metalsPrices = {};
        let minersPrices = {};
        let currencyPrices = {};
        let realRateData = null;
        let historicalData = {};

        // Chart instances
        let goldPriceChart = null;
        let goldSilverRatioChart = null;
        let minersChart = null;
        let realRatesChart = null;

        // Utility Functions
        function formatPrice(price, decimals = 2) {
            if (!price || isNaN(price)) return '--';
            return '$' + parseFloat(price).toFixed(decimals);
        }

        function formatChange(change, percent = null) {
            if (!change || isNaN(change)) return '--';
            const sign = change >= 0 ? '+' : '';
            const changeStr = sign + change.toFixed(2);
            if (percent !== null && !isNaN(percent)) {
                return `${changeStr} (${sign}${percent.toFixed(2)}%)`;
            }
            return changeStr;
        }

        function getChangeClass(value) {
            if (!value || isNaN(value)) return 'neutral';
            return value >= 0 ? 'positive' : 'negative';
        }

        function formatDate(timestamp) {
            return new Date(timestamp * 1000).toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
        }

        // Yahoo Finance API Functions
        async function fetchYahooData(symbol) {
            try {
                const url = `http://localhost:5002/api/yahoo/chart/${symbol}?range=1y&interval=1d`;
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (!data.chart || !data.chart.result || data.chart.result.length === 0) {
                    throw new Error('No data returned from Yahoo Finance');
                }

                const result = data.chart.result[0];
                return {
                    meta: result.meta,
                    timestamps: result.timestamp,
                    prices: result.indicators.quote[0],
                    success: true
                };
            } catch (error) {
                console.error(`Error fetching ${symbol}:`, error);
                return { success: false, error: error.message };
            }
        }

        // FRED API Function
        async function fetchFREDData(seriesId) {
            try {
                const url = `http://localhost:5002/api/fred/series/observations?series_id=${seriesId}&api_key=${FRED_API_KEY}&file_type=json&limit=365&sort_order=desc`;
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (!data.observations || data.observations.length === 0) {
                    throw new Error('No data returned from FRED');
                }

                return {
                    observations: data.observations.reverse(),
                    success: true
                };
            } catch (error) {
                console.error(`Error fetching FRED ${seriesId}:`, error);
                return { success: false, error: error.message };
            }
        }

        // Calculate Technical Indicators
        function calculateSMA(prices, period) {
            if (!prices || prices.length < period) return null;
            const slice = prices.slice(-period);
            const sum = slice.reduce((a, b) => a + b, 0);
            return sum / period;
        }

        function calculateRSI(prices, period = 14) {
            if (!prices || prices.length < period + 1) return null;

            let gains = 0;
            let losses = 0;

            for (let i = prices.length - period; i < prices.length; i++) {
                const change = prices[i] - prices[i - 1];
                if (change > 0) {
                    gains += change;
                } else {
                    losses += Math.abs(change);
                }
            }

            const avgGain = gains / period;
            const avgLoss = losses / period;

            if (avgLoss === 0) return 100;

            const rs = avgGain / avgLoss;
            const rsi = 100 - (100 / (1 + rs));

            return rsi;
        }

        function calculateATR(high, low, close, period = 14) {
            if (!high || !low || !close || high.length < period + 1) return null;

            const trueRanges = [];
            for (let i = 1; i < high.length; i++) {
                const tr1 = high[i] - low[i];
                const tr2 = Math.abs(high[i] - close[i - 1]);
                const tr3 = Math.abs(low[i] - close[i - 1]);
                trueRanges.push(Math.max(tr1, tr2, tr3));
            }

            const recentTR = trueRanges.slice(-period);
            return recentTR.reduce((a, b) => a + b, 0) / period;
        }

        // Data Processing Functions
        async function loadAllData() {
            try {
                updateStatus('Loading data...', 'info');

                // Fetch all data in parallel
                const [gold, silver, platinum, palladium, gdx, gdxj, usd, eur, jpy, realRate] = await Promise.all([
                    fetchYahooData('GC=F'),
                    fetchYahooData('SI=F'),
                    fetchYahooData('PL=F'),
                    fetchYahooData('PA=F'),
                    fetchYahooData('GDX'),
                    fetchYahooData('GDXJ'),
                    fetchYahooData('DX-Y.NYB'),
                    fetchYahooData('EURUSD=X'),
                    fetchYahooData('JPYUSD=X'),
                    fetchFREDData('DFII10')
                ]);

                // Store data
                if (gold.success) {
                    goldData = gold;
                    historicalData.gold = gold;
                }
                if (silver.success) metalsPrices.silver = silver;
                if (platinum.success) metalsPrices.platinum = platinum;
                if (palladium.success) metalsPrices.palladium = palladium;
                if (gdx.success) minersPrices.gdx = gdx;
                if (gdxj.success) minersPrices.gdxj = gdxj;
                if (usd.success) currencyPrices.usd = usd;
                if (eur.success) currencyPrices.eur = eur;
                if (jpy.success) currencyPrices.jpy = jpy;
                if (realRate.success) realRateData = realRate;

                // Update all displays
                updateGoldPrice();
                updateMetalsComplex();
                updateRatios();
                updateMiners();
                updateCurrencies();
                updateRealRates();
                updateTechnicals();
                updateSignals();

                // Create charts
                createGoldPriceChart();
                createGoldSilverRatioChart();
                createMinersChart();
                createRealRatesChart();

                // Update last updated time
                updateLastUpdated();

                updateStatus('Data loaded successfully', 'success');

            } catch (error) {
                console.error('Error loading data:', error);
                updateStatus('Error loading data: ' + error.message, 'error');
            }
        }

        function updateStatus(message, type = 'info') {
            const badge = document.getElementById('dataQualityBadge');
            if (type === 'success') {
                badge.textContent = 'LIVE DATA';
                badge.className = 'data-quality-badge live';
            } else if (type === 'error') {
                badge.textContent = 'ERROR';
                badge.className = 'data-quality-badge delayed';
            }
        }

        function updateGoldPrice() {
            if (!goldData || !goldData.success) return;

            const currentPrice = goldData.meta.regularMarketPrice;
            const previousClose = goldData.meta.previousClose;
            const change = currentPrice - previousClose;
            const changePercent = (change / previousClose) * 100;

            // Update main price display
            document.getElementById('goldPrice').innerHTML = formatPrice(currentPrice, 2);

            // Calculate period changes
            const closes = goldData.prices.close.filter(p => p !== null);

            // Daily change (already calculated)
            const dailyChangeEl = document.getElementById('dailyChange');
            dailyChangeEl.textContent = formatChange(change, changePercent);
            dailyChangeEl.className = 'change-value ' + getChangeClass(change);

            // Weekly change (5 trading days ago)
            if (closes.length >= 5) {
                const weekAgo = closes[closes.length - 6];
                const weekChange = currentPrice - weekAgo;
                const weekChangePercent = (weekChange / weekAgo) * 100;
                const weeklyChangeEl = document.getElementById('weeklyChange');
                weeklyChangeEl.textContent = formatChange(weekChange, weekChangePercent);
                weeklyChangeEl.className = 'change-value ' + getChangeClass(weekChange);
            }

            // Monthly change (20 trading days ago)
            if (closes.length >= 20) {
                const monthAgo = closes[closes.length - 21];
                const monthChange = currentPrice - monthAgo;
                const monthChangePercent = (monthChange / monthAgo) * 100;
                const monthlyChangeEl = document.getElementById('monthlyChange');
                monthlyChangeEl.textContent = formatChange(monthChange, monthChangePercent);
                monthlyChangeEl.className = 'change-value ' + getChangeClass(monthChange);
            }

            // YTD change (first price of the year)
            const ytdPrice = closes[0];
            const ytdChange = currentPrice - ytdPrice;
            const ytdChangePercent = (ytdChange / ytdPrice) * 100;
            const ytdChangeEl = document.getElementById('ytdChange');
            ytdChangeEl.textContent = formatChange(ytdChange, ytdChangePercent);
            ytdChangeEl.className = 'change-value ' + getChangeClass(ytdChange);
        }

        function updateMetalsComplex() {
            // Update Gold in metals grid
            if (goldData && goldData.success) {
                const currentPrice = goldData.meta.regularMarketPrice;
                const change = currentPrice - goldData.meta.previousClose;
                const changePercent = (change / goldData.meta.previousClose) * 100;

                document.getElementById('goldMetalPrice').textContent = formatPrice(currentPrice, 2);
                const goldChangeEl = document.getElementById('goldMetalChange');
                goldChangeEl.textContent = formatChange(change, changePercent);
                goldChangeEl.className = 'metal-change ' + getChangeClass(change);
            }

            // Update Silver
            if (metalsPrices.silver && metalsPrices.silver.success) {
                const currentPrice = metalsPrices.silver.meta.regularMarketPrice;
                const change = currentPrice - metalsPrices.silver.meta.previousClose;
                const changePercent = (change / metalsPrices.silver.meta.previousClose) * 100;

                document.getElementById('silverPrice').textContent = formatPrice(currentPrice, 2);
                const silverChangeEl = document.getElementById('silverChange');
                silverChangeEl.textContent = formatChange(change, changePercent);
                silverChangeEl.className = 'metal-change ' + getChangeClass(change);
            }

            // Update Platinum
            if (metalsPrices.platinum && metalsPrices.platinum.success) {
                const currentPrice = metalsPrices.platinum.meta.regularMarketPrice;
                const change = currentPrice - metalsPrices.platinum.meta.previousClose;
                const changePercent = (change / metalsPrices.platinum.meta.previousClose) * 100;

                document.getElementById('platinumPrice').textContent = formatPrice(currentPrice, 2);
                const platinumChangeEl = document.getElementById('platinumChange');
                platinumChangeEl.textContent = formatChange(change, changePercent);
                platinumChangeEl.className = 'metal-change ' + getChangeClass(change);
            }

            // Update Palladium
            if (metalsPrices.palladium && metalsPrices.palladium.success) {
                const currentPrice = metalsPrices.palladium.meta.regularMarketPrice;
                const change = currentPrice - metalsPrices.palladium.meta.previousClose;
                const changePercent = (change / metalsPrices.palladium.meta.previousClose) * 100;

                document.getElementById('palladiumPrice').textContent = formatPrice(currentPrice, 2);
                const palladiumChangeEl = document.getElementById('palladiumChange');
                palladiumChangeEl.textContent = formatChange(change, changePercent);
                palladiumChangeEl.className = 'metal-change ' + getChangeClass(change);
            }
        }

        function updateRatios() {
            // Gold/Silver Ratio
            if (goldData && goldData.success && metalsPrices.silver && metalsPrices.silver.success) {
                const goldPrice = goldData.meta.regularMarketPrice;
                const silverPrice = metalsPrices.silver.meta.regularMarketPrice;
                const ratio = goldPrice / silverPrice;

                document.getElementById('goldSilverRatioValue').textContent = ratio.toFixed(2);

                let status = '';
                if (ratio > 80) {
                    status = 'Silver Undervalued (Bullish Silver)';
                    document.getElementById('goldSilverRatioStatus').style.color = 'var(--success-color)';
                } else if (ratio < 60) {
                    status = 'Gold Undervalued (Bullish Gold)';
                    document.getElementById('goldSilverRatioStatus').style.color = 'var(--gold-color)';
                } else {
                    status = 'Normal Range';
                    document.getElementById('goldSilverRatioStatus').style.color = 'var(--text-secondary)';
                }
                document.getElementById('goldSilverRatioStatus').textContent = status;
            }

            // Gold/Platinum Ratio
            if (goldData && goldData.success && metalsPrices.platinum && metalsPrices.platinum.success) {
                const goldPrice = goldData.meta.regularMarketPrice;
                const platinumPrice = metalsPrices.platinum.meta.regularMarketPrice;
                const ratio = goldPrice / platinumPrice;

                document.getElementById('goldPlatinumRatioValue').textContent = ratio.toFixed(2);

                let status = '';
                if (ratio > 1.2) {
                    status = 'Platinum Undervalued';
                    document.getElementById('goldPlatinumRatioStatus').style.color = 'var(--success-color)';
                } else if (ratio < 0.8) {
                    status = 'Gold Undervalued';
                    document.getElementById('goldPlatinumRatioStatus').style.color = 'var(--gold-color)';
                } else {
                    status = 'Normal Range';
                    document.getElementById('goldPlatinumRatioStatus').style.color = 'var(--text-secondary)';
                }
                document.getElementById('goldPlatinumRatioStatus').textContent = status;
            }

            // Platinum/Palladium Ratio
            if (metalsPrices.platinum && metalsPrices.platinum.success &&
                metalsPrices.palladium && metalsPrices.palladium.success) {
                const platinumPrice = metalsPrices.platinum.meta.regularMarketPrice;
                const palladiumPrice = metalsPrices.palladium.meta.regularMarketPrice;
                const ratio = platinumPrice / palladiumPrice;

                document.getElementById('platinumPalladiumRatioValue').textContent = ratio.toFixed(2);
                document.getElementById('platinumPalladiumRatioStatus').textContent = 'Industrial Metals Spread';
                document.getElementById('platinumPalladiumRatioStatus').style.color = 'var(--text-secondary)';
            }
        }

        function updateMiners() {
            // GDX
            if (minersPrices.gdx && minersPrices.gdx.success) {
                const currentPrice = minersPrices.gdx.meta.regularMarketPrice;
                const change = currentPrice - minersPrices.gdx.meta.previousClose;
                const changePercent = (change / minersPrices.gdx.meta.previousClose) * 100;

                document.getElementById('gdxPrice').textContent = formatPrice(currentPrice, 2);
                const gdxChangeEl = document.getElementById('gdxChange');
                gdxChangeEl.textContent = formatChange(change, changePercent);
                gdxChangeEl.className = 'metric-change ' + getChangeClass(change);
            }

            // GDXJ
            if (minersPrices.gdxj && minersPrices.gdxj.success) {
                const currentPrice = minersPrices.gdxj.meta.regularMarketPrice;
                const change = currentPrice - minersPrices.gdxj.meta.previousClose;
                const changePercent = (change / minersPrices.gdxj.meta.previousClose) * 100;

                document.getElementById('gdxjPrice').textContent = formatPrice(currentPrice, 2);
                const gdxjChangeEl = document.getElementById('gdxjChange');
                gdxjChangeEl.textContent = formatChange(change, changePercent);
                gdxjChangeEl.className = 'metric-change ' + getChangeClass(change);
            }

            // GDX/Gold Ratio
            if (goldData && goldData.success && minersPrices.gdx && minersPrices.gdx.success) {
                const goldPrice = goldData.meta.regularMarketPrice;
                const gdxPrice = minersPrices.gdx.meta.regularMarketPrice;
                const ratio = gdxPrice / (goldPrice / 100); // Normalize

                document.getElementById('gdxGoldRatio').textContent = ratio.toFixed(3);

                // Compare to previous ratio
                const goldPrevious = goldData.meta.previousClose;
                const gdxPrevious = minersPrices.gdx.meta.previousClose;
                const previousRatio = gdxPrevious / (goldPrevious / 100);
                const ratioChange = ((ratio - previousRatio) / previousRatio) * 100;

                const ratioChangeEl = document.getElementById('gdxGoldRatioChange');
                ratioChangeEl.textContent = (ratioChange >= 0 ? '+' : '') + ratioChange.toFixed(2) + '%';
                ratioChangeEl.className = 'metric-change ' + getChangeClass(ratioChange);
            }
        }

        function updateCurrencies() {
            // USD Index
            if (currencyPrices.usd && currencyPrices.usd.success) {
                const currentPrice = currencyPrices.usd.meta.regularMarketPrice;
                const change = currentPrice - currencyPrices.usd.meta.previousClose;
                const changePercent = (change / currencyPrices.usd.meta.previousClose) * 100;

                document.getElementById('usdPrice').textContent = currentPrice.toFixed(2);
                const usdChangeEl = document.getElementById('usdChange');
                usdChangeEl.textContent = formatChange(change, changePercent);
                usdChangeEl.className = 'metal-change ' + getChangeClass(change);
            }

            // EUR/USD
            if (currencyPrices.eur && currencyPrices.eur.success) {
                const currentPrice = currencyPrices.eur.meta.regularMarketPrice;
                const change = currentPrice - currencyPrices.eur.meta.previousClose;
                const changePercent = (change / currencyPrices.eur.meta.previousClose) * 100;

                document.getElementById('eurPrice').textContent = currentPrice.toFixed(4);
                const eurChangeEl = document.getElementById('eurChange');
                eurChangeEl.textContent = formatChange(change, changePercent);
                eurChangeEl.className = 'metal-change ' + getChangeClass(change);
            }

            // JPY/USD
            if (currencyPrices.jpy && currencyPrices.jpy.success) {
                const currentPrice = currencyPrices.jpy.meta.regularMarketPrice;
                const change = currentPrice - currencyPrices.jpy.meta.previousClose;
                const changePercent = (change / currencyPrices.jpy.meta.previousClose) * 100;

                document.getElementById('jpyPrice').textContent = currentPrice.toFixed(4);
                const jpyChangeEl = document.getElementById('jpyChange');
                jpyChangeEl.textContent = formatChange(change, changePercent);
                jpyChangeEl.className = 'metal-change ' + getChangeClass(change);
            }
        }

        function updateRealRates() {
            if (!realRateData || !realRateData.success) return;

            const observations = realRateData.observations;
            const latestObs = observations[observations.length - 1];
            const realRate = parseFloat(latestObs.value);

            document.getElementById('realRateValue').textContent = realRate.toFixed(2) + '%';

            // Calculate change if previous data exists
            if (observations.length >= 2) {
                const previousObs = observations[observations.length - 2];
                const previousRate = parseFloat(previousObs.value);
                const change = realRate - previousRate;

                const realRateChangeEl = document.getElementById('realRateChange');
                realRateChangeEl.textContent = (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
                realRateChangeEl.className = 'metric-change ' + getChangeClass(change);
            }

            // Real rate impact on gold
            const impactEl = document.getElementById('realRateImpact');
            const impactTextEl = document.getElementById('realRateImpactText');

            if (realRate < 0) {
                impactEl.textContent = 'BULLISH';
                impactEl.className = 'metric-value positive';
                impactTextEl.textContent = 'Negative real rates support gold prices';
            } else if (realRate > 2) {
                impactEl.textContent = 'BEARISH';
                impactEl.className = 'metric-value negative';
                impactTextEl.textContent = 'High real rates pressure gold prices';
            } else {
                impactEl.textContent = 'NEUTRAL';
                impactEl.className = 'metric-value neutral';
                impactTextEl.textContent = 'Moderate real rates, mixed impact';
            }
        }

        function updateTechnicals() {
            if (!goldData || !goldData.success) return;

            const closes = goldData.prices.close.filter(p => p !== null);
            const highs = goldData.prices.high.filter(p => p !== null);
            const lows = goldData.prices.low.filter(p => p !== null);

            // 50-day MA
            const ma50 = calculateSMA(closes, 50);
            if (ma50) {
                document.getElementById('ma50').textContent = formatPrice(ma50, 2);
            }

            // 200-day MA
            const ma200 = calculateSMA(closes, 200);
            if (ma200) {
                document.getElementById('ma200').textContent = formatPrice(ma200, 2);
            }

            // RSI
            const rsi = calculateRSI(closes);
            if (rsi) {
                const rsiEl = document.getElementById('rsi');
                rsiEl.textContent = rsi.toFixed(2);
                if (rsi > 70) {
                    rsiEl.className = 'technical-value negative';
                } else if (rsi < 30) {
                    rsiEl.className = 'technical-value positive';
                } else {
                    rsiEl.className = 'technical-value neutral';
                }
            }

            // 52-week high/low
            const week52High = Math.max(...highs);
            const week52Low = Math.min(...lows);
            document.getElementById('week52High').textContent = formatPrice(week52High, 2);
            document.getElementById('week52Low').textContent = formatPrice(week52Low, 2);

            // ATR
            const atr = calculateATR(highs, lows, closes);
            if (atr) {
                document.getElementById('atr').textContent = formatPrice(atr, 2);
            }
        }

        function updateSignals() {
            if (!goldData || !goldData.success) return;

            const closes = goldData.prices.close.filter(p => p !== null);
            const currentPrice = goldData.meta.regularMarketPrice;

            let bullishSignals = 0;
            let bearishSignals = 0;

            // 1. Technical Trend (MA50 vs MA200)
            const ma50 = calculateSMA(closes, 50);
            const ma200 = calculateSMA(closes, 200);
            if (ma50 && ma200) {
                if (ma50 > ma200 && currentPrice > ma50) {
                    document.getElementById('signalTrend').textContent = 'BULLISH';
                    document.getElementById('signalTrend').className = 'factor-signal bullish';
                    bullishSignals++;
                } else if (ma50 < ma200 && currentPrice < ma50) {
                    document.getElementById('signalTrend').textContent = 'BEARISH';
                    document.getElementById('signalTrend').className = 'factor-signal bearish';
                    bearishSignals++;
                } else {
                    document.getElementById('signalTrend').textContent = 'NEUTRAL';
                    document.getElementById('signalTrend').className = 'factor-signal neutral';
                }
            }

            // 2. RSI Signal
            const rsi = calculateRSI(closes);
            if (rsi) {
                if (rsi < 30) {
                    document.getElementById('signalRsi').textContent = 'BULLISH';
                    document.getElementById('signalRsi').className = 'factor-signal bullish';
                    bullishSignals++;
                } else if (rsi > 70) {
                    document.getElementById('signalRsi').textContent = 'BEARISH';
                    document.getElementById('signalRsi').className = 'factor-signal bearish';
                    bearishSignals++;
                } else {
                    document.getElementById('signalRsi').textContent = 'NEUTRAL';
                    document.getElementById('signalRsi').className = 'factor-signal neutral';
                }
            }

            // 3. Real Rates Signal
            if (realRateData && realRateData.success) {
                const latestRate = parseFloat(realRateData.observations[realRateData.observations.length - 1].value);
                if (latestRate < 0) {
                    document.getElementById('signalRealRates').textContent = 'BULLISH';
                    document.getElementById('signalRealRates').className = 'factor-signal bullish';
                    bullishSignals++;
                } else if (latestRate > 2) {
                    document.getElementById('signalRealRates').textContent = 'BEARISH';
                    document.getElementById('signalRealRates').className = 'factor-signal bearish';
                    bearishSignals++;
                } else {
                    document.getElementById('signalRealRates').textContent = 'NEUTRAL';
                    document.getElementById('signalRealRates').className = 'factor-signal neutral';
                }
            }

            // 4. USD Strength Signal (inverse correlation)
            if (currencyPrices.usd && currencyPrices.usd.success) {
                const usdChange = currencyPrices.usd.meta.regularMarketPrice - currencyPrices.usd.meta.previousClose;
                if (usdChange < -0.5) {
                    document.getElementById('signalUsd').textContent = 'BULLISH';
                    document.getElementById('signalUsd').className = 'factor-signal bullish';
                    bullishSignals++;
                } else if (usdChange > 0.5) {
                    document.getElementById('signalUsd').textContent = 'BEARISH';
                    document.getElementById('signalUsd').className = 'factor-signal bearish';
                    bearishSignals++;
                } else {
                    document.getElementById('signalUsd').textContent = 'NEUTRAL';
                    document.getElementById('signalUsd').className = 'factor-signal neutral';
                }
            }

            // 5. Gold/Silver Ratio Signal
            if (metalsPrices.silver && metalsPrices.silver.success) {
                const goldPrice = goldData.meta.regularMarketPrice;
                const silverPrice = metalsPrices.silver.meta.regularMarketPrice;
                const ratio = goldPrice / silverPrice;

                if (ratio > 85) {
                    document.getElementById('signalGoldSilver').textContent = 'BULLISH';
                    document.getElementById('signalGoldSilver').className = 'factor-signal bullish';
                    bullishSignals++;
                } else if (ratio < 60) {
                    document.getElementById('signalGoldSilver').textContent = 'BEARISH';
                    document.getElementById('signalGoldSilver').className = 'factor-signal bearish';
                    bearishSignals++;
                } else {
                    document.getElementById('signalGoldSilver').textContent = 'NEUTRAL';
                    document.getElementById('signalGoldSilver').className = 'factor-signal neutral';
                }
            }

            // 6. Miners Sentiment Signal
            if (minersPrices.gdx && minersPrices.gdx.success) {
                const gdxChange = ((minersPrices.gdx.meta.regularMarketPrice - minersPrices.gdx.meta.previousClose) /
                                  minersPrices.gdx.meta.previousClose) * 100;
                const goldChange = ((currentPrice - goldData.meta.previousClose) / goldData.meta.previousClose) * 100;

                // Miners outperforming = bullish sentiment
                if (gdxChange > goldChange + 1) {
                    document.getElementById('signalMiners').textContent = 'BULLISH';
                    document.getElementById('signalMiners').className = 'factor-signal bullish';
                    bullishSignals++;
                } else if (gdxChange < goldChange - 1) {
                    document.getElementById('signalMiners').textContent = 'BEARISH';
                    document.getElementById('signalMiners').className = 'factor-signal bearish';
                    bearishSignals++;
                } else {
                    document.getElementById('signalMiners').textContent = 'NEUTRAL';
                    document.getElementById('signalMiners').className = 'factor-signal neutral';
                }
            }

            // Overall Signal
            const overallSignalEl = document.getElementById('overallSignal');
            if (bullishSignals > bearishSignals + 1) {
                overallSignalEl.innerHTML = '<strong>üü¢ BUY SIGNAL</strong>';
                overallSignalEl.className = 'signal-indicator buy';
            } else if (bearishSignals > bullishSignals + 1) {
                overallSignalEl.innerHTML = '<strong>üî¥ SELL SIGNAL</strong>';
                overallSignalEl.className = 'signal-indicator sell';
            } else {
                overallSignalEl.innerHTML = '<strong>üü° HOLD SIGNAL</strong>';
                overallSignalEl.className = 'signal-indicator hold';
            }
        }

        function updateLastUpdated() {
            const now = new Date();
            document.getElementById('lastUpdated').textContent =
                `Last Updated: ${now.toLocaleString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                    second: '2-digit'
                })}`;
        }

        // Chart Creation Functions
        function createGoldPriceChart() {
            if (!goldData || !goldData.success) return;

            const ctx = document.getElementById('goldPriceChart');
            if (!ctx) return;

            const timestamps = goldData.timestamps;
            const closes = goldData.prices.close;

            const chartData = timestamps.map((ts, i) => ({
                x: new Date(ts * 1000),
                y: closes[i]
            })).filter(d => d.y !== null);

            if (goldPriceChart) {
                goldPriceChart.destroy();
            }

            goldPriceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Gold Price',
                        data: chartData,
                        borderColor: '#FFD700',
                        backgroundColor: 'rgba(255, 215, 0, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(18, 32, 58, 0.95)',
                            titleColor: '#FFD700',
                            bodyColor: '#ffffff',
                            borderColor: '#FFD700',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return 'Price: $' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'month'
                            },
                            grid: {
                                color: 'rgba(30, 58, 95, 0.3)'
                            },
                            ticks: {
                                color: '#b0b8c8'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(30, 58, 95, 0.3)'
                            },
                            ticks: {
                                color: '#b0b8c8',
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            }
                        }
                    }
                }
            });
        }

        function createGoldSilverRatioChart() {
            if (!goldData || !goldData.success || !metalsPrices.silver || !metalsPrices.silver.success) return;

            const ctx = document.getElementById('goldSilverRatioChart');
            if (!ctx) return;

            const goldTimestamps = goldData.timestamps;
            const goldCloses = goldData.prices.close;
            const silverCloses = metalsPrices.silver.prices.close;

            const chartData = goldTimestamps.map((ts, i) => {
                if (goldCloses[i] && silverCloses[i]) {
                    return {
                        x: new Date(ts * 1000),
                        y: goldCloses[i] / silverCloses[i]
                    };
                }
                return null;
            }).filter(d => d !== null);

            if (goldSilverRatioChart) {
                goldSilverRatioChart.destroy();
            }

            goldSilverRatioChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Gold/Silver Ratio',
                        data: chartData,
                        borderColor: '#DC143C',
                        backgroundColor: 'rgba(220, 20, 60, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(18, 32, 58, 0.95)',
                            titleColor: '#DC143C',
                            bodyColor: '#ffffff',
                            borderColor: '#DC143C',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return 'Ratio: ' + context.parsed.y.toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'month'
                            },
                            grid: {
                                color: 'rgba(30, 58, 95, 0.3)'
                            },
                            ticks: {
                                color: '#b0b8c8'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(30, 58, 95, 0.3)'
                            },
                            ticks: {
                                color: '#b0b8c8'
                            }
                        }
                    }
                }
            });
        }

        function createMinersChart() {
            if (!goldData || !goldData.success ||
                !minersPrices.gdx || !minersPrices.gdx.success ||
                !minersPrices.gdxj || !minersPrices.gdxj.success) return;

            const ctx = document.getElementById('minersChart');
            if (!ctx) return;

            const timestamps = goldData.timestamps;

            // Normalize all prices to percentage change from first value
            const normalizeData = (closes) => {
                const firstValue = closes.find(c => c !== null);
                return closes.map(c => c ? ((c - firstValue) / firstValue) * 100 : null);
            };

            const goldNorm = normalizeData(goldData.prices.close);
            const gdxNorm = normalizeData(minersPrices.gdx.prices.close);
            const gdxjNorm = normalizeData(minersPrices.gdxj.prices.close);

            if (minersChart) {
                minersChart.destroy();
            }

            minersChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: timestamps.map(ts => new Date(ts * 1000)),
                    datasets: [
                        {
                            label: 'Gold (GC=F)',
                            data: goldNorm,
                            borderColor: '#FFD700',
                            backgroundColor: 'rgba(255, 215, 0, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0
                        },
                        {
                            label: 'GDX',
                            data: gdxNorm,
                            borderColor: '#DC143C',
                            backgroundColor: 'rgba(220, 20, 60, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0
                        },
                        {
                            label: 'GDXJ',
                            data: gdxjNorm,
                            borderColor: '#FF5252',
                            backgroundColor: 'rgba(255, 82, 82, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: '#b0b8c8',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(18, 32, 58, 0.95)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#DC143C',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' +
                                           (context.parsed.y >= 0 ? '+' : '') +
                                           context.parsed.y.toFixed(2) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'month'
                            },
                            grid: {
                                color: 'rgba(30, 58, 95, 0.3)'
                            },
                            ticks: {
                                color: '#b0b8c8'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(30, 58, 95, 0.3)'
                            },
                            ticks: {
                                color: '#b0b8c8',
                                callback: function(value) {
                                    return (value >= 0 ? '+' : '') + value.toFixed(0) + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        function createRealRatesChart() {
            if (!goldData || !goldData.success || !realRateData || !realRateData.success) return;

            const ctx = document.getElementById('realRatesChart');
            if (!ctx) return;

            // Match FRED data timestamps to gold data
            const realRatesMap = new Map();
            realRateData.observations.forEach(obs => {
                const date = new Date(obs.date);
                realRatesMap.set(date.toDateString(), parseFloat(obs.value));
            });

            const chartData = goldData.timestamps.map((ts, i) => {
                const date = new Date(ts * 1000);
                const realRate = realRatesMap.get(date.toDateString());
                if (realRate !== undefined && goldData.prices.close[i] !== null) {
                    return {
                        x: date,
                        goldPrice: goldData.prices.close[i],
                        realRate: realRate
                    };
                }
                return null;
            }).filter(d => d !== null);

            if (realRatesChart) {
                realRatesChart.destroy();
            }

            realRatesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Gold Price',
                            data: chartData.map(d => ({ x: d.x, y: d.goldPrice })),
                            borderColor: '#FFD700',
                            backgroundColor: 'rgba(255, 215, 0, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Real Rate (%)',
                            data: chartData.map(d => ({ x: d.x, y: d.realRate })),
                            borderColor: '#DC143C',
                            backgroundColor: 'rgba(220, 20, 60, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4,
                            pointRadius: 0,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: '#b0b8c8',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(18, 32, 58, 0.95)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#DC143C',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'month'
                            },
                            grid: {
                                color: 'rgba(30, 58, 95, 0.3)'
                            },
                            ticks: {
                                color: '#b0b8c8'
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            grid: {
                                color: 'rgba(30, 58, 95, 0.3)'
                            },
                            ticks: {
                                color: '#FFD700',
                                callback: function(value) {
                                    return '$' + value.toFixed(0);
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            grid: {
                                drawOnChartArea: false
                            },
                            ticks: {
                                color: '#DC143C',
                                callback: function(value) {
                                    return value.toFixed(2) + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Initialize Dashboard
        async function initDashboard() {
            console.log('Initializing Gold Intelligence Dashboard...');
            await loadAllData();

            // Set up auto-refresh
            setInterval(async () => {
                console.log('Refreshing data...');
                await loadAllData();
            }, REFRESH_INTERVAL);
        }

        // Start dashboard on page load
        window.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>
