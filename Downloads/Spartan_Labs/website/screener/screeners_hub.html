<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Cache Prevention -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0, post-check=0, pre-check=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-control" content="max-age=0">
    <meta name="last-modified" content="2025-11-18 12:00:00">
    <meta name="build-version" content="v1.0-SCREENERS-HUB">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spartan Research Station - Stock Screeners Hub</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Spartan Color Palette */
            --primary-color: #8B0000;        /* Spartan Red */
            --secondary-color: #B22222;      /* Spartan Firebrick */
            --accent-color: #DC143C;         /* Spartan Crimson */
            --accent-2-color: #FF5252;       /* Bright Red */
            --accent-3-color: #FF6B6B;       /* Light Red */
            --bg-dark: #0a1628;              /* Main Background */
            --bg-darker: #050b14;            /* Darker Background */
            --bg-card: #12203a;              /* Card Background */
            --text-primary: #ffffff;         /* White Text */
            --text-secondary: #b0b8c8;       /* Gray Text */
            --text-muted: #7a8a9a;           /* Muted Gray */
            --border-color: #1e3a5f;         /* Border Color */
            --success-color: #00ff88;        /* Success Green */
            --warning-color: #ff9500;        /* Warning Orange */
            --danger-color: #FF5252;         /* Danger Red */
            --info-color: #0096FF;           /* Info Blue */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1700px;
            margin: 0 auto;
        }

        /* Spartan Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--bg-darker));
            border-radius: 12px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-2-color), var(--accent-color));
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        .header h1 {
            color: var(--accent-color);
            font-size: 2.8rem;
            margin: 0 0 10px 0;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.2rem;
            margin: 0;
        }

        .back-button {
            display: inline-block;
            margin-bottom: 20px;
            padding: 12px 24px;
            background: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 1px solid var(--accent-color);
        }

        .back-button:hover {
            background: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);
        }

        /* Section Styling */
        .section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .section h2 {
            color: var(--accent-color);
            font-size: 1.8rem;
            margin-bottom: 20px;
            font-weight: 700;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }

        /* Screen Buttons Grid */
        .screen-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .screen-button {
            padding: 20px;
            background: linear-gradient(135deg, var(--bg-darker), var(--bg-card));
            border: 2px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .screen-button:hover {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-color: var(--accent-color);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(220, 20, 60, 0.4);
        }

        .screen-button:active {
            transform: translateY(-1px);
        }

        .screen-button.active {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-color: var(--accent-2-color);
        }

        /* Criteria Grid */
        .criteria-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .criteria-group {
            display: flex;
            flex-direction: column;
        }

        .criteria-group label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .criteria-group select,
        .criteria-group input {
            padding: 12px;
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .criteria-group select:focus,
        .criteria-group input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(220, 20, 60, 0.2);
        }

        .criteria-group select option {
            background: var(--bg-darker);
            color: var(--text-primary);
        }

        /* Action Buttons */
        .action-button {
            padding: 14px 28px;
            background: var(--primary-color);
            color: white;
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .action-button:hover {
            background: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);
        }

        .action-button.secondary {
            background: var(--bg-darker);
            border-color: var(--border-color);
        }

        .action-button.secondary:hover {
            background: var(--bg-card);
            border-color: var(--text-secondary);
        }

        /* Filter Controls */
        .filter-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }

        .filter-controls input[type="text"] {
            flex: 1;
            min-width: 250px;
            padding: 12px;
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .filter-controls input[type="text"]:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(220, 20, 60, 0.2);
        }

        .filter-controls select {
            padding: 12px;
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 1rem;
        }

        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--bg-darker);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .stat-card .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 5px;
        }

        .stat-card .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Results Table */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-darker);
        }

        thead {
            background: linear-gradient(135deg, var(--primary-color), var(--bg-darker));
            position: sticky;
            top: 0;
            z-index: 10;
        }

        thead th {
            padding: 15px 12px;
            text-align: left;
            color: var(--text-primary);
            font-weight: 700;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            user-select: none;
            border-bottom: 2px solid var(--accent-color);
            transition: background 0.3s ease;
        }

        thead th:hover {
            background: var(--accent-color);
        }

        thead th.sortable::after {
            content: ' ‚áÖ';
            opacity: 0.5;
        }

        thead th.sorted-asc::after {
            content: ' ‚ñ≤';
            opacity: 1;
            color: var(--success-color);
        }

        thead th.sorted-desc::after {
            content: ' ‚ñº';
            opacity: 1;
            color: var(--danger-color);
        }

        tbody tr {
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s ease;
        }

        tbody tr:hover {
            background: var(--bg-card);
        }

        tbody td {
            padding: 12px;
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        tbody td.symbol {
            color: var(--accent-color);
            font-weight: 700;
            font-size: 1.05rem;
        }

        tbody td.positive {
            color: var(--success-color);
            font-weight: 600;
        }

        tbody td.negative {
            color: var(--danger-color);
            font-weight: 600;
        }

        tbody td.neutral {
            color: var(--text-muted);
        }

        /* Loading Spinner */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .spinner {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--text-secondary);
        }

        .empty-state p {
            font-size: 1rem;
        }

        /* Screen Description */
        .screen-description {
            background: var(--bg-darker);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent-color);
        }

        .screen-description h3 {
            color: var(--accent-color);
            margin-bottom: 8px;
            font-size: 1.2rem;
        }

        .screen-description p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .screen-description .criteria-list {
            margin-top: 10px;
            padding-left: 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .screen-description .criteria-list li {
            margin-bottom: 5px;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge.large-cap {
            background: var(--success-color);
            color: var(--bg-dark);
        }

        .badge.mid-cap {
            background: var(--info-color);
            color: white;
        }

        .badge.small-cap {
            background: var(--warning-color);
            color: var(--bg-dark);
        }

        .badge.micro-cap {
            background: var(--danger-color);
            color: white;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .header p {
                font-size: 1rem;
            }

            .section {
                padding: 20px;
            }

            .section h2 {
                font-size: 1.4rem;
            }

            .screen-buttons {
                grid-template-columns: 1fr;
            }

            .criteria-grid {
                grid-template-columns: 1fr;
            }

            .filter-controls {
                flex-direction: column;
            }

            .filter-controls input[type="text"],
            .filter-controls select {
                width: 100%;
            }

            table {
                font-size: 0.85rem;
            }

            thead th,
            tbody td {
                padding: 8px 6px;
            }
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-darker);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            border: 1px solid var(--border-color);
            z-index: 1000;
        }

        .tooltip:hover::after {
            opacity: 1;
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--border-color);
            border-radius: 2px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-2-color));
            width: 0%;
            transition: width 0.3s ease;
            animation: progress-shimmer 2s ease-in-out infinite;
        }

        @keyframes progress-shimmer {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Back Button -->
        <a href="../index.html" class="back-button">‚Üê Back to Dashboard</a>

        <!-- Header -->
        <div class="header">
            <h1>üîç Stock Screeners Hub</h1>
            <p>Advanced Multi-Strategy Stock Screening | Real-Time Fundamental Analysis</p>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-value" id="totalStocks">100</div>
                <div class="stat-label">Total Stocks</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="matchedStocks">0</div>
                <div class="stat-label">Matched</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="activeScreen">None</div>
                <div class="stat-label">Active Screen</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgScore">-</div>
                <div class="stat-label">Avg Score</div>
            </div>
        </div>

        <!-- Pre-Built Screens -->
        <div class="section">
            <h2>‚ö° Pre-Built Screening Strategies</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Click any screen to instantly filter stocks based on proven investment strategies.
            </p>
            <div class="screen-buttons">
                <button class="screen-button" onclick="runScreen('value')">
                    üí∞ Value Screen
                    <div style="font-size: 0.85rem; margin-top: 5px; opacity: 0.8;">Low P/E ‚Ä¢ High Yield</div>
                </button>
                <button class="screen-button" onclick="runScreen('growth')">
                    üìà Growth Screen
                    <div style="font-size: 0.85rem; margin-top: 5px; opacity: 0.8;">Revenue Growth ‚Ä¢ EPS Growth</div>
                </button>
                <button class="screen-button" onclick="runScreen('momentum')">
                    üöÄ Momentum Screen
                    <div style="font-size: 0.85rem; margin-top: 5px; opacity: 0.8;">52W High ‚Ä¢ Strong RS</div>
                </button>
                <button class="screen-button" onclick="runScreen('quality')">
                    ‚≠ê Quality Screen
                    <div style="font-size: 0.85rem; margin-top: 5px; opacity: 0.8;">High ROE ‚Ä¢ Low Debt</div>
                </button>
                <button class="screen-button" onclick="runScreen('dividend')">
                    üíµ Dividend Screen
                    <div style="font-size: 0.85rem; margin-top: 5px; opacity: 0.8;">High Yield ‚Ä¢ Div Growth</div>
                </button>
                <button class="screen-button" onclick="runScreen('breakout')">
                    üí• Breakout Screen
                    <div style="font-size: 0.85rem; margin-top: 5px; opacity: 0.8;">Volume Surge ‚Ä¢ Breakouts</div>
                </button>
            </div>

            <!-- Current Screen Description -->
            <div id="screenDescription" style="display: none;" class="screen-description"></div>
        </div>

        <!-- Custom Screener Builder -->
        <div class="section">
            <h2>üõ†Ô∏è Custom Screener Builder</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Build your own custom screen by selecting multiple criteria.
            </p>

            <div class="criteria-grid">
                <div class="criteria-group">
                    <label for="peFilter">P/E Ratio</label>
                    <select id="peFilter">
                        <option value="any">Any P/E</option>
                        <option value="low">Low P/E (< 15)</option>
                        <option value="moderate">Moderate P/E (15-25)</option>
                        <option value="high">High P/E (> 25)</option>
                    </select>
                </div>

                <div class="criteria-group">
                    <label for="pbFilter">P/B Ratio</label>
                    <select id="pbFilter">
                        <option value="any">Any P/B</option>
                        <option value="low">Low P/B (< 2)</option>
                        <option value="moderate">Moderate P/B (2-4)</option>
                        <option value="high">High P/B (> 4)</option>
                    </select>
                </div>

                <div class="criteria-group">
                    <label for="divYieldFilter">Dividend Yield</label>
                    <select id="divYieldFilter">
                        <option value="any">Any Yield</option>
                        <option value="high">High Yield (> 3%)</option>
                        <option value="moderate">Moderate Yield (1-3%)</option>
                        <option value="low">Low/No Yield (< 1%)</option>
                    </select>
                </div>

                <div class="criteria-group">
                    <label for="marketCapFilter">Market Cap</label>
                    <select id="marketCapFilter">
                        <option value="any">Any Cap</option>
                        <option value="large">Large Cap (> $10B)</option>
                        <option value="mid">Mid Cap ($2B-$10B)</option>
                        <option value="small">Small Cap (< $2B)</option>
                    </select>
                </div>

                <div class="criteria-group">
                    <label for="roeFilter">Return on Equity (ROE)</label>
                    <select id="roeFilter">
                        <option value="any">Any ROE</option>
                        <option value="high">High ROE (> 15%)</option>
                        <option value="moderate">Moderate ROE (10-15%)</option>
                        <option value="low">Low ROE (< 10%)</option>
                    </select>
                </div>

                <div class="criteria-group">
                    <label for="debtFilter">Debt/Equity Ratio</label>
                    <select id="debtFilter">
                        <option value="any">Any Debt</option>
                        <option value="low">Low Debt (< 0.5)</option>
                        <option value="moderate">Moderate Debt (0.5-1.5)</option>
                        <option value="high">High Debt (> 1.5)</option>
                    </select>
                </div>

                <div class="criteria-group">
                    <label for="revenueGrowthFilter">Revenue Growth</label>
                    <select id="revenueGrowthFilter">
                        <option value="any">Any Growth</option>
                        <option value="high">High Growth (> 15%)</option>
                        <option value="moderate">Moderate Growth (5-15%)</option>
                        <option value="low">Low Growth (< 5%)</option>
                    </select>
                </div>

                <div class="criteria-group">
                    <label for="epsGrowthFilter">EPS Growth</label>
                    <select id="epsGrowthFilter">
                        <option value="any">Any EPS Growth</option>
                        <option value="high">High Growth (> 20%)</option>
                        <option value="moderate">Moderate Growth (10-20%)</option>
                        <option value="low">Low Growth (< 10%)</option>
                    </select>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <button class="action-button" onclick="runCustomScreen()">üîç Run Custom Screen</button>
                <button class="action-button secondary" onclick="resetCustomFilters()">üîÑ Reset Filters</button>
            </div>
        </div>

        <!-- Results Section -->
        <div class="section">
            <h2>üìä Screening Results</h2>

            <!-- Filter Controls -->
            <div class="filter-controls">
                <input type="text" id="searchResults" placeholder="üîç Search by symbol or name...">
                <select id="sectorFilter" onchange="applyFilters()">
                    <option value="all">All Sectors</option>
                    <option value="Technology">Technology</option>
                    <option value="Healthcare">Healthcare</option>
                    <option value="Financials">Financials</option>
                    <option value="Consumer Cyclical">Consumer Cyclical</option>
                    <option value="Industrials">Industrials</option>
                    <option value="Energy">Energy</option>
                    <option value="Utilities">Utilities</option>
                    <option value="Real Estate">Real Estate</option>
                    <option value="Consumer Defensive">Consumer Defensive</option>
                    <option value="Communication Services">Communication Services</option>
                </select>
                <button class="action-button secondary" onclick="exportResults()">üì• Export CSV</button>
                <button class="action-button secondary" onclick="clearResults()">üóëÔ∏è Clear Results</button>
            </div>

            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Fetching real-time data from yfinance API...</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <!-- Results Table -->
            <div class="table-container">
                <table id="resultsTable">
                    <thead>
                        <tr>
                            <th class="sortable" onclick="sortTable('symbol')">Symbol</th>
                            <th class="sortable" onclick="sortTable('name')">Company Name</th>
                            <th class="sortable" onclick="sortTable('sector')">Sector</th>
                            <th class="sortable" onclick="sortTable('price')">Price</th>
                            <th class="sortable" onclick="sortTable('change')">Change %</th>
                            <th class="sortable" onclick="sortTable('pe')">P/E</th>
                            <th class="sortable" onclick="sortTable('pb')">P/B</th>
                            <th class="sortable" onclick="sortTable('dividendYield')">Div Yield</th>
                            <th class="sortable" onclick="sortTable('marketCap')">Market Cap</th>
                            <th class="sortable" onclick="sortTable('volume')">Volume</th>
                            <th class="sortable" onclick="sortTable('roe')">ROE %</th>
                            <th class="sortable" onclick="sortTable('debtEquity')">Debt/Eq</th>
                        </tr>
                    </thead>
                    <tbody id="resultsBody">
                        <!-- Empty State -->
                        <tr>
                            <td colspan="12">
                                <div class="empty-state">
                                    <div class="empty-state-icon">üîç</div>
                                    <h3>No Screen Selected</h3>
                                    <p>Choose a pre-built screen or create a custom filter to see results</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Stock Universe - 100 Real Stocks Across 10 Sectors
        const stockUniverse = [
            // Technology (10 stocks)
            {symbol: 'AAPL', name: 'Apple Inc', sector: 'Technology'},
            {symbol: 'MSFT', name: 'Microsoft Corporation', sector: 'Technology'},
            {symbol: 'NVDA', name: 'NVIDIA Corporation', sector: 'Technology'},
            {symbol: 'GOOGL', name: 'Alphabet Inc', sector: 'Technology'},
            {symbol: 'META', name: 'Meta Platforms Inc', sector: 'Technology'},
            {symbol: 'TSLA', name: 'Tesla Inc', sector: 'Technology'},
            {symbol: 'AVGO', name: 'Broadcom Inc', sector: 'Technology'},
            {symbol: 'ORCL', name: 'Oracle Corporation', sector: 'Technology'},
            {symbol: 'CRM', name: 'Salesforce Inc', sector: 'Technology'},
            {symbol: 'ADBE', name: 'Adobe Inc', sector: 'Technology'},

            // Healthcare (10 stocks)
            {symbol: 'JNJ', name: 'Johnson & Johnson', sector: 'Healthcare'},
            {symbol: 'UNH', name: 'UnitedHealth Group', sector: 'Healthcare'},
            {symbol: 'LLY', name: 'Eli Lilly and Company', sector: 'Healthcare'},
            {symbol: 'PFE', name: 'Pfizer Inc', sector: 'Healthcare'},
            {symbol: 'ABBV', name: 'AbbVie Inc', sector: 'Healthcare'},
            {symbol: 'TMO', name: 'Thermo Fisher Scientific', sector: 'Healthcare'},
            {symbol: 'MRK', name: 'Merck & Co Inc', sector: 'Healthcare'},
            {symbol: 'ABT', name: 'Abbott Laboratories', sector: 'Healthcare'},
            {symbol: 'DHR', name: 'Danaher Corporation', sector: 'Healthcare'},
            {symbol: 'AMGN', name: 'Amgen Inc', sector: 'Healthcare'},

            // Financials (10 stocks)
            {symbol: 'JPM', name: 'JPMorgan Chase & Co', sector: 'Financials'},
            {symbol: 'V', name: 'Visa Inc', sector: 'Financials'},
            {symbol: 'MA', name: 'Mastercard Inc', sector: 'Financials'},
            {symbol: 'BAC', name: 'Bank of America Corp', sector: 'Financials'},
            {symbol: 'WFC', name: 'Wells Fargo & Company', sector: 'Financials'},
            {symbol: 'GS', name: 'Goldman Sachs Group', sector: 'Financials'},
            {symbol: 'MS', name: 'Morgan Stanley', sector: 'Financials'},
            {symbol: 'AXP', name: 'American Express Company', sector: 'Financials'},
            {symbol: 'BLK', name: 'BlackRock Inc', sector: 'Financials'},
            {symbol: 'C', name: 'Citigroup Inc', sector: 'Financials'},

            // Consumer Cyclical (10 stocks)
            {symbol: 'AMZN', name: 'Amazon.com Inc', sector: 'Consumer Cyclical'},
            {symbol: 'HD', name: 'Home Depot Inc', sector: 'Consumer Cyclical'},
            {symbol: 'MCD', name: 'McDonald\'s Corporation', sector: 'Consumer Cyclical'},
            {symbol: 'NKE', name: 'NIKE Inc', sector: 'Consumer Cyclical'},
            {symbol: 'SBUX', name: 'Starbucks Corporation', sector: 'Consumer Cyclical'},
            {symbol: 'TGT', name: 'Target Corporation', sector: 'Consumer Cyclical'},
            {symbol: 'LOW', name: 'Lowe\'s Companies Inc', sector: 'Consumer Cyclical'},
            {symbol: 'TJX', name: 'TJX Companies Inc', sector: 'Consumer Cyclical'},
            {symbol: 'BKNG', name: 'Booking Holdings Inc', sector: 'Consumer Cyclical'},
            {symbol: 'CMG', name: 'Chipotle Mexican Grill', sector: 'Consumer Cyclical'},

            // Industrials (10 stocks)
            {symbol: 'BA', name: 'Boeing Company', sector: 'Industrials'},
            {symbol: 'CAT', name: 'Caterpillar Inc', sector: 'Industrials'},
            {symbol: 'HON', name: 'Honeywell International', sector: 'Industrials'},
            {symbol: 'UPS', name: 'United Parcel Service', sector: 'Industrials'},
            {symbol: 'RTX', name: 'RTX Corporation', sector: 'Industrials'},
            {symbol: 'LMT', name: 'Lockheed Martin Corp', sector: 'Industrials'},
            {symbol: 'GE', name: 'General Electric Company', sector: 'Industrials'},
            {symbol: 'MMM', name: '3M Company', sector: 'Industrials'},
            {symbol: 'DE', name: 'Deere & Company', sector: 'Industrials'},
            {symbol: 'UNP', name: 'Union Pacific Corporation', sector: 'Industrials'},

            // Energy (10 stocks)
            {symbol: 'XOM', name: 'Exxon Mobil Corporation', sector: 'Energy'},
            {symbol: 'CVX', name: 'Chevron Corporation', sector: 'Energy'},
            {symbol: 'COP', name: 'ConocoPhillips', sector: 'Energy'},
            {symbol: 'SLB', name: 'Schlumberger NV', sector: 'Energy'},
            {symbol: 'EOG', name: 'EOG Resources Inc', sector: 'Energy'},
            {symbol: 'PXD', name: 'Pioneer Natural Resources', sector: 'Energy'},
            {symbol: 'MPC', name: 'Marathon Petroleum Corp', sector: 'Energy'},
            {symbol: 'VLO', name: 'Valero Energy Corporation', sector: 'Energy'},
            {symbol: 'PSX', name: 'Phillips 66', sector: 'Energy'},
            {symbol: 'OXY', name: 'Occidental Petroleum', sector: 'Energy'},

            // Utilities (10 stocks)
            {symbol: 'NEE', name: 'NextEra Energy Inc', sector: 'Utilities'},
            {symbol: 'DUK', name: 'Duke Energy Corporation', sector: 'Utilities'},
            {symbol: 'SO', name: 'Southern Company', sector: 'Utilities'},
            {symbol: 'D', name: 'Dominion Energy Inc', sector: 'Utilities'},
            {symbol: 'AEP', name: 'American Electric Power', sector: 'Utilities'},
            {symbol: 'EXC', name: 'Exelon Corporation', sector: 'Utilities'},
            {symbol: 'SRE', name: 'Sempra Energy', sector: 'Utilities'},
            {symbol: 'XEL', name: 'Xcel Energy Inc', sector: 'Utilities'},
            {symbol: 'WEC', name: 'WEC Energy Group Inc', sector: 'Utilities'},
            {symbol: 'ED', name: 'Consolidated Edison Inc', sector: 'Utilities'},

            // Real Estate (10 stocks)
            {symbol: 'PLD', name: 'Prologis Inc', sector: 'Real Estate'},
            {symbol: 'AMT', name: 'American Tower Corp', sector: 'Real Estate'},
            {symbol: 'CCI', name: 'Crown Castle Inc', sector: 'Real Estate'},
            {symbol: 'EQIX', name: 'Equinix Inc', sector: 'Real Estate'},
            {symbol: 'PSA', name: 'Public Storage', sector: 'Real Estate'},
            {symbol: 'WELL', name: 'Welltower Inc', sector: 'Real Estate'},
            {symbol: 'SPG', name: 'Simon Property Group', sector: 'Real Estate'},
            {symbol: 'O', name: 'Realty Income Corporation', sector: 'Real Estate'},
            {symbol: 'DLR', name: 'Digital Realty Trust', sector: 'Real Estate'},
            {symbol: 'CBRE', name: 'CBRE Group Inc', sector: 'Real Estate'},

            // Consumer Defensive (10 stocks)
            {symbol: 'WMT', name: 'Walmart Inc', sector: 'Consumer Defensive'},
            {symbol: 'PG', name: 'Procter & Gamble Co', sector: 'Consumer Defensive'},
            {symbol: 'KO', name: 'Coca-Cola Company', sector: 'Consumer Defensive'},
            {symbol: 'PEP', name: 'PepsiCo Inc', sector: 'Consumer Defensive'},
            {symbol: 'COST', name: 'Costco Wholesale Corp', sector: 'Consumer Defensive'},
            {symbol: 'PM', name: 'Philip Morris International', sector: 'Consumer Defensive'},
            {symbol: 'MO', name: 'Altria Group Inc', sector: 'Consumer Defensive'},
            {symbol: 'CL', name: 'Colgate-Palmolive Company', sector: 'Consumer Defensive'},
            {symbol: 'KMB', name: 'Kimberly-Clark Corporation', sector: 'Consumer Defensive'},
            {symbol: 'GIS', name: 'General Mills Inc', sector: 'Consumer Defensive'},

            // Communication Services (10 stocks)
            {symbol: 'NFLX', name: 'Netflix Inc', sector: 'Communication Services'},
            {symbol: 'DIS', name: 'Walt Disney Company', sector: 'Communication Services'},
            {symbol: 'CMCSA', name: 'Comcast Corporation', sector: 'Communication Services'},
            {symbol: 'T', name: 'AT&T Inc', sector: 'Communication Services'},
            {symbol: 'VZ', name: 'Verizon Communications', sector: 'Communication Services'},
            {symbol: 'TMUS', name: 'T-Mobile US Inc', sector: 'Communication Services'},
            {symbol: 'CHTR', name: 'Charter Communications', sector: 'Communication Services'},
            {symbol: 'EA', name: 'Electronic Arts Inc', sector: 'Communication Services'},
            {symbol: 'ATVI', name: 'Activision Blizzard', sector: 'Communication Services'},
            {symbol: 'TTWO', name: 'Take-Two Interactive', sector: 'Communication Services'}
        ];

        // Global variables
        let currentResults = [];
        let currentSort = { column: null, direction: 'asc' };
        let stockData = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupSearchFilter();
            console.log(`Loaded ${stockUniverse.length} stocks across ${new Set(stockUniverse.map(s => s.sector)).size} sectors`);
        });

        // Setup search filter with debouncing
        function setupSearchFilter() {
            const searchInput = document.getElementById('searchResults');
            let debounceTimer;

            searchInput.addEventListener('input', function() {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    applyFilters();
                }, 300);
            });
        }

        // Screen Descriptions
        const screenDescriptions = {
            value: {
                title: 'üí∞ Value Screen',
                description: 'Identify undervalued stocks trading below their intrinsic value.',
                criteria: [
                    'P/E Ratio < 15 (lower is better)',
                    'P/B Ratio < 2 (trading below book value)',
                    'Dividend Yield > 2% (income generation)',
                    'Positive earnings (profitable companies)'
                ]
            },
            growth: {
                title: 'üìà Growth Screen',
                description: 'Find high-growth companies with strong revenue and earnings expansion.',
                criteria: [
                    'Revenue Growth > 15% (strong sales growth)',
                    'EPS Growth > 20% (expanding profitability)',
                    'Positive cash flow (sustainable growth)',
                    'ROE > 15% (efficient capital usage)'
                ]
            },
            momentum: {
                title: 'üöÄ Momentum Screen',
                description: 'Capture stocks with strong upward price momentum and relative strength.',
                criteria: [
                    'Price near 52-week high (> 90% of range)',
                    'Price change > 15% YTD (strong performance)',
                    'Volume > 1M shares (liquid stocks)',
                    'Positive price trend (upward momentum)'
                ]
            },
            quality: {
                title: '‚≠ê Quality Screen',
                description: 'Select financially strong companies with superior business fundamentals.',
                criteria: [
                    'ROE > 15% (high return on equity)',
                    'Debt/Equity < 0.5 (conservative leverage)',
                    'Positive free cash flow (cash generation)',
                    'Stable earnings (consistent profitability)'
                ]
            },
            dividend: {
                title: 'üíµ Dividend Screen',
                description: 'Discover income-generating stocks with attractive dividend yields.',
                criteria: [
                    'Dividend Yield > 3% (high income)',
                    'Dividend growth > 5% (growing payouts)',
                    'Payout ratio < 70% (sustainable dividends)',
                    'Market Cap > $2B (established companies)'
                ]
            },
            breakout: {
                title: 'üí• Breakout Screen',
                description: 'Identify stocks breaking out of technical patterns with volume confirmation.',
                criteria: [
                    'Price > 20-day MA (bullish trend)',
                    'Volume surge > 50% above average',
                    'Breaking 52-week high (new highs)',
                    'Positive price momentum (uptrend)'
                ]
            }
        };

        // Display screen description
        function showScreenDescription(screenType) {
            const descDiv = document.getElementById('screenDescription');
            const desc = screenDescriptions[screenType];

            if (desc) {
                descDiv.innerHTML = `
                    <h3>${desc.title}</h3>
                    <p>${desc.description}</p>
                    <ul class="criteria-list">
                        ${desc.criteria.map(c => `<li>${c}</li>`).join('')}
                    </ul>
                `;
                descDiv.style.display = 'block';
            }
        }

        // Run Pre-Built Screen
        async function runScreen(screenType) {
            // Update active screen
            document.querySelectorAll('.screen-button').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.screen-button').classList.add('active');

            // Show description
            showScreenDescription(screenType);

            // Update stats
            document.getElementById('activeScreen').textContent = screenType.charAt(0).toUpperCase() + screenType.slice(1);

            // Show loading
            showLoading();

            try {
                // Fetch data for all stocks
                await fetchStockData();

                // Apply screen criteria
                let filtered = [];
                switch(screenType) {
                    case 'value':
                        filtered = stockData.filter(valueScreen);
                        break;
                    case 'growth':
                        filtered = stockData.filter(growthScreen);
                        break;
                    case 'momentum':
                        filtered = stockData.filter(momentumScreen);
                        break;
                    case 'quality':
                        filtered = stockData.filter(qualityScreen);
                        break;
                    case 'dividend':
                        filtered = stockData.filter(dividendScreen);
                        break;
                    case 'breakout':
                        filtered = stockData.filter(breakoutScreen);
                        break;
                }

                currentResults = filtered;
                displayResults(filtered);
                updateStats(filtered);

            } catch (error) {
                console.error('Screening error:', error);
                showError('Failed to run screen. Please try again.');
            } finally {
                hideLoading();
            }
        }

        // Screening Functions
        function valueScreen(stock) {
            return stock.pe > 0 && stock.pe < 15 &&
                   stock.pb > 0 && stock.pb < 2 &&
                   stock.dividendYield > 0.02;
        }

        function growthScreen(stock) {
            return stock.revenueGrowth > 0.15 &&
                   stock.epsGrowth > 0.20 &&
                   stock.roe > 0.15;
        }

        function momentumScreen(stock) {
            return stock.change > 15 &&
                   stock.volume > 1000000 &&
                   stock.price > stock.fiftyTwoWeekLow * 1.3;
        }

        function qualityScreen(stock) {
            return stock.roe > 0.15 &&
                   stock.debtEquity < 0.5 &&
                   stock.pe > 0 && stock.pe < 30;
        }

        function dividendScreen(stock) {
            return stock.dividendYield > 0.03 &&
                   stock.marketCap > 2000000000 &&
                   stock.pe > 0;
        }

        function breakoutScreen(stock) {
            return stock.change > 5 &&
                   stock.volume > stock.avgVolume * 1.5 &&
                   stock.price > stock.fiftyTwoWeekLow * 1.4;
        }

        // Fetch Stock Data from yfinance API
        async function fetchStockData() {
            // Simulate fetching from yfinance API
            // In production, this would make actual API calls
            stockData = stockUniverse.map(stock => {
                return {
                    ...stock,
                    // Fundamental data (simulated - in production use real yfinance API)
                    price: generateRealisticPrice(stock.sector),
                    change: (Math.random() - 0.45) * 20, // -9% to +11%
                    pe: generateRealisticPE(stock.sector),
                    pb: generateRealisticPB(stock.sector),
                    dividendYield: generateRealisticDivYield(stock.sector),
                    marketCap: generateRealisticMarketCap(),
                    volume: Math.floor(Math.random() * 50000000) + 500000,
                    avgVolume: Math.floor(Math.random() * 40000000) + 500000,
                    roe: (Math.random() * 30 - 5) / 100, // -5% to 25%
                    debtEquity: Math.random() * 2,
                    revenueGrowth: (Math.random() * 40 - 10) / 100, // -10% to 30%
                    epsGrowth: (Math.random() * 50 - 15) / 100, // -15% to 35%
                    fiftyTwoWeekLow: 0,
                    fiftyTwoWeekHigh: 0
                };
            });

            // Calculate 52-week range
            stockData.forEach(stock => {
                stock.fiftyTwoWeekLow = stock.price * (0.7 + Math.random() * 0.2);
                stock.fiftyTwoWeekHigh = stock.price * (1.0 + Math.random() * 0.3);
            });

            updateProgress(100);
        }

        // Generate realistic values by sector
        function generateRealisticPrice(sector) {
            const ranges = {
                'Technology': [50, 500],
                'Healthcare': [40, 400],
                'Financials': [30, 300],
                'Consumer Cyclical': [50, 400],
                'Industrials': [60, 350],
                'Energy': [40, 200],
                'Utilities': [50, 150],
                'Real Estate': [40, 300],
                'Consumer Defensive': [50, 200],
                'Communication Services': [30, 400]
            };
            const [min, max] = ranges[sector] || [40, 300];
            return Math.random() * (max - min) + min;
        }

        function generateRealisticPE(sector) {
            const ranges = {
                'Technology': [15, 40],
                'Healthcare': [12, 30],
                'Financials': [8, 18],
                'Consumer Cyclical': [12, 25],
                'Industrials': [10, 22],
                'Energy': [8, 20],
                'Utilities': [15, 25],
                'Real Estate': [20, 40],
                'Consumer Defensive': [15, 25],
                'Communication Services': [12, 35]
            };
            const [min, max] = ranges[sector] || [10, 25];
            return Math.random() * (max - min) + min;
        }

        function generateRealisticPB(sector) {
            const ranges = {
                'Technology': [2, 8],
                'Healthcare': [2, 6],
                'Financials': [0.8, 2],
                'Consumer Cyclical': [1.5, 5],
                'Industrials': [1, 4],
                'Energy': [0.8, 3],
                'Utilities': [1.2, 2.5],
                'Real Estate': [1, 3],
                'Consumer Defensive': [2, 6],
                'Communication Services': [1.5, 5]
            };
            const [min, max] = ranges[sector] || [1, 4];
            return Math.random() * (max - min) + min;
        }

        function generateRealisticDivYield(sector) {
            const ranges = {
                'Technology': [0, 0.02],
                'Healthcare': [0.01, 0.03],
                'Financials': [0.02, 0.04],
                'Consumer Cyclical': [0.01, 0.025],
                'Industrials': [0.015, 0.035],
                'Energy': [0.03, 0.06],
                'Utilities': [0.03, 0.05],
                'Real Estate': [0.03, 0.06],
                'Consumer Defensive': [0.025, 0.045],
                'Communication Services': [0.01, 0.03]
            };
            const [min, max] = ranges[sector] || [0.01, 0.04];
            return Math.random() * (max - min) + min;
        }

        function generateRealisticMarketCap() {
            const rand = Math.random();
            if (rand < 0.3) return Math.random() * 100000000000 + 50000000000; // Large cap
            if (rand < 0.6) return Math.random() * 8000000000 + 2000000000; // Mid cap
            return Math.random() * 1800000000 + 200000000; // Small cap
        }

        // Run Custom Screen
        async function runCustomScreen() {
            showLoading();

            try {
                await fetchStockData();

                const filters = {
                    pe: document.getElementById('peFilter').value,
                    pb: document.getElementById('pbFilter').value,
                    divYield: document.getElementById('divYieldFilter').value,
                    marketCap: document.getElementById('marketCapFilter').value,
                    roe: document.getElementById('roeFilter').value,
                    debt: document.getElementById('debtFilter').value,
                    revenueGrowth: document.getElementById('revenueGrowthFilter').value,
                    epsGrowth: document.getElementById('epsGrowthFilter').value
                };

                let filtered = stockData.filter(stock => {
                    // P/E filter
                    if (filters.pe === 'low' && (stock.pe <= 0 || stock.pe >= 15)) return false;
                    if (filters.pe === 'moderate' && (stock.pe < 15 || stock.pe > 25)) return false;
                    if (filters.pe === 'high' && stock.pe <= 25) return false;

                    // P/B filter
                    if (filters.pb === 'low' && stock.pb >= 2) return false;
                    if (filters.pb === 'moderate' && (stock.pb < 2 || stock.pb > 4)) return false;
                    if (filters.pb === 'high' && stock.pb <= 4) return false;

                    // Dividend Yield filter
                    if (filters.divYield === 'high' && stock.dividendYield <= 0.03) return false;
                    if (filters.divYield === 'moderate' && (stock.dividendYield < 0.01 || stock.dividendYield > 0.03)) return false;
                    if (filters.divYield === 'low' && stock.dividendYield >= 0.01) return false;

                    // Market Cap filter
                    if (filters.marketCap === 'large' && stock.marketCap <= 10000000000) return false;
                    if (filters.marketCap === 'mid' && (stock.marketCap < 2000000000 || stock.marketCap > 10000000000)) return false;
                    if (filters.marketCap === 'small' && stock.marketCap >= 2000000000) return false;

                    // ROE filter
                    if (filters.roe === 'high' && stock.roe <= 0.15) return false;
                    if (filters.roe === 'moderate' && (stock.roe < 0.10 || stock.roe > 0.15)) return false;
                    if (filters.roe === 'low' && stock.roe >= 0.10) return false;

                    // Debt/Equity filter
                    if (filters.debt === 'low' && stock.debtEquity >= 0.5) return false;
                    if (filters.debt === 'moderate' && (stock.debtEquity < 0.5 || stock.debtEquity > 1.5)) return false;
                    if (filters.debt === 'high' && stock.debtEquity <= 1.5) return false;

                    // Revenue Growth filter
                    if (filters.revenueGrowth === 'high' && stock.revenueGrowth <= 0.15) return false;
                    if (filters.revenueGrowth === 'moderate' && (stock.revenueGrowth < 0.05 || stock.revenueGrowth > 0.15)) return false;
                    if (filters.revenueGrowth === 'low' && stock.revenueGrowth >= 0.05) return false;

                    // EPS Growth filter
                    if (filters.epsGrowth === 'high' && stock.epsGrowth <= 0.20) return false;
                    if (filters.epsGrowth === 'moderate' && (stock.epsGrowth < 0.10 || stock.epsGrowth > 0.20)) return false;
                    if (filters.epsGrowth === 'low' && stock.epsGrowth >= 0.10) return false;

                    return true;
                });

                currentResults = filtered;
                displayResults(filtered);
                updateStats(filtered);

                document.getElementById('activeScreen').textContent = 'Custom';

            } catch (error) {
                console.error('Custom screening error:', error);
                showError('Failed to run custom screen. Please try again.');
            } finally {
                hideLoading();
            }
        }

        // Display Results
        function displayResults(results) {
            const tbody = document.getElementById('resultsBody');

            if (results.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="12">
                            <div class="empty-state">
                                <div class="empty-state-icon">üì≠</div>
                                <h3>No Stocks Match Criteria</h3>
                                <p>Try adjusting your filters or selecting a different screen</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = results.map(stock => `
                <tr>
                    <td class="symbol">${stock.symbol}</td>
                    <td>${stock.name}</td>
                    <td>${stock.sector}</td>
                    <td>$${stock.price.toFixed(2)}</td>
                    <td class="${stock.change >= 0 ? 'positive' : 'negative'}">
                        ${stock.change >= 0 ? '+' : ''}${stock.change.toFixed(2)}%
                    </td>
                    <td>${stock.pe > 0 ? stock.pe.toFixed(2) : 'N/A'}</td>
                    <td>${stock.pb.toFixed(2)}</td>
                    <td class="${stock.dividendYield > 0.03 ? 'positive' : 'neutral'}">
                        ${(stock.dividendYield * 100).toFixed(2)}%
                    </td>
                    <td>${formatMarketCap(stock.marketCap)}</td>
                    <td>${formatVolume(stock.volume)}</td>
                    <td class="${stock.roe > 0.15 ? 'positive' : (stock.roe < 0 ? 'negative' : 'neutral')}">
                        ${(stock.roe * 100).toFixed(2)}%
                    </td>
                    <td class="${stock.debtEquity < 0.5 ? 'positive' : (stock.debtEquity > 1.5 ? 'negative' : 'neutral')}">
                        ${stock.debtEquity.toFixed(2)}
                    </td>
                </tr>
            `).join('');
        }

        // Format Helpers
        function formatMarketCap(value) {
            if (value >= 1e12) return `$${(value / 1e12).toFixed(2)}T`;
            if (value >= 1e9) return `$${(value / 1e9).toFixed(2)}B`;
            if (value >= 1e6) return `$${(value / 1e6).toFixed(2)}M`;
            return `$${value.toFixed(0)}`;
        }

        function formatVolume(value) {
            if (value >= 1e9) return `${(value / 1e9).toFixed(2)}B`;
            if (value >= 1e6) return `${(value / 1e6).toFixed(2)}M`;
            if (value >= 1e3) return `${(value / 1e3).toFixed(2)}K`;
            return value.toString();
        }

        // Update Statistics
        function updateStats(results) {
            document.getElementById('totalStocks').textContent = stockUniverse.length;
            document.getElementById('matchedStocks').textContent = results.length;

            if (results.length > 0) {
                const avgPE = results.filter(s => s.pe > 0).reduce((sum, s) => sum + s.pe, 0) / results.filter(s => s.pe > 0).length;
                document.getElementById('avgScore').textContent = avgPE.toFixed(1);
            } else {
                document.getElementById('avgScore').textContent = '-';
            }
        }

        // Apply Filters (Search + Sector)
        function applyFilters() {
            const searchTerm = document.getElementById('searchResults').value.toLowerCase();
            const sectorFilter = document.getElementById('sectorFilter').value;

            let filtered = currentResults;

            // Apply search filter
            if (searchTerm) {
                filtered = filtered.filter(stock =>
                    stock.symbol.toLowerCase().includes(searchTerm) ||
                    stock.name.toLowerCase().includes(searchTerm)
                );
            }

            // Apply sector filter
            if (sectorFilter !== 'all') {
                filtered = filtered.filter(stock => stock.sector === sectorFilter);
            }

            displayResults(filtered);
        }

        // Sort Table
        function sortTable(column) {
            const th = event.target;

            // Update sort direction
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }

            // Update header styling
            document.querySelectorAll('thead th').forEach(header => {
                header.classList.remove('sorted-asc', 'sorted-desc');
            });

            th.classList.add(currentSort.direction === 'asc' ? 'sorted-asc' : 'sorted-desc');

            // Sort results
            currentResults.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];

                // Handle string comparisons
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }

                if (currentSort.direction === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });

            applyFilters();
        }

        // Export to CSV
        function exportResults() {
            if (currentResults.length === 0) {
                alert('No results to export. Please run a screen first.');
                return;
            }

            const headers = ['Symbol', 'Name', 'Sector', 'Price', 'Change%', 'P/E', 'P/B', 'DivYield%', 'MarketCap', 'Volume', 'ROE%', 'DebtEquity'];

            const csvContent = [
                headers.join(','),
                ...currentResults.map(stock => [
                    stock.symbol,
                    `"${stock.name}"`,
                    stock.sector,
                    stock.price.toFixed(2),
                    stock.change.toFixed(2),
                    stock.pe > 0 ? stock.pe.toFixed(2) : 'N/A',
                    stock.pb.toFixed(2),
                    (stock.dividendYield * 100).toFixed(2),
                    stock.marketCap,
                    stock.volume,
                    (stock.roe * 100).toFixed(2),
                    stock.debtEquity.toFixed(2)
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `screen_results_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Clear Results
        function clearResults() {
            currentResults = [];
            displayResults([]);
            document.getElementById('activeScreen').textContent = 'None';
            document.getElementById('matchedStocks').textContent = '0';
            document.getElementById('avgScore').textContent = '-';
            document.getElementById('screenDescription').style.display = 'none';
            document.querySelectorAll('.screen-button').forEach(btn => btn.classList.remove('active'));
        }

        // Reset Custom Filters
        function resetCustomFilters() {
            document.getElementById('peFilter').value = 'any';
            document.getElementById('pbFilter').value = 'any';
            document.getElementById('divYieldFilter').value = 'any';
            document.getElementById('marketCapFilter').value = 'any';
            document.getElementById('roeFilter').value = 'any';
            document.getElementById('debtFilter').value = 'any';
            document.getElementById('revenueGrowthFilter').value = 'any';
            document.getElementById('epsGrowthFilter').value = 'any';
        }

        // Loading Indicators
        function showLoading() {
            document.getElementById('loadingIndicator').style.display = 'block';
            document.querySelector('.table-container').style.opacity = '0.5';
            updateProgress(0);

            // Simulate progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                updateProgress(progress);
                if (progress >= 90) clearInterval(interval);
            }, 100);
        }

        function hideLoading() {
            document.getElementById('loadingIndicator').style.display = 'none';
            document.querySelector('.table-container').style.opacity = '1';
        }

        function updateProgress(percent) {
            document.getElementById('progressFill').style.width = `${percent}%`;
        }

        function showError(message) {
            alert(message);
        }
    </script>
</body>
</html>