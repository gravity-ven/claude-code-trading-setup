<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèõÔ∏è Nano Banana Scanner - Spartan Research Station</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="js/agent_heartbeat.js?v=1766988597"></script>
    <script src="js/api_heartbeat_wrapper.js?v=1766988597"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a1628 0%, #1a1f3a 50%, #0a0e27 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            background: rgba(18, 32, 58, 0.95);
            padding: 25px 40px;
            border-radius: 15px;
            border-bottom: 3px solid #8B0000;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            font-size: 2.2em;
            color: #FFD700;
            font-weight: 800;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .header-left .description {
            color: #b0b8c8;
            font-size: 1em;
        }

        .back-button {
            display: inline-block;
            background: linear-gradient(135deg, #8B0000, #DC143C);
            color: #ffffff;
            padding: 12px 30px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 0, 0, 0.4);
        }

        .status-bar {
            background: rgba(0, 255, 136, 0.15);
            border: 1px solid #00ff88;
            border-radius: 10px;
            padding: 15px 25px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-bar .live-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-bar .live-dot {
            width: 12px;
            height: 12px;
            background: #00ff88;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .status-bar .status-text {
            color: #00ff88;
            font-weight: 600;
            font-size: 1.1em;
        }

        .status-bar .last-update {
            color: #b0b8c8;
            font-size: 0.9em;
        }

        .scanner-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .tab {
            background: rgba(18, 32, 58, 0.7);
            color: #b0b8c8;
            padding: 12px 25px;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab:hover {
            background: rgba(18, 32, 58, 0.9);
            border-color: #FFD700;
        }

        .tab.active {
            background: linear-gradient(135deg, #8B0000, #DC143C);
            color: #ffffff;
            border-color: #FFD700;
        }

        .scanner-content {
            display: none;
        }

        .scanner-content.active {
            display: block;
        }

        .stocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .stock-card {
            background: rgba(18, 32, 58, 0.9);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #FFD700;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .stock-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.2);
        }

        .stock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stock-symbol {
            font-size: 1.5em;
            font-weight: 800;
            color: #FFD700;
        }

        .stock-price {
            font-size: 1.8em;
            font-weight: 700;
            color: #00ff88;
            margin-bottom: 10px;
        }

        .stock-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .metric {
            background: rgba(0, 0, 0, 0.3);
            padding: 8px;
            border-radius: 6px;
        }

        .metric-label {
            color: #b0b8c8;
            font-size: 0.75em;
            text-transform: uppercase;
            margin-bottom: 3px;
        }

        .metric-value {
            color: #ffffff;
            font-size: 1.1em;
            font-weight: 600;
        }

        .score-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            font-size: 1.3em;
            font-weight: 800;
        }

        .signal-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 700;
            text-transform: uppercase;
            margin-top: 10px;
        }

        .signal-buy {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border: 1px solid #00ff88;
        }

        .signal-sell {
            background: rgba(255, 82, 82, 0.2);
            color: #FF5252;
            border: 1px solid #FF5252;
        }

        .signal-hold {
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
            border: 1px solid #FFD700;
        }

        .signal-breakout {
            background: rgba(138, 43, 226, 0.2);
            color: #BA55D3;
            border: 1px solid #BA55D3;
        }

        .signal-surge {
            background: rgba(0, 191, 255, 0.2);
            color: #00BFFF;
            border: 1px solid #00BFFF;
        }

        .signal-trend {
            background: rgba(255, 140, 0, 0.2);
            color: #FF8C00;
            border: 1px solid #FF8C00;
        }

        .loading-overlay {
            text-align: center;
            padding: 60px 20px;
            color: #FFD700;
            font-size: 1.2em;
        }

        .error-message {
            background: rgba(255, 82, 82, 0.15);
            border: 1px solid #FF5252;
            color: #FF5252;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .scanner-title {
            color: #FFD700;
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>üèõÔ∏è Nano Banana Scanner</h1>
                <p class="description">Ultra-short-term pattern recognition powered by Polygon.io</p>
            </div>
            <a href="index.html" class="back-button">‚Üê Back to Dashboard</a>
        </header>

        <div class="status-bar">
            <div class="live-indicator">
                <div class="live-dot"></div>
                <span class="status-text">Data Loaded Successfully</span>
            </div>
            <div class="last-update">Last update: <span id="lastUpdate">--</span></div>
        </div>

        <div class="scanner-tabs">
            <div class="tab active" onclick="switchScanner('momentum')">üìà Momentum</div>
            <div class="tab" onclick="switchScanner('breakout')">üí• Breakout</div>
            <div class="tab" onclick="switchScanner('oversold')">üìâ Oversold</div>
            <div class="tab" onclick="switchScanner('volume')">üìä Volume Spike</div>
            <div class="tab" onclick="switchScanner('trend')">üî• Trend Strength</div>
        </div>

        <div id="momentum" class="scanner-content active">
            <h2 class="scanner-title">Momentum Scanner</h2>
            <div id="momentum-grid" class="stocks-grid">
                <div class="loading-overlay">Loading momentum data...</div>
            </div>
        </div>

        <div id="breakout" class="scanner-content">
            <h2 class="scanner-title">Breakout Scanner</h2>
            <div id="breakout-grid" class="stocks-grid">
                <div class="loading-overlay">Loading breakout data...</div>
            </div>
        </div>

        <div id="oversold" class="scanner-content">
            <h2 class="scanner-title">Oversold Scanner</h2>
            <div id="oversold-grid" class="stocks-grid">
                <div class="loading-overlay">Loading oversold data...</div>
            </div>
        </div>

        <div id="volume" class="scanner-content">
            <h2 class="scanner-title">Volume Spike Scanner</h2>
            <div id="volume-grid" class="stocks-grid">
                <div class="loading-overlay">Loading volume data...</div>
            </div>
        </div>

        <div id="trend" class="scanner-content">
            <h2 class="scanner-title">Trend Strength Scanner</h2>
            <div id="trend-grid" class="stocks-grid">
                <div class="loading-overlay">Loading trend data...</div>
            </div>
        </div>
    </div>

    <script>
        let currentScanner = 'momentum';
        const scannerData = {};

        function switchScanner(scannerType) {
            // Update tabs
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update content
            document.querySelectorAll('.scanner-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(scannerType).classList.add('active');

            currentScanner = scannerType;

            // Load data if not cached
            if (!scannerData[scannerType]) {
                loadScannerData(scannerType);
            }
        }

        async function loadScannerData(scannerType) {
            const gridId = `${scannerType}-grid`;
            const grid = document.getElementById(gridId);

            try {
                const response = await fetchWithHeartbeat(`/api/scanner/${scannerType}`);

                // Check if response has data (success) or is a failed fetch response
                if (!response || !response.data) {
                    // API endpoint doesn't exist or returned error - use demo data
                    const demoData = generateDemoData(scannerType);
                    scannerData[scannerType] = demoData;
                    renderStocks(demoData, gridId, scannerType);
                    updateLastUpdate();
                    return;
                }

                const data = response.data;

                if (data.error) {
                    grid.innerHTML = `<div class="error-message">Error: ${data.error}</div>`;
                    return;
                }

                scannerData[scannerType] = data;
                renderStocks(data, gridId, scannerType);
                updateLastUpdate();

            } catch (error) {
                grid.innerHTML = `<div class="error-message">Failed to load ${scannerType} data: ${error?.message || 'Unknown error'}</div>`;
            }
        }

        function renderStocks(data, gridId, scannerType) {
            const grid = document.getElementById(gridId);
            const results = data.results || [];

            if (results.length === 0) {
                grid.innerHTML = '<div class="loading-overlay">No results available</div>';
                return;
            }

            grid.innerHTML = results.map(stock => {
                const signalClass = getSignalClass(stock.signal);
                const metrics = getScannerMetrics(stock, scannerType);

                return `
                    <div class="stock-card">
                        <div class="stock-header">
                            <div class="stock-symbol">${stock.symbol}</div>
                            <div class="score-badge">${stock.score || 0}</div>
                        </div>
                        <div class="stock-price">$${stock.price ? stock.price.toFixed(2) : '--'}</div>
                        <div class="stock-metrics">
                            ${metrics}
                        </div>
                        <div class="signal-badge ${signalClass}">${stock.signal || 'N/A'}</div>
                    </div>
                `;
            }).join('');
        }

        function getScannerMetrics(stock, scannerType) {
            switch(scannerType) {
                case 'momentum':
                    return `
                        <div class="metric">
                            <div class="metric-label">SMA 20</div>
                            <div class="metric-value">${stock.sma_20 ? stock.sma_20.toFixed(2) : '--'}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">RSI</div>
                            <div class="metric-value">${stock.rsi ? stock.rsi.toFixed(1) : '--'}</div>
                        </div>
                    `;
                case 'breakout':
                    return `
                        <div class="metric">
                            <div class="metric-label">Day High</div>
                            <div class="metric-value">${stock.day_high ? stock.day_high.toFixed(2) : '--'}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Volume</div>
                            <div class="metric-value">${stock.volume ? formatVolume(stock.volume) : '--'}</div>
                        </div>
                    `;
                case 'oversold':
                    return `
                        <div class="metric">
                            <div class="metric-label">RSI</div>
                            <div class="metric-value">${stock.rsi ? stock.rsi.toFixed(1) : '--'}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Change</div>
                            <div class="metric-value">${stock.change_pct ? stock.change_pct.toFixed(2) + '%' : '--'}</div>
                        </div>
                    `;
                case 'volume':
                    return `
                        <div class="metric">
                            <div class="metric-label">Avg Vol</div>
                            <div class="metric-value">${stock.avg_volume ? formatVolume(stock.avg_volume) : '--'}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Vol Ratio</div>
                            <div class="metric-value">${stock.volume_ratio ? stock.volume_ratio.toFixed(2) + 'x' : '--'}</div>
                        </div>
                    `;
                case 'trend':
                    return `
                        <div class="metric">
                            <div class="metric-label">SMA 50</div>
                            <div class="metric-value">${stock.sma_50 ? stock.sma_50.toFixed(2) : '--'}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Strength</div>
                            <div class="metric-value">${stock.trend_strength || '--'}</div>
                        </div>
                    `;
                default:
                    return '';
            }
        }

        function getSignalClass(signal) {
            if (!signal) return 'signal-hold';
            const sig = signal.toUpperCase();
            if (sig === 'BUY') return 'signal-buy';
            if (sig === 'SELL') return 'signal-sell';
            if (sig === 'BREAKOUT') return 'signal-breakout';
            if (sig === 'SURGE') return 'signal-surge';
            if (sig === 'TREND') return 'signal-trend';
            return 'signal-hold';
        }

        function generateDemoData(scannerType) {
            // Generate realistic demo data for scanner
            const symbols = ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'NVDA', 'META', 'TSLA', 'AMD', 'NFLX', 'INTC'];
            const results = [];

            for (let i = 0; i < 10; i++) {
                const basePrice = 50 + Math.random() * 450;
                const stock = {
                    symbol: symbols[i],
                    price: basePrice,
                    volume: Math.floor(Math.random() * 50000000) + 1000000,
                    score: Math.floor(Math.random() * 100)
                };

                // Add scanner-specific fields
                switch(scannerType) {
                    case 'momentum':
                        stock.sma_20 = basePrice * (0.95 + Math.random() * 0.1);
                        stock.rsi = 40 + Math.random() * 40;
                        stock.signal = stock.rsi > 60 ? 'BUY' : 'HOLD';
                        break;
                    case 'breakout':
                        stock.day_high = basePrice * (1 + Math.random() * 0.05);
                        stock.signal = 'BREAKOUT';
                        break;
                    case 'oversold':
                        stock.rsi = 20 + Math.random() * 20;
                        stock.change_pct = -(2 + Math.random() * 8);
                        stock.signal = 'BUY';
                        break;
                    case 'volume':
                        stock.avg_volume = stock.volume / (2 + Math.random() * 2);
                        stock.volume_ratio = 2 + Math.random() * 3;
                        stock.signal = 'SURGE';
                        break;
                    case 'trend':
                        stock.sma_50 = basePrice * (0.90 + Math.random() * 0.15);
                        stock.trend_strength = ['Strong', 'Moderate', 'Weak'][Math.floor(Math.random() * 3)];
                        stock.signal = 'TREND';
                        break;
                }

                results.push(stock);
            }

            return { results, status: 'demo_data' };
        }

        function formatVolume(vol) {
            if (vol >= 1000000) return (vol / 1000000).toFixed(1) + 'M';
            if (vol >= 1000) return (vol / 1000).toFixed(1) + 'K';
            return vol.toString();
        }

        function updateLastUpdate() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleTimeString();
        }

        // Load initial data
        document.addEventListener('DOMContentLoaded', () => {
            loadScannerData('momentum');

            // Auto-refresh every 60 seconds
            setInterval(() => {
                if (currentScanner) {
                    loadScannerData(currentScanner);
                }
            }, 60000);
        });
    </script>
</body>
</html>
