<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ULTRA-AGGRESSIVE Cache Prevention -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0, post-check=0, pre-check=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6-18 Month Trends - Spartan Research Station</title>

    <!-- Spartan Theme -->
    <link rel="stylesheet" href="spartan_theme.css">

    <!-- Data Fetchers -->
    <script src="js/fred_api_client.js"></script>
    <script src="js/timeframe_data_fetcher_6_18_months.js"></script>

    <style>
        :root {
            --primary-color: #8B0000;
            --secondary-color: #B22222;
            --accent-color: #DC143C;
            --bg-dark: #0a1628;
            --bg-darker: #050b14;
            --bg-card: #12203a;
            --text-primary: #ffffff;
            --text-secondary: #b0b8c8;
            --border-color: #1e3a5f;
            --gold: #DC143C;
            --green: #228B22;
            --blue: #000080;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1f3a 50%, #0a0e27 100%);
            color: var(--text-primary);
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            background: rgba(18, 32, 58, 0.98);
            backdrop-filter: blur(20px);
            padding: 20px 30px;
            border-radius: 12px;
            border: 2px solid var(--primary-color);
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(139, 0, 0, 0.3);
        }

        h1 {
            color: var(--primary-color);
            font-size: 2.2em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1em;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--bg-card);
            border-radius: 12px;
            border: 2px solid var(--border-color);
            padding: 25px;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 5px 20px rgba(139, 0, 0, 0.2);
            transform: translateY(-3px);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--primary-color);
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .metric {
            background: rgba(10, 22, 40, 0.5);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .metric-label {
            font-size: 0.85em;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-value {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--text-primary);
        }

        .metric-value.positive {
            color: var(--green);
        }

        .metric-value.negative {
            color: var(--primary-color);
        }

        .metric-change {
            font-size: 0.9em;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .trend-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
        }

        .trend-rising {
            background: rgba(34, 139, 34, 0.2);
            color: var(--green);
            border: 1px solid var(--green);
        }

        .trend-falling {
            background: rgba(139, 0, 0, 0.2);
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .trend-stable {
            background: rgba(176, 184, 200, 0.2);
            color: var(--text-secondary);
            border: 1px solid var(--text-secondary);
        }

        .flow-table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
        }

        .flow-table th {
            background: rgba(139, 0, 0, 0.1);
            padding: 12px;
            text-align: left;
            font-size: 0.85em;
            color: var(--text-secondary);
            border-bottom: 2px solid var(--primary-color);
        }

        .flow-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .flow-table tr:hover {
            background: rgba(139, 0, 0, 0.05);
        }

        .signal-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .signal-buy {
            background: rgba(34, 139, 34, 0.2);
            color: var(--green);
            border: 1px solid var(--green);
        }

        .signal-sell {
            background: rgba(139, 0, 0, 0.2);
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .signal-hold {
            background: rgba(176, 184, 200, 0.2);
            color: var(--text-secondary);
            border: 1px solid var(--text-secondary);
        }

        .thematic-list {
            list-style: none;
            padding: 0;
        }

        .thematic-item {
            background: rgba(10, 22, 40, 0.5);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            margin-bottom: 12px;
        }

        .thematic-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .thematic-performance {
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .strength-bar {
            height: 8px;
            background: rgba(139, 0, 0, 0.2);
            border-radius: 4px;
            margin-top: 8px;
            overflow: hidden;
        }

        .strength-fill {
            height: 100%;
            background: var(--green);
            transition: width 0.5s ease;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
            font-size: 1.1em;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .error {
            background: rgba(139, 0, 0, 0.2);
            border: 2px solid var(--primary-color);
            padding: 20px;
            border-radius: 8px;
            color: var(--text-primary);
            margin: 20px 0;
        }

        .data-source {
            font-size: 0.75em;
            color: var(--text-secondary);
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        .back-link {
            display: inline-block;
            margin-top: 30px;
            padding: 12px 24px;
            background: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            background: var(--secondary-color);
            box-shadow: 0 5px 20px rgba(139, 0, 0, 0.3);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>6-18 Month Position Trading Trends</h1>
            <p class="subtitle">Macro Dashboard ‚Ä¢ Regional Capital Flows ‚Ä¢ Thematic Opportunities</p>
        </header>

        <!-- Macro Dashboard Section -->
        <section id="macro-dashboard">
            <h2 style="color: var(--primary-color); margin-bottom: 20px; font-size: 1.8em;">Macro Economic Dashboard</h2>
            <div class="dashboard-grid" id="macro-grid">
                <div class="loading">Loading macro data</div>
            </div>
        </section>

        <!-- Regional Capital Flows Section -->
        <section id="capital-flows" style="margin-top: 40px;">
            <h2 style="color: var(--primary-color); margin-bottom: 20px; font-size: 1.8em;">Regional Capital Flows (6-Month Analysis)</h2>
            <div class="card" id="flows-card">
                <div class="loading">Loading capital flow data</div>
            </div>
        </section>

        <!-- Thematic Opportunities Section -->
        <section id="thematic-opps" style="margin-top: 40px;">
            <h2 style="color: var(--primary-color); margin-bottom: 20px; font-size: 1.8em;">Thematic Investment Opportunities</h2>
            <div class="dashboard-grid" id="thematic-grid">
                <div class="loading">Loading thematic data</div>
            </div>
        </section>

        <a href="index.html" class="back-link">‚Üê Back to Dashboard</a>
    </div>

    <script>
        // Initialize data fetcher
        const dataFetcher = new TimeframeDataFetcher_6_18_Months();

        // Load all data on page load
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Loading 6-18 Month Trends Data...');

            try {
                const result = await dataFetcher.fetchAllData();

                if (!result.success) {
                    showError('Failed to load data: ' + (result.error || 'Unknown error'));
                    return;
                }

                const data = result.data;
                console.log('‚úÖ Data loaded successfully:', data);

                // Render macro dashboard
                renderMacroDashboard(data.macro);

                // Render capital flows
                renderCapitalFlows(data.global);

                // Render thematic opportunities
                renderThematicOpportunities(data.sectors);

            } catch (error) {
                console.error('‚ùå Error loading data:', error);
                showError('Error loading data: ' + error.message);
            }
        });

        function renderMacroDashboard(macro) {
            const grid = document.getElementById('macro-grid');

            const cards = [
                {
                    title: 'Fed Policy Stance',
                    metrics: [
                        { label: 'Fed Funds Rate', value: macro.growth?.latest ? `${macro.growth.latest.toFixed(2)}%` : 'Loading...', trend: macro.growth?.trend },
                        { label: 'Policy Outlook', value: getTrendLabel(macro.growth?.trend), trend: macro.growth?.trend }
                    ]
                },
                {
                    title: 'Yield Curve Status',
                    metrics: [
                        { label: '10Y-2Y Spread', value: 'FRED T10Y2Y', trend: 'stable' },
                        { label: 'Curve Shape', value: 'Normal', trend: 'stable' }
                    ]
                },
                {
                    title: 'Credit Spreads',
                    metrics: [
                        { label: 'IG Spread', value: 'FRED BAMLC0A0CM', trend: 'stable' },
                        { label: 'HY Spread', value: 'FRED BAMLH0A0HYM2', trend: 'rising' }
                    ]
                },
                {
                    title: 'Housing Market',
                    metrics: [
                        { label: 'Housing Starts', value: macro.housing?.latest ? `${(macro.housing.latest / 1000).toFixed(1)}K` : 'Loading...', trend: macro.housing?.trend },
                        { label: '6M Trend', value: getTrendLabel(macro.housing?.trend), trend: macro.housing?.trend }
                    ]
                }
            ];

            grid.innerHTML = cards.map(card => `
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">${card.title}</div>
                    </div>
                    <div class="metric-grid">
                        ${card.metrics.map(m => `
                            <div class="metric">
                                <div class="metric-label">${m.label}</div>
                                <div class="metric-value ${getValueClass(m.trend)}">${m.value}</div>
                                ${m.trend ? `<div class="metric-change"><span class="trend-indicator trend-${m.trend}">${m.trend}</span></div>` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function renderCapitalFlows(global) {
            const card = document.getElementById('flows-card');

            const regions = global?.regions || {};
            const regionData = [
                { name: 'United States', ticker: 'SPY', data: regions.us },
                { name: 'Developed Markets', ticker: 'EFA', data: regions.developed },
                { name: 'Emerging Asia', ticker: 'EEM', data: regions.emerging },
                { name: 'China', ticker: 'FXI', data: regions.china }
            ];

            card.innerHTML = `
                <div class="card-header">
                    <div class="card-title">Regional Performance & Flows</div>
                </div>
                <table class="flow-table">
                    <thead>
                        <tr>
                            <th>Region</th>
                            <th>6M Return</th>
                            <th>12M Return</th>
                            <th>Trend</th>
                            <th>Signal</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${regionData.map(r => {
                            const sixM = r.data?.twelveMonthReturn || 'N/A';
                            const twelveM = r.data?.eighteenMonthReturn || 'N/A';
                            const trend = r.data?.trend || 'unknown';
                            const signal = getFlowSignal(r.data);

                            return `
                                <tr>
                                    <td><strong>${r.name}</strong> <span style="color: var(--text-secondary); font-size: 0.85em;">(${r.ticker})</span></td>
                                    <td class="${parseFloat(sixM) >= 0 ? 'positive' : 'negative'}">${sixM}%</td>
                                    <td class="${parseFloat(twelveM) >= 0 ? 'positive' : 'negative'}">${twelveM}%</td>
                                    <td><span class="trend-indicator trend-${trend}">${trend}</span></td>
                                    <td><span class="signal-badge signal-${signal}">${signal.toUpperCase()}</span></td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
                <div class="data-source">
                    Data Source: Yahoo Finance (via local proxy) ‚Ä¢ 18-month lookback ‚Ä¢ Updated every 4 hours
                </div>
            `;
        }

        function renderThematicOpportunities(sectors) {
            const grid = document.getElementById('thematic-grid');

            const themes = [
                { name: 'AI & Technology', ticker: 'XLK', sector: sectors?.sectors?.XLK },
                { name: 'Clean Energy & Renewables', ticker: 'ICLN', sector: null },
                { name: 'Defense & Aerospace', ticker: 'ITA', sector: null },
                { name: 'Reshoring & Infrastructure', ticker: 'XLI', sector: sectors?.sectors?.XLI }
            ];

            grid.innerHTML = themes.map(theme => {
                const performance = theme.sector?.twelveMonthReturn || 'N/A';
                const strength = theme.sector ? calculateStrength(theme.sector) : 50;

                return `
                    <div class="card">
                        <div class="thematic-item">
                            <div class="thematic-name">${theme.name}</div>
                            <div class="thematic-performance">
                                12M Performance: <span class="${parseFloat(performance) >= 0 ? 'positive' : 'negative'}" style="font-weight: 600;">${performance}%</span>
                            </div>
                            <div class="strength-bar">
                                <div class="strength-fill" style="width: ${strength}%"></div>
                            </div>
                            <div style="margin-top: 8px; font-size: 0.85em; color: var(--text-secondary);">
                                Strength Score: ${strength}/100
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getTrendLabel(trend) {
            const labels = {
                'rising': 'Rising',
                'falling': 'Falling',
                'stable': 'Stable',
                'unknown': 'Unknown'
            };
            return labels[trend] || trend;
        }

        function getValueClass(trend) {
            if (trend === 'rising') return 'positive';
            if (trend === 'falling') return 'negative';
            return '';
        }

        function getFlowSignal(data) {
            if (!data || !data.twelveMonthReturn) return 'hold';
            const ret = parseFloat(data.twelveMonthReturn);
            if (ret > 15) return 'buy';
            if (ret < -10) return 'sell';
            return 'hold';
        }

        function calculateStrength(sector) {
            if (!sector || !sector.allocationScore) return 50;
            return Math.round(sector.allocationScore);
        }

        function showError(message) {
            document.getElementById('macro-grid').innerHTML = `
                <div class="error" style="grid-column: 1 / -1;">
                    <strong>Error:</strong> ${message}
                    <br><br>
                    <small>Data sources: FRED (Federal Reserve Economic Data), Yahoo Finance</small>
                </div>
            `;
        }
    </script>
</body>
</html>
