<!DOCTYPE html>
<html>
<head>
    <title>Market Health Test</title>
</head>
<body>
    <h1>Market Health Test</h1>
    <div id="global-health-score" style="font-size: 3rem; font-weight: 800;">
        Loading...
    </div>
    <div id="global-health-status" style="font-size: 1.5rem; margin-top: 20px;">
        Calculating...
    </div>
    <div id="debug-output" style="margin-top: 40px; background: #222; padding: 20px; font-family: monospace; white-space: pre;"></div>

    <script>
        const SWING_API_BASE_URL = 'http://localhost:5002/api/swing-dashboard';

        async function updateMarketHealth() {
            const debugOutput = document.getElementById('debug-output');
            debugOutput.textContent = 'Fetching data from API...\n';

            try {
                const url = `${SWING_API_BASE_URL}/market-health`;
                debugOutput.textContent += `URL: ${url}\n`;

                const response = await fetch(url);
                debugOutput.textContent += `Response status: ${response.status}\n`;

                const data = await response.json();
                debugOutput.textContent += `Data received: ${JSON.stringify(data, null, 2)}\n`;

                const healthScoreElement = document.getElementById('global-health-score');
                const healthStatusElement = document.getElementById('global-health-status');

                if (healthScoreElement && data.health_score !== undefined) {
                    debugOutput.textContent += `Updating health score element...\n`;
                    debugOutput.textContent += `health_score value: ${data.health_score}\n`;
                    debugOutput.textContent += `health_score.toFixed(1): ${data.health_score.toFixed(1)}\n`;

                    const scoreClass = data.health_score >= 70 ? 'positive' :
                                      data.health_score >= 50 ? 'neutral' : 'negative';

                    healthScoreElement.innerHTML = `
                        <span class="${scoreClass}">${data.health_score.toFixed(1)}</span>
                        <span style="font-size: 1.5rem; color: #999;"> / 100</span>
                    `;

                    debugOutput.textContent += `Successfully updated health score!\n`;
                }

                if (healthStatusElement && data.status) {
                    const statusColor = data.health_score >= 70 ? 'green' :
                                       data.health_score >= 50 ? 'orange' : 'red';

                    healthStatusElement.innerHTML = `
                        <span style="color: ${statusColor}; font-weight: 600;">${data.status}</span>
                    `;

                    debugOutput.textContent += `Successfully updated health status!\n`;
                }

                console.log('âœ“ Market health updated successfully');
            } catch (error) {
                console.error('Error fetching market health:', error);
                debugOutput.textContent += `ERROR: ${error.message}\n`;
                debugOutput.textContent += `Stack: ${error.stack}\n`;
            }
        }

        // Run on page load
        updateMarketHealth();
    </script>
</body>
</html>
