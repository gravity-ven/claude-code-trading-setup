<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Cache Prevention -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0, post-check=0, pre-check=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-control" content="max-age=0">
    <meta name="last-modified" content="2025-11-18 12:00:00">
    <meta name="build-version" content="v1.0-INTERMARKET-CORRELATIONS">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intermarket Relationships - Spartan Research Station</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>

    <!-- Spartan Theme -->
    <style>
        :root {
            /* Spartan Color Palette */
            --primary-color: #8B0000;        /* Spartan Red */
            --secondary-color: #B22222;      /* Spartan Firebrick */
            --accent-color: #DC143C;         /* Spartan Crimson */
            --accent-2-color: #FF5252;       /* Bright Red */
            --accent-3-color: #FF6B6B;       /* Light Red */
            --bg-dark: #0a1628;              /* Main Background */
            --bg-darker: #050b14;            /* Darker Background */
            --bg-card: #12203a;              /* Card Background */
            --text-primary: #ffffff;         /* White Text */
            --text-secondary: #b0b8c8;       /* Gray Text */
            --text-muted: #7a8a9a;           /* Muted Gray */
            --border-color: #1e3a5f;         /* Border Color */
            --success-color: #00ff88;        /* Success Green */
            --warning-color: #ff9500;        /* Warning Orange */
            --danger-color: #FF5252;         /* Danger Red */
            --info-color: #0096FF;           /* Info Blue */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1700px;
            margin: 0 auto;
        }

        /* Spartan Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--bg-darker));
            border-radius: 12px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-2-color), var(--accent-color));
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        .header h1 {
            color: var(--accent-color);
            font-size: 2.8rem;
            margin: 0 0 10px 0;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.2rem;
            margin: 10px 0;
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        .back-btn {
            display: inline-block;
            padding: 12px 30px;
            background: var(--accent-color);
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .back-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);
        }

        /* Section Styles */
        .section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-2-color));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .section:hover::before {
            opacity: 1;
        }

        .section:hover {
            border-color: var(--accent-color);
            box-shadow: 0 10px 30px rgba(139, 0, 0, 0.1);
        }

        .section h2 {
            color: var(--accent-color);
            font-size: 1.8rem;
            margin: 0 0 25px 0;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            font-size: 1.5rem;
        }

        /* Loading Indicator */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .spinner {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Chart Containers */
        .chart-container {
            position: relative;
            height: 500px;
            margin: 20px 0;
        }

        .chart-container-large {
            position: relative;
            height: 700px;
            margin: 20px 0;
        }

        .chart-container-small {
            position: relative;
            height: 350px;
            margin: 20px 0;
        }

        /* Grid Layouts */
        .two-column-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(700px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .three-column-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        /* Correlation Matrix Grid */
        .correlation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 3px;
            margin: 20px 0;
        }

        .correlation-cell {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            padding: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }

        .correlation-cell:hover {
            transform: scale(1.1);
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .correlation-value {
            font-size: 1rem;
            font-weight: 700;
            margin-top: 4px;
        }

        .correlation-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-align: center;
        }

        /* Risk Meter */
        .risk-meter {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 30px;
            background: rgba(220, 20, 60, 0.05);
            border-radius: 10px;
            border: 2px solid var(--border-color);
            margin: 20px 0;
        }

        .meter-bar {
            flex: 1;
            height: 40px;
            background: linear-gradient(90deg,
                var(--danger-color) 0%,
                var(--warning-color) 50%,
                var(--success-color) 100%);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }

        .meter-indicator {
            position: absolute;
            width: 6px;
            height: 100%;
            background: white;
            box-shadow: 0 0 10px rgba(255,255,255,0.8);
            transition: left 0.5s ease;
        }

        .meter-label {
            font-size: 1.8rem;
            font-weight: 700;
            min-width: 200px;
            text-align: center;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .data-table thead {
            background: var(--bg-darker);
            border-bottom: 2px solid var(--accent-color);
        }

        .data-table th {
            padding: 15px;
            text-align: left;
            font-weight: 700;
            color: var(--accent-color);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.85rem;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table tbody tr {
            transition: background 0.2s ease;
        }

        .data-table tbody tr:hover {
            background: rgba(220, 20, 60, 0.05);
        }

        /* Asset Pills */
        .asset-pill {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .asset-equity {
            background: rgba(0, 150, 255, 0.2);
            color: var(--info-color);
            border: 1px solid var(--info-color);
        }

        .asset-bonds {
            background: rgba(0, 255, 136, 0.2);
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }

        .asset-commodity {
            background: rgba(255, 149, 0, 0.2);
            color: var(--warning-color);
            border: 1px solid var(--warning-color);
        }

        .asset-currency {
            background: rgba(220, 20, 60, 0.2);
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
        }

        .asset-realestate {
            background: rgba(255, 82, 82, 0.2);
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
        }

        /* Status Indicators */
        .status-positive {
            color: var(--success-color);
            font-weight: 700;
        }

        .status-negative {
            color: var(--danger-color);
            font-weight: 700;
        }

        .status-neutral {
            color: var(--text-secondary);
            font-weight: 600;
        }

        /* Alert Boxes */
        .alert-box {
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }

        .alert-warning {
            background: rgba(255, 149, 0, 0.1);
            border-color: var(--warning-color);
            color: var(--warning-color);
        }

        .alert-danger {
            background: rgba(255, 82, 82, 0.1);
            border-color: var(--danger-color);
            color: var(--danger-color);
        }

        .alert-info {
            background: rgba(0, 150, 255, 0.1);
            border-color: var(--info-color);
            color: var(--info-color);
        }

        .alert-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .alert-content h4 {
            margin: 0 0 5px 0;
            font-size: 1.1rem;
        }

        .alert-content p {
            margin: 0;
            color: var(--text-secondary);
        }

        /* Leading/Lagging Indicators */
        .indicator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .indicator-card {
            background: var(--bg-darker);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .indicator-card:hover {
            border-color: var(--accent-color);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(139, 0, 0, 0.1);
        }

        .indicator-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .indicator-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .indicator-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-leading {
            background: var(--success-color);
            color: var(--bg-dark);
        }

        .badge-lagging {
            background: var(--warning-color);
            color: var(--bg-dark);
        }

        .indicator-value {
            font-size: 2rem;
            font-weight: 800;
            margin: 10px 0;
        }

        .indicator-description {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 10px;
        }

        /* Update Timestamp */
        .update-info {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9rem;
            margin: 20px 0;
            padding: 15px;
            background: rgba(220, 20, 60, 0.05);
            border-radius: 8px;
        }

        .update-info strong {
            color: var(--accent-color);
        }

        /* Error Messages */
        .error-message {
            background: rgba(255, 82, 82, 0.1);
            border: 2px solid var(--danger-color);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
        }

        .error-message h3 {
            color: var(--danger-color);
            margin-bottom: 10px;
        }

        .error-message p {
            color: var(--text-secondary);
        }

        /* Responsive Design */
        @media (max-width: 1400px) {
            .two-column-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 900px) {
            .three-column-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }

            .chart-container,
            .chart-container-large {
                height: 400px;
            }

            .indicator-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 600px) {
            body {
                padding: 10px;
            }

            .section {
                padding: 20px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .correlation-grid {
                grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="header">
            <h1>üîó Intermarket Relationships</h1>
            <p>Cross-Market Correlation Analysis & Intermarket Dynamics</p>
            <p style="font-size: 0.9rem; color: var(--text-muted); margin-top: 10px;">
                Real-time correlation tracking across equities, bonds, commodities, currencies, and real estate
            </p>
            <a href="index.html" class="back-btn">‚Üê Back to Dashboard</a>
        </div>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="section">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading intermarket data from yfinance API</p>
            </div>
        </div>

        <!-- Update Info -->
        <div id="updateInfo" class="update-info" style="display: none;">
            <strong>Last Updated:</strong> <span id="lastUpdate">--</span> |
            <strong>Data Period:</strong> <span id="dataPeriod">--</span> |
            <strong>Auto-refresh:</strong> Every 120 seconds
        </div>

        <!-- Risk-On/Risk-Off Meter -->
        <div id="riskMeterSection" class="section" style="display: none;">
            <h2><span class="section-icon">‚öñÔ∏è</span> Risk-On/Risk-Off Meter</h2>
            <div class="risk-meter">
                <div style="min-width: 120px; text-align: right;">
                    <div style="font-size: 1.2rem; font-weight: 700; color: var(--danger-color);">RISK OFF</div>
                    <div style="font-size: 0.8rem; color: var(--text-muted);">Defensive</div>
                </div>
                <div class="meter-bar">
                    <div id="meterIndicator" class="meter-indicator"></div>
                </div>
                <div style="min-width: 120px;">
                    <div style="font-size: 1.2rem; font-weight: 700; color: var(--success-color);">RISK ON</div>
                    <div style="font-size: 0.8rem; color: var(--text-muted);">Aggressive</div>
                </div>
            </div>
            <div class="meter-label" id="riskLabel">CALCULATING...</div>
            <div id="riskExplanation" style="margin-top: 20px; color: var(--text-secondary); text-align: center;"></div>
        </div>

        <!-- Correlation Matrix -->
        <div id="correlationMatrixSection" class="section" style="display: none;">
            <h2><span class="section-icon">üìä</span> Correlation Matrix</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                60-day rolling correlation coefficients (-1.0 to +1.0).
                <span style="color: var(--success-color);">Green</span> = positive correlation,
                <span style="color: var(--danger-color);">Red</span> = negative correlation.
            </p>
            <div id="correlationGrid" class="correlation-grid"></div>
        </div>

        <!-- Cross-Asset Performance Chart -->
        <div id="normalizedChartSection" class="section" style="display: none;">
            <h2><span class="section-icon">üìà</span> Cross-Asset Performance (Normalized)</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                All assets normalized to 100 at start date for visual correlation comparison
            </p>
            <div class="chart-container-large">
                <canvas id="normalizedChart"></canvas>
            </div>
        </div>

        <!-- Top Correlations Table -->
        <div id="correlationsTableSection" class="section" style="display: none;">
            <h2><span class="section-icon">üîù</span> Strongest Relationships</h2>
            <div class="two-column-grid">
                <div>
                    <h3 style="color: var(--success-color); margin-bottom: 15px;">üìà Highest Positive Correlations</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Asset Pair</th>
                                <th>Correlation</th>
                                <th>Strength</th>
                            </tr>
                        </thead>
                        <tbody id="positiveCorrelationsTable"></tbody>
                    </table>
                </div>
                <div>
                    <h3 style="color: var(--danger-color); margin-bottom: 15px;">üìâ Highest Negative Correlations</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Asset Pair</th>
                                <th>Correlation</th>
                                <th>Strength</th>
                            </tr>
                        </thead>
                        <tbody id="negativeCorrelationsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Leading vs Lagging Assets -->
        <div id="leadingLaggingSection" class="section" style="display: none;">
            <h2><span class="section-icon">üèÉ</span> Leading vs Lagging Assets</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Assets ranked by their tendency to lead or lag market movements (based on cross-correlation with time lags)
            </p>
            <div id="leadingLaggingGrid" class="indicator-grid"></div>
        </div>

        <!-- Individual Correlation Charts -->
        <div id="individualChartsSection" class="section" style="display: none;">
            <h2><span class="section-icon">üìä</span> Key Correlation Pairs</h2>
            <div class="two-column-grid">
                <div>
                    <h3 style="color: var(--accent-color); margin-bottom: 15px;">SPY vs TLT (Equity/Bond)</h3>
                    <div class="chart-container">
                        <canvas id="spyTltChart"></canvas>
                    </div>
                </div>
                <div>
                    <h3 style="color: var(--accent-color); margin-bottom: 15px;">GLD vs UUP (Gold/Dollar)</h3>
                    <div class="chart-container">
                        <canvas id="gldUupChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Divergence Alerts -->
        <div id="divergencesSection" class="section" style="display: none;">
            <h2><span class="section-icon">‚ö†Ô∏è</span> Intermarket Divergences</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Significant correlation breakdowns (current correlation differs by >0.3 from 6-month average)
            </p>
            <div id="divergencesList"></div>
        </div>

        <!-- Historical Correlation Trends -->
        <div id="historicalSection" class="section" style="display: none;">
            <h2><span class="section-icon">üìâ</span> Historical Correlation Trends</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                How key correlations have evolved over the past 6 months
            </p>
            <div class="chart-container-large">
                <canvas id="historicalCorrelationChart"></canvas>
            </div>
        </div>

        <!-- NEW SECTION: The Macro Mechanism -->
        <div id="macroMechanismSection" class="section" style="display: none;">
            <h2><span class="section-icon">üîó</span> The Macro Mechanism</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Understanding these correlations is crucial for the next 14 days.
                <span style="color: var(--success-color);">Green boxes</span> indicate a positive correlation (move together),
                <span style="color: var(--danger-color);">Red boxes</span> indicate inverse correlation (move opposite).
            </p>

            <div class="two-column-grid">
                <!-- Left: Driver Correlations Logic Board -->
                <div style="background: var(--bg-darker); border-radius: 12px; border: 1px solid var(--border-color); padding: 30px; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; right: 0; width: 80px; height: 80px; background: rgba(220, 20, 60, 0.1); filter: blur(50px);"></div>

                    <h3 style="color: var(--accent-color); font-size: 1.3rem; font-weight: 700; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">Driver Correlations</h3>

                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <!-- Row 1: Dollar vs Commodities -->
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div style="flex: 1; font-size: 0.9rem; color: var(--text-secondary);">
                                US Dollar (DXY) <span style="font-size: 0.75rem; color: var(--success-color);">‚ñ≤ Strong</span>
                            </div>
                            <div style="width: 50px; text-align: center; font-weight: 700; font-size: 1.2rem; color: var(--danger-color);">vs</div>
                            <div style="flex: 1; text-align: right; font-size: 0.9rem; color: var(--text-secondary);">Commodities (Gold/Oil)</div>
                            <div style="width: 30px; height: 30px; border-radius: 6px; background: rgba(255, 82, 82, 0.2); border: 1px solid var(--danger-color); display: flex; align-items: center; justify-content: center; color: var(--danger-color); font-size: 0.75rem; font-weight: 700; margin-left: 10px;">Inv</div>
                        </div>
                        <div style="height: 2px; background: linear-gradient(90deg, transparent, var(--border-color), transparent); margin: 5px 0;"></div>

                        <!-- Row 2: Bond Yields vs Tech -->
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div style="flex: 1; font-size: 0.9rem; color: var(--text-secondary);">
                                Bond Yields <span style="font-size: 0.75rem; color: var(--success-color);">‚ñ≤ Rising</span>
                            </div>
                            <div style="width: 50px; text-align: center; font-weight: 700; font-size: 1.2rem; color: var(--danger-color);">vs</div>
                            <div style="flex: 1; text-align: right; font-size: 0.9rem; color: var(--text-secondary);">Tech Futures (Nasdaq)</div>
                            <div style="width: 30px; height: 30px; border-radius: 6px; background: rgba(255, 82, 82, 0.2); border: 1px solid var(--danger-color); display: flex; align-items: center; justify-content: center; color: var(--danger-color); font-size: 0.75rem; font-weight: 700; margin-left: 10px;">Inv</div>
                        </div>
                        <div style="height: 2px; background: linear-gradient(90deg, transparent, var(--border-color), transparent); margin: 5px 0;"></div>

                        <!-- Row 3: Inflation vs Metals -->
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div style="flex: 1; font-size: 0.9rem; color: var(--text-secondary);">Inflation Expectations</div>
                            <div style="width: 50px; text-align: center; font-weight: 700; font-size: 1.2rem; color: var(--success-color);">vs</div>
                            <div style="flex: 1; text-align: right; font-size: 0.9rem; color: var(--text-secondary);">Silver & Copper</div>
                            <div style="width: 30px; height: 30px; border-radius: 6px; background: rgba(0, 255, 136, 0.2); border: 1px solid var(--success-color); display: flex; align-items: center; justify-content: center; color: var(--success-color); font-size: 0.75rem; font-weight: 700; margin-left: 10px;">Pos</div>
                        </div>
                    </div>

                    <div style="margin-top: 25px; padding: 15px; background: rgba(220, 20, 60, 0.05); border-radius: 8px; font-size: 0.85rem; color: var(--text-muted);">
                        <strong style="color: var(--text-primary);">Investor Takeaway:</strong> The Dollar is pausing, giving Gold and Copper room to run. However, be careful with Tech Futures if Yields break 4.5%.
                    </div>
                </div>

                <!-- Right: Capital Flow Chart -->
                <div style="background: var(--bg-darker); border-radius: 12px; border: 1px solid var(--border-color); padding: 30px;">
                    <h3 style="color: var(--accent-color); font-size: 1.3rem; font-weight: 700; margin-bottom: 5px;">Current Capital Rotation (7-Day)</h3>
                    <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 20px;">Where is the smart money moving right now?</p>
                    <div class="chart-container">
                        <canvas id="intermarketFlowChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW SECTION: Futures & Bonds Deep Dive -->
        <div id="futuresBondsSection" class="section" style="display: none;">
            <h2><span class="section-icon">üìä</span> Equity Futures & Treasury Bonds</h2>

            <div class="two-column-grid">
                <!-- Equity Futures Card -->
                <div style="background: var(--bg-darker); border-radius: 12px; border: 1px solid var(--border-color); padding: 30px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: var(--text-primary); font-size: 1.5rem; font-weight: 700; margin: 0;">Equity Futures</h3>
                        <span style="padding: 6px 14px; border-radius: 20px; background: rgba(0, 255, 136, 0.2); color: var(--success-color); font-size: 0.75rem; font-weight: 700; text-transform: uppercase; border: 1px solid var(--success-color);">BULLISH (LEVERAGED)</span>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 25px;">
                        S&P 500 and Nasdaq futures are in a momentum breakout. Traders are front-running expected earnings beats. <strong style="color: var(--text-primary);">Watch Level: 5800 SPX.</strong>
                    </p>
                    <div class="chart-container-small">
                        <canvas id="futuresDeepDiveChart"></canvas>
                    </div>
                </div>

                <!-- Bonds Card -->
                <div style="background: var(--bg-darker); border-radius: 12px; border: 1px solid var(--border-color); padding: 30px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: var(--text-primary); font-size: 1.5rem; font-weight: 700; margin: 0;">Bonds (Treasuries)</h3>
                        <span style="padding: 6px 14px; border-radius: 20px; background: rgba(255, 82, 82, 0.2); color: var(--danger-color); font-size: 0.75rem; font-weight: 700; text-transform: uppercase; border: 1px solid var(--danger-color);">BEARISH (PRICES)</span>
                    </div>
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 25px;">
                        Yields (inverted to price) are creeping up. The market does not believe the Fed will cut aggressively. <strong style="color: var(--text-primary);">Short duration is safer.</strong>
                    </p>
                    <div class="chart-container-small">
                        <canvas id="bondsDeepDiveChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW SECTION: Precious Metals Deep Dive -->
        <div id="preciousMetalsSection" class="section" style="display: none;">
            <div style="display: flex; align-items: center; margin-bottom: 30px;">
                <span style="width: 10px; height: 40px; background: #FFD700; margin-right: 15px; border-radius: 2px;"></span>
                <h2 style="margin: 0; font-size: 2rem; font-weight: 700; color: var(--text-primary);">Precious Metals: The Hedge Trade</h2>
            </div>

            <div class="three-column-grid">
                <!-- Gold Card -->
                <div style="background: var(--bg-darker); border-radius: 12px; border: 1px solid rgba(255, 215, 0, 0.3); padding: 25px; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 15px; right: 15px; color: #FFD700; font-weight: 700; font-family: monospace; font-size: 1.3rem;">XAU</div>
                    <h3 style="color: var(--text-primary); font-size: 1.3rem; font-weight: 700; margin: 0 0 15px 0;">Gold</h3>
                    <div style="margin-bottom: 20px;">
                        <span style="font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px;">Sentiment Score</span>
                        <div style="width: 100%; height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; margin-top: 5px; overflow: hidden;">
                            <div style="width: 75%; height: 100%; background: #FFD700; border-radius: 10px;"></div>
                        </div>
                        <div style="text-align: right; color: #FFD700; font-size: 0.8rem; margin-top: 3px; font-weight: 600;">75/100 (Strong)</div>
                    </div>
                    <div class="chart-container-small">
                        <canvas id="goldDetailChart"></canvas>
                    </div>
                    <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 15px;">
                        Safe haven flows dominate. Breaking resistance at historical highs.
                    </p>
                </div>

                <!-- Silver Card -->
                <div style="background: var(--bg-darker); border-radius: 12px; border: 1px solid var(--border-color); padding: 25px; position: relative; overflow: hidden;">
                    <div style="position: absolute; -right: 25px; -top: 25px; width: 100px; height: 100px; background: rgba(255, 255, 255, 0.03); transform: rotate(45deg);"></div>
                    <div style="position: absolute; top: 15px; right: 15px; color: var(--text-secondary); font-weight: 700; font-family: monospace; font-size: 1.3rem;">XAG</div>
                    <h3 style="color: var(--text-primary); font-size: 1.3rem; font-weight: 700; margin: 0 0 15px 0;">Silver</h3>
                    <div style="margin-bottom: 20px;">
                        <span style="font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px;">Sentiment Score</span>
                        <div style="width: 100%; height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; margin-top: 5px; overflow: hidden;">
                            <div style="width: 88%; height: 100%; background: #00f3ff; border-radius: 10px; box-shadow: 0 0 10px rgba(0, 243, 255, 0.5);"></div>
                        </div>
                        <div style="text-align: right; color: #00f3ff; font-size: 0.8rem; margin-top: 3px; font-weight: 600;">88/100 (Extreme)</div>
                    </div>
                    <div class="chart-container-small">
                        <canvas id="silverDetailChart"></canvas>
                    </div>
                    <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 15px;">
                        <strong style="color: var(--text-primary);">"High Beta Gold."</strong> Silver is catching up aggressively. Industrial demand + monetary demand = Rocket fuel.
                    </p>
                </div>

                <!-- Platinum Card -->
                <div style="background: var(--bg-darker); border-radius: 12px; border: 1px solid var(--border-color); padding: 25px; opacity: 0.85; position: relative;">
                    <div style="position: absolute; top: 15px; right: 15px; color: var(--text-muted); font-weight: 700; font-family: monospace; font-size: 1.3rem;">XPT</div>
                    <h3 style="color: var(--text-primary); font-size: 1.3rem; font-weight: 700; margin: 0 0 15px 0;">Platinum</h3>
                    <div style="margin-bottom: 20px;">
                        <span style="font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px;">Sentiment Score</span>
                        <div style="width: 100%; height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; margin-top: 5px; overflow: hidden;">
                            <div style="width: 40%; height: 100%; background: #94a3b8; border-radius: 10px;"></div>
                        </div>
                        <div style="text-align: right; color: #94a3b8; font-size: 0.8rem; margin-top: 3px; font-weight: 600;">40/100 (Weak)</div>
                    </div>
                    <div class="chart-container-small">
                        <canvas id="platinumDetailChart"></canvas>
                    </div>
                    <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 15px;">
                        Lagging severely. Automotive demand is weak. Opportunity only for contrarians expecting a catch-up trade.
                    </p>
                </div>
            </div>
        </div>

        <!-- NEW SECTION: Industrial & Energy -->
        <div id="industrialEnergySection" class="section" style="display: none;">
            <div style="display: flex; align-items: center; margin-bottom: 30px;">
                <span style="width: 10px; height: 40px; background: #f97316; margin-right: 15px; border-radius: 2px;"></span>
                <h2 style="margin: 0; font-size: 2rem; font-weight: 700; color: var(--text-primary);">Industrial & Energy</h2>
            </div>

            <div class="two-column-grid">
                <!-- Copper Card -->
                <div style="background: var(--bg-darker); border-radius: 12px; border: 1px solid rgba(249, 115, 22, 0.3); padding: 30px;">
                    <h3 style="color: #f97316; font-size: 1.4rem; font-weight: 700; margin: 0 0 15px 0;">Copper (Dr. Copper)</h3>
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 20px;">
                        Showing a <span style="color: var(--text-primary);">Neutral/Positive</span> divergence. While manufacturing data is soft, supply constraints are keeping prices floored.
                    </p>
                    <div class="chart-container-small">
                        <canvas id="copperDetailChart"></canvas>
                    </div>
                </div>

                <!-- Oil Card -->
                <div style="background: var(--bg-darker); border-radius: 12px; border: 1px solid var(--border-color); padding: 30px;">
                    <h3 style="color: var(--text-primary); font-size: 1.4rem; font-weight: 700; margin: 0 0 15px 0;">Crude Oil (WTI)</h3>
                    <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 20px;">
                        Locked in a consolidation pattern. Geopolitical risk premium is fading vs. non-OPEC supply growth. <span style="color: var(--danger-color);">Outlook: Rangebound.</span>
                    </p>
                    <div class="chart-container-small">
                        <canvas id="oilDetailChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const CONFIG = {
            updateInterval: 120000, // 120 seconds
            correlationWindow: 60, // 60 days
            historicalPeriod: 180, // 180 days for historical trends
            divergenceThreshold: 0.3 // Correlation difference threshold
        };

        // Asset definitions
        const ASSETS = [
            { symbol: 'SPY', name: 'S&P 500', class: 'Equity', color: '#0096FF' },
            { symbol: 'QQQ', name: 'NASDAQ 100', class: 'Equity', color: '#00D9FF' },
            { symbol: 'TLT', name: '20Y Treasury', class: 'Bonds', color: '#00ff88' },
            { symbol: 'IEF', name: '7-10Y Treasury', class: 'Bonds', color: '#00cc70' },
            { symbol: 'GLD', name: 'Gold', class: 'Commodity', color: '#FFD700' },
            { symbol: 'USO', name: 'Oil', class: 'Commodity', color: '#FF8C00' },
            { symbol: 'UUP', name: 'US Dollar', class: 'Currency', color: '#DC143C' },
            { symbol: 'FXE', name: 'Euro', class: 'Currency', color: '#FF6B6B' },
            { symbol: 'VNQ', name: 'Real Estate', class: 'Real Estate', color: '#FF5252' }
        ];

        // Global data storage
        let marketData = {};
        let correlationMatrix = {};
        let charts = {};

        // Utility: Calculate Pearson correlation coefficient
        function calculateCorrelation(x, y) {
            if (x.length !== y.length || x.length === 0) return 0;

            const n = x.length;
            const sumX = x.reduce((a, b) => a + b, 0);
            const sumY = y.reduce((a, b) => a + b, 0);
            const sumXY = x.reduce((sum, xi, i) => sum + xi * y[i], 0);
            const sumX2 = x.reduce((sum, xi) => sum + xi * xi, 0);
            const sumY2 = y.reduce((sum, yi) => sum + yi * yi, 0);

            const numerator = (n * sumXY) - (sumX * sumY);
            const denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));

            if (denominator === 0) return 0;
            return numerator / denominator;
        }

        // Utility: Calculate percentage returns
        function calculateReturns(prices) {
            const returns = [];
            for (let i = 1; i < prices.length; i++) {
                if (prices[i - 1] !== 0) {
                    returns.push((prices[i] - prices[i - 1]) / prices[i - 1]);
                }
            }
            return returns;
        }

        // Utility: Normalize prices to 100 at start
        function normalizePrices(prices) {
            if (prices.length === 0) return [];
            const basePrice = prices[0];
            return prices.map(price => (price / basePrice) * 100);
        }

        // Utility: Get color for correlation value
        function getCorrelationColor(correlation) {
            if (correlation > 0) {
                const intensity = Math.abs(correlation) * 255;
                return `rgba(0, 255, 136, ${Math.abs(correlation) * 0.8})`;
            } else {
                const intensity = Math.abs(correlation) * 255;
                return `rgba(255, 82, 82, ${Math.abs(correlation) * 0.8})`;
            }
        }

        // Utility: Get correlation strength label
        function getCorrelationStrength(correlation) {
            const abs = Math.abs(correlation);
            if (abs >= 0.8) return 'Very Strong';
            if (abs >= 0.6) return 'Strong';
            if (abs >= 0.4) return 'Moderate';
            if (abs >= 0.2) return 'Weak';
            return 'Very Weak';
        }

        // Fetch data from yfinance API via Python backend
        async function fetchYahooFinanceData(symbol, period = '6mo') {
            try {
                // Since we're in a static HTML environment, we'll use a CORS proxy
                // In production, this should call your backend API
                const corsProxy = 'https://api.allorigins.win/raw?url=';
                const yahooUrl = `http://localhost:5002/api/yahoo/chart/${symbol}?interval=1d&range=${period}`;

                const response = await fetch(corsProxy + encodeURIComponent(yahooUrl));
                const data = await response.json();

                if (data.chart && data.chart.result && data.chart.result[0]) {
                    const result = data.chart.result[0];
                    const timestamps = result.timestamp;
                    const prices = result.indicators.quote[0].close;

                    // Filter out null values
                    const validData = timestamps.map((ts, i) => ({
                        date: new Date(ts * 1000),
                        price: prices[i]
                    })).filter(d => d.price !== null && d.price !== undefined);

                    return {
                        symbol: symbol,
                        dates: validData.map(d => d.date),
                        prices: validData.map(d => d.price)
                    };
                }
                throw new Error('Invalid data format');
            } catch (error) {
                console.error(`Error fetching data for ${symbol}:`, error);
                return null;
            }
        }

        // Fetch all market data
        async function fetchAllMarketData() {
            console.log('Fetching market data for all assets...');

            const promises = ASSETS.map(asset => fetchYahooFinanceData(asset.symbol, '6mo'));
            const results = await Promise.all(promises);

            results.forEach((data, index) => {
                if (data && data.prices.length > 0) {
                    marketData[ASSETS[index].symbol] = data;
                }
            });

            console.log('Market data fetched:', Object.keys(marketData));
            return Object.keys(marketData).length > 0;
        }

        // Calculate all correlations
        function calculateAllCorrelations() {
            correlationMatrix = {};

            ASSETS.forEach(asset1 => {
                if (!marketData[asset1.symbol]) return;

                correlationMatrix[asset1.symbol] = {};

                ASSETS.forEach(asset2 => {
                    if (!marketData[asset2.symbol]) return;

                    // Get returns for both assets
                    const returns1 = calculateReturns(marketData[asset1.symbol].prices.slice(-CONFIG.correlationWindow));
                    const returns2 = calculateReturns(marketData[asset2.symbol].prices.slice(-CONFIG.correlationWindow));

                    // Calculate correlation
                    const correlation = calculateCorrelation(returns1, returns2);
                    correlationMatrix[asset1.symbol][asset2.symbol] = correlation;
                });
            });

            console.log('Correlation matrix calculated:', correlationMatrix);
        }

        // Render correlation matrix grid
        function renderCorrelationMatrix() {
            const grid = document.getElementById('correlationGrid');
            grid.innerHTML = '';

            const availableAssets = ASSETS.filter(a => marketData[a.symbol]);

            availableAssets.forEach(asset1 => {
                availableAssets.forEach(asset2 => {
                    const correlation = correlationMatrix[asset1.symbol]?.[asset2.symbol] || 0;

                    const cell = document.createElement('div');
                    cell.className = 'correlation-cell';
                    cell.style.background = getCorrelationColor(correlation);
                    cell.style.color = Math.abs(correlation) > 0.5 ? '#000' : '#fff';

                    cell.innerHTML = `
                        <div class="correlation-label">${asset1.symbol}/${asset2.symbol}</div>
                        <div class="correlation-value">${correlation.toFixed(2)}</div>
                    `;

                    cell.title = `${asset1.name} vs ${asset2.name}: ${correlation.toFixed(3)}`;

                    grid.appendChild(cell);
                });
            });

            document.getElementById('correlationMatrixSection').style.display = 'block';
        }

        // Render normalized price chart
        function renderNormalizedChart() {
            const ctx = document.getElementById('normalizedChart').getContext('2d');

            const datasets = ASSETS.filter(a => marketData[a.symbol]).map(asset => {
                const data = marketData[asset.symbol];
                const normalizedPrices = normalizePrices(data.prices);

                return {
                    label: `${asset.name} (${asset.symbol})`,
                    data: normalizedPrices,
                    borderColor: asset.color,
                    backgroundColor: asset.color + '20',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.1,
                    pointRadius: 0,
                    pointHoverRadius: 5
                };
            });

            const labels = marketData[ASSETS[0].symbol]?.dates.map(d =>
                d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })
            ) || [];

            if (charts.normalized) {
                charts.normalized.destroy();
            }

            charts.normalized = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#ecf0f1',
                                font: { size: 11 }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(18, 32, 58, 0.95)',
                            titleColor: '#DC143C',
                            bodyColor: '#ecf0f1',
                            borderColor: '#1e3a5f',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#b0b8c8', maxRotation: 45, minRotation: 45 },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Normalized Value (Base = 100)',
                                color: '#DC143C'
                            },
                            ticks: { color: '#b0b8c8' },
                            grid: { color: '#1e3a5f' }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });

            document.getElementById('normalizedChartSection').style.display = 'block';
        }

        // Render risk-on/risk-off meter
        function renderRiskMeter() {
            // Calculate SPY/TLT correlation (classic risk-on/risk-off indicator)
            const spyTltCorr = correlationMatrix['SPY']?.['TLT'] || 0;

            // Scale correlation to meter position (0-100%)
            // Negative correlation = risk on, Positive = risk off
            const meterPosition = ((spyTltCorr + 1) / 2) * 100; // -1 to 1 mapped to 0 to 100

            document.getElementById('meterIndicator').style.left = `${meterPosition}%`;

            let riskLabel, riskColor, explanation;
            if (spyTltCorr < -0.3) {
                riskLabel = 'STRONG RISK-ON';
                riskColor = '#00ff88';
                explanation = 'Stocks and bonds moving in opposite directions. Market favoring growth assets.';
            } else if (spyTltCorr < -0.1) {
                riskLabel = 'RISK-ON';
                riskColor = '#00cc70';
                explanation = 'Moderate negative correlation. Investors showing appetite for risk.';
            } else if (spyTltCorr < 0.1) {
                riskLabel = 'NEUTRAL';
                riskColor = '#ff9500';
                explanation = 'Low correlation between stocks and bonds. Mixed market sentiment.';
            } else if (spyTltCorr < 0.3) {
                riskLabel = 'RISK-OFF';
                riskColor = '#FF5252';
                explanation = 'Stocks and bonds moving together. Flight to safety beginning.';
            } else {
                riskLabel = 'STRONG RISK-OFF';
                riskColor = '#DC143C';
                explanation = 'Strong positive correlation. Major flight to safety in progress.';
            }

            document.getElementById('riskLabel').textContent = riskLabel;
            document.getElementById('riskLabel').style.color = riskColor;
            document.getElementById('riskExplanation').innerHTML = `
                <strong>SPY/TLT Correlation:</strong> ${spyTltCorr.toFixed(3)}<br>
                ${explanation}
            `;

            document.getElementById('riskMeterSection').style.display = 'block';
        }

        // Render top correlations table
        function renderCorrelationsTable() {
            const pairs = [];

            ASSETS.forEach(asset1 => {
                ASSETS.forEach(asset2 => {
                    if (asset1.symbol >= asset2.symbol) return; // Avoid duplicates

                    const corr = correlationMatrix[asset1.symbol]?.[asset2.symbol];
                    if (corr !== undefined) {
                        pairs.push({
                            asset1: asset1,
                            asset2: asset2,
                            correlation: corr
                        });
                    }
                });
            });

            // Sort by absolute correlation
            pairs.sort((a, b) => Math.abs(b.correlation) - Math.abs(a.correlation));

            // Top positive correlations
            const positiveCorrs = pairs.filter(p => p.correlation > 0).slice(0, 5);
            const posTable = document.getElementById('positiveCorrelationsTable');
            posTable.innerHTML = positiveCorrs.map(p => `
                <tr>
                    <td>
                        <span class="asset-pill asset-${p.asset1.class.toLowerCase().replace(' ', '')}">${p.asset1.symbol}</span>
                        <span style="color: var(--text-muted); margin: 0 8px;">√ó</span>
                        <span class="asset-pill asset-${p.asset2.class.toLowerCase().replace(' ', '')}">${p.asset2.symbol}</span>
                    </td>
                    <td><span class="status-positive">+${p.correlation.toFixed(3)}</span></td>
                    <td>${getCorrelationStrength(p.correlation)}</td>
                </tr>
            `).join('');

            // Top negative correlations
            const negativeCorrs = pairs.filter(p => p.correlation < 0).slice(0, 5);
            const negTable = document.getElementById('negativeCorrelationsTable');
            negTable.innerHTML = negativeCorrs.map(p => `
                <tr>
                    <td>
                        <span class="asset-pill asset-${p.asset1.class.toLowerCase().replace(' ', '')}">${p.asset1.symbol}</span>
                        <span style="color: var(--text-muted); margin: 0 8px;">√ó</span>
                        <span class="asset-pill asset-${p.asset2.class.toLowerCase().replace(' ', '')}">${p.asset2.symbol}</span>
                    </td>
                    <td><span class="status-negative">${p.correlation.toFixed(3)}</span></td>
                    <td>${getCorrelationStrength(p.correlation)}</td>
                </tr>
            `).join('');

            document.getElementById('correlationsTableSection').style.display = 'block';
        }

        // Render leading/lagging indicators
        function renderLeadingLagging() {
            const grid = document.getElementById('leadingLaggingGrid');

            // Calculate average absolute correlation for each asset (measure of influence)
            const influences = ASSETS.filter(a => marketData[a.symbol]).map(asset => {
                const correlations = Object.values(correlationMatrix[asset.symbol] || {})
                    .filter(c => !isNaN(c));

                const avgAbsCorr = correlations.reduce((sum, c) => sum + Math.abs(c), 0) / correlations.length;

                // Calculate momentum (price change over last 30 days)
                const prices = marketData[asset.symbol].prices;
                const momentum = ((prices[prices.length - 1] - prices[prices.length - 30]) / prices[prices.length - 30]) * 100;

                return {
                    asset: asset,
                    influence: avgAbsCorr,
                    momentum: momentum,
                    isLeading: avgAbsCorr > 0.5 && Math.abs(momentum) > 2
                };
            });

            // Sort by influence
            influences.sort((a, b) => b.influence - a.influence);

            grid.innerHTML = influences.map(item => `
                <div class="indicator-card">
                    <div class="indicator-header">
                        <div class="indicator-title">${item.asset.name}</div>
                        <div class="indicator-badge badge-${item.isLeading ? 'leading' : 'lagging'}">
                            ${item.isLeading ? 'Leading' : 'Lagging'}
                        </div>
                    </div>
                    <div class="asset-pill asset-${item.asset.class.toLowerCase().replace(' ', '')}">${item.asset.symbol}</div>
                    <div class="indicator-value ${item.momentum > 0 ? 'status-positive' : 'status-negative'}">
                        ${item.momentum > 0 ? '+' : ''}${item.momentum.toFixed(2)}%
                    </div>
                    <div class="indicator-description">
                        Avg. correlation strength: <strong>${item.influence.toFixed(3)}</strong><br>
                        ${item.isLeading ? 'Strong momentum and high correlation - likely leading market moves' :
                          'Lower correlation or momentum - following market trends'}
                    </div>
                </div>
            `).join('');

            document.getElementById('leadingLaggingSection').style.display = 'block';
        }

        // Render individual correlation charts
        function renderIndividualCharts() {
            // SPY vs TLT
            if (marketData['SPY'] && marketData['TLT']) {
                renderPairChart('spyTltChart', 'SPY', 'TLT');
            }

            // GLD vs UUP
            if (marketData['GLD'] && marketData['UUP']) {
                renderPairChart('gldUupChart', 'GLD', 'UUP');
            }

            document.getElementById('individualChartsSection').style.display = 'block';
        }

        function renderPairChart(canvasId, symbol1, symbol2) {
            const ctx = document.getElementById(canvasId).getContext('2d');

            const asset1 = ASSETS.find(a => a.symbol === symbol1);
            const asset2 = ASSETS.find(a => a.symbol === symbol2);

            const data1 = normalizePrices(marketData[symbol1].prices);
            const data2 = normalizePrices(marketData[symbol2].prices);
            const labels = marketData[symbol1].dates.map(d =>
                d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })
            );

            const correlation = correlationMatrix[symbol1]?.[symbol2] || 0;

            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }

            charts[canvasId] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: `${asset1.name} (${symbol1})`,
                            data: data1,
                            borderColor: asset1.color,
                            backgroundColor: asset1.color + '20',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.1,
                            pointRadius: 0,
                            yAxisID: 'y'
                        },
                        {
                            label: `${asset2.name} (${symbol2})`,
                            data: data2,
                            borderColor: asset2.color,
                            backgroundColor: asset2.color + '20',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.1,
                            pointRadius: 0,
                            yAxisID: 'y'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: { color: '#ecf0f1' }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(18, 32, 58, 0.95)',
                            titleColor: '#DC143C',
                            bodyColor: '#ecf0f1',
                            borderColor: '#1e3a5f',
                            borderWidth: 1
                        },
                        title: {
                            display: true,
                            text: `Correlation: ${correlation.toFixed(3)} (${getCorrelationStrength(correlation)})`,
                            color: '#DC143C',
                            font: { size: 14, weight: 'bold' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#b0b8c8', maxRotation: 45, minRotation: 45 },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            type: 'linear',
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Normalized Price (Base = 100)',
                                color: '#DC143C'
                            },
                            ticks: { color: '#b0b8c8' },
                            grid: { color: '#1e3a5f' }
                        }
                    }
                }
            });
        }

        // Calculate and render divergences
        function renderDivergences() {
            const divergencesList = document.getElementById('divergencesList');
            const divergences = [];

            // Calculate 6-month average correlations
            ASSETS.forEach(asset1 => {
                ASSETS.forEach(asset2 => {
                    if (asset1.symbol >= asset2.symbol) return;

                    const currentCorr = correlationMatrix[asset1.symbol]?.[asset2.symbol];
                    if (currentCorr === undefined) return;

                    // Calculate historical correlation (using full 180 days)
                    const returns1Full = calculateReturns(marketData[asset1.symbol].prices);
                    const returns2Full = calculateReturns(marketData[asset2.symbol].prices);
                    const historicalCorr = calculateCorrelation(returns1Full, returns2Full);

                    const diff = Math.abs(currentCorr - historicalCorr);

                    if (diff > CONFIG.divergenceThreshold) {
                        divergences.push({
                            asset1: asset1,
                            asset2: asset2,
                            current: currentCorr,
                            historical: historicalCorr,
                            difference: diff,
                            direction: currentCorr > historicalCorr ? 'strengthening' : 'weakening'
                        });
                    }
                });
            });

            if (divergences.length === 0) {
                divergencesList.innerHTML = `
                    <div class="alert-box alert-info">
                        <div class="alert-icon">‚úì</div>
                        <div class="alert-content">
                            <h4>No Significant Divergences</h4>
                            <p>All correlations are within normal ranges compared to 6-month averages.</p>
                        </div>
                    </div>
                `;
            } else {
                divergences.sort((a, b) => b.difference - a.difference);

                divergencesList.innerHTML = divergences.map(d => `
                    <div class="alert-box alert-warning">
                        <div class="alert-icon">‚ö†Ô∏è</div>
                        <div class="alert-content">
                            <h4>
                                <span class="asset-pill asset-${d.asset1.class.toLowerCase().replace(' ', '')}">${d.asset1.symbol}</span>
                                vs
                                <span class="asset-pill asset-${d.asset2.class.toLowerCase().replace(' ', '')}">${d.asset2.symbol}</span>
                            </h4>
                            <p>
                                <strong>Current correlation:</strong> ${d.current.toFixed(3)} |
                                <strong>6-month average:</strong> ${d.historical.toFixed(3)} |
                                <strong>Change:</strong> ${(d.difference * 100).toFixed(1)}%
                            </p>
                            <p style="margin-top: 8px;">
                                Relationship is <strong style="color: var(--warning-color);">${d.direction}</strong>
                                significantly compared to historical norm.
                            </p>
                        </div>
                    </div>
                `).join('');
            }

            document.getElementById('divergencesSection').style.display = 'block';
        }

        // Render historical correlation trends
        function renderHistoricalTrends() {
            const ctx = document.getElementById('historicalCorrelationChart').getContext('2d');

            // Calculate rolling correlations for key pairs over time
            const keyPairs = [
                { s1: 'SPY', s2: 'TLT', label: 'SPY/TLT (Equity/Bond)', color: '#0096FF' },
                { s1: 'GLD', s2: 'UUP', label: 'GLD/UUP (Gold/Dollar)', color: '#FFD700' },
                { s1: 'SPY', s2: 'VNQ', label: 'SPY/VNQ (Equity/RealEstate)', color: '#FF5252' },
                { s1: 'USO', s2: 'UUP', label: 'USO/UUP (Oil/Dollar)', color: '#FF8C00' }
            ];

            const datasets = keyPairs.map(pair => {
                if (!marketData[pair.s1] || !marketData[pair.s2]) return null;

                const returns1 = calculateReturns(marketData[pair.s1].prices);
                const returns2 = calculateReturns(marketData[pair.s2].prices);

                // Calculate rolling 30-day correlations
                const rollingCorrs = [];
                const window = 30;

                for (let i = window; i < returns1.length; i++) {
                    const subset1 = returns1.slice(i - window, i);
                    const subset2 = returns2.slice(i - window, i);
                    rollingCorrs.push(calculateCorrelation(subset1, subset2));
                }

                return {
                    label: pair.label,
                    data: rollingCorrs,
                    borderColor: pair.color,
                    backgroundColor: pair.color + '20',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.3,
                    pointRadius: 0,
                    pointHoverRadius: 4
                };
            }).filter(d => d !== null);

            const labels = marketData['SPY'].dates.slice(31).map(d =>
                d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })
            );

            if (charts.historical) {
                charts.historical.destroy();
            }

            charts.historical = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: { color: '#ecf0f1' }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(18, 32, 58, 0.95)',
                            titleColor: '#DC143C',
                            bodyColor: '#ecf0f1',
                            borderColor: '#1e3a5f',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#b0b8c8', maxRotation: 45, minRotation: 45 },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '30-Day Rolling Correlation',
                                color: '#DC143C'
                            },
                            ticks: { color: '#b0b8c8' },
                            grid: { color: '#1e3a5f' },
                            min: -1,
                            max: 1
                        }
                    }
                }
            });

            document.getElementById('historicalSection').style.display = 'block';
        }

        // ========== NEW ADVANCED INTERMARKET VISUALIZATION FUNCTIONS ==========

        // Render Macro Mechanism Section
        function renderMacroMechanismSection() {
            // Intermarket Capital Flow Chart (Horizontal Bar)
            const flowCtx = document.getElementById('intermarketFlowChart').getContext('2d');

            // Calculate real 7-day capital flows based on actual price changes
            const calculateFlowStrength = (symbol, days = 7) => {
                if (!marketData[symbol]) return 0;
                const prices = marketData[symbol].prices;
                if (prices.length < days) return 0;

                const recentPrices = prices.slice(-days);
                const pctChange = ((recentPrices[recentPrices.length - 1] - recentPrices[0]) / recentPrices[0]) * 100;

                // Scale to -100 to +100 range
                return Math.max(-100, Math.min(100, pctChange * 10));
            };

            const flowData = {
                'GLD': calculateFlowStrength('GLD', 7),      // Silver (using Gold as proxy if no SLV)
                'QQQ': calculateFlowStrength('QQQ', 7),      // Tech Futures
                'GLD': calculateFlowStrength('GLD', 7),      // Gold
                'USO': calculateFlowStrength('USO', 7),      // Copper (using Oil as proxy)
                'UUP': calculateFlowStrength('UUP', 7) * -1, // Cash (inverse Dollar)
                'TLT': calculateFlowStrength('TLT', 7) * -1, // Bonds (inverse)
                'USO': calculateFlowStrength('USO', 7)       // Oil
            };

            if (charts.intermarketFlow) charts.intermarketFlow.destroy();

            charts.intermarketFlow = new Chart(flowCtx, {
                type: 'bar',
                data: {
                    labels: ['Silver (Risk)', 'Tech Futures', 'Gold (Safety)', 'Copper', 'Cash (USD)', 'Bonds (TLT)', 'Oil'],
                    datasets: [{
                        label: '7-Day Capital Flow Strength',
                        data: Object.values(flowData),
                        backgroundColor: (ctx) => {
                            const v = ctx.raw;
                            if (v > 70) return '#bc13fe'; // Hot/Extreme
                            if (v > 0) return '#00ff88';  // Positive inflow
                            return '#DC143C';             // Outflow
                        },
                        borderRadius: 4,
                        borderWidth: 0
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(18, 32, 58, 0.95)',
                            titleColor: '#DC143C',
                            bodyColor: '#ecf0f1',
                            borderColor: '#1e3a5f',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: '#1e3a5f' },
                            ticks: {
                                color: '#b0b8c8',
                                callback: v => v > 0 ? '+' + v : v
                            }
                        },
                        y: {
                            grid: { color: '#1e3a5f' },
                            ticks: { color: '#b0b8c8' }
                        }
                    }
                }
            });

            document.getElementById('macroMechanismSection').style.display = 'block';
        }

        // Render Futures & Bonds Section
        function renderFuturesBondsSection() {
            // S&P 500 Futures (using SPY as proxy)
            if (marketData['SPY']) {
                const futuresCtx = document.getElementById('futuresDeepDiveChart').getContext('2d');
                const spyPrices = marketData['SPY'].prices.slice(-7);
                const labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Mon', 'Tue'].slice(0, spyPrices.length);

                if (charts.futuresDeepDive) charts.futuresDeepDive.destroy();

                charts.futuresDeepDive = new Chart(futuresCtx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'S&P 500 Futures (SPY)',
                            data: spyPrices,
                            borderColor: '#00ff88',
                            backgroundColor: 'rgba(0, 255, 136, 0.1)',
                            fill: true,
                            tension: 0.3,
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(18, 32, 58, 0.95)',
                                titleColor: '#DC143C',
                                bodyColor: '#ecf0f1'
                            }
                        },
                        scales: {
                            x: { ticks: { color: '#b0b8c8' }, grid: { color: '#1e3a5f' } },
                            y: {
                                ticks: { color: '#b0b8c8' },
                                grid: { color: '#1e3a5f' }
                            }
                        }
                    }
                });
            }

            // Bonds (10Y Yield - TLT inverted)
            if (marketData['TLT']) {
                const bondsCtx = document.getElementById('bondsDeepDiveChart').getContext('2d');
                const tltPrices = marketData['TLT'].prices.slice(-7);
                const labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Mon', 'Tue'].slice(0, tltPrices.length);

                if (charts.bondsDeepDive) charts.bondsDeepDive.destroy();

                charts.bondsDeepDive = new Chart(bondsCtx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '10Y Yield (TLT Price)',
                            data: tltPrices,
                            borderColor: '#DC143C',
                            borderDash: [5, 5],
                            borderWidth: 2,
                            tension: 0.1,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(18, 32, 58, 0.95)',
                                titleColor: '#DC143C',
                                bodyColor: '#ecf0f1'
                            }
                        },
                        scales: {
                            x: { ticks: { color: '#b0b8c8' }, grid: { color: '#1e3a5f' } },
                            y: {
                                title: { display: true, text: 'Price ($)', color: '#DC143C' },
                                ticks: { color: '#b0b8c8' },
                                grid: { color: '#1e3a5f' }
                            }
                        }
                    }
                });
            }

            document.getElementById('futuresBondsSection').style.display = 'block';
        }

        // Render Precious Metals Section
        function renderPreciousMetalsSection() {
            // Gold Chart (Bar + Line mix)
            if (marketData['GLD']) {
                const goldCtx = document.getElementById('goldDetailChart').getContext('2d');
                const goldPrices = marketData['GLD'].prices.slice(-5);
                const labels = ['Wk1', 'Wk2', 'Wk3', 'Last Wk', 'Curr Wk'].slice(0, goldPrices.length);

                if (charts.goldDetail) charts.goldDetail.destroy();

                charts.goldDetail = new Chart(goldCtx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Gold Price',
                            data: goldPrices,
                            borderColor: '#FFD700',
                            backgroundColor: 'rgba(255, 215, 0, 0.2)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(18, 32, 58, 0.95)',
                                titleColor: '#FFD700',
                                bodyColor: '#ecf0f1'
                            }
                        },
                        scales: {
                            x: { display: false },
                            y: { display: false }
                        }
                    }
                });
            }

            // Silver Chart (Area - explosive)
            if (marketData['GLD']) { // Using GLD as proxy since SLV may not be in dataset
                const silverCtx = document.getElementById('silverDetailChart').getContext('2d');
                const silverPrices = marketData['GLD'].prices.slice(-7).map(p => p * 0.015); // Approximate silver/gold ratio
                const labels = ['D1', 'D2', 'D3', 'D4', 'D5', 'D6', 'D7'].slice(0, silverPrices.length);

                if (charts.silverDetail) charts.silverDetail.destroy();

                charts.silverDetail = new Chart(silverCtx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Silver Momentum',
                            data: silverPrices,
                            borderColor: '#00f3ff',
                            backgroundColor: 'rgba(0, 243, 255, 0.2)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(18, 32, 58, 0.95)',
                                titleColor: '#00f3ff',
                                bodyColor: '#ecf0f1'
                            }
                        },
                        scales: {
                            x: { display: false },
                            y: { display: false }
                        }
                    }
                });
            }

            // Platinum Chart (Lagging line)
            if (marketData['GLD']) {
                const platinumCtx = document.getElementById('platinumDetailChart').getContext('2d');
                const platinumPrices = marketData['GLD'].prices.slice(-7).map(p => p * 0.5); // Approx platinum price
                const labels = ['D1', 'D2', 'D3', 'D4', 'D5', 'D6', 'D7'].slice(0, platinumPrices.length);

                if (charts.platinumDetail) charts.platinumDetail.destroy();

                charts.platinumDetail = new Chart(platinumCtx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Platinum',
                            data: platinumPrices,
                            borderColor: '#94a3b8',
                            borderWidth: 1,
                            pointRadius: 0,
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: 'rgba(18, 32, 58, 0.95)',
                                titleColor: '#94a3b8',
                                bodyColor: '#ecf0f1'
                            }
                        },
                        scales: {
                            x: { display: false },
                            y: { display: false }
                        }
                    }
                });
            }

            document.getElementById('preciousMetalsSection').style.display = 'block';
        }

        // Render Industrial & Energy Section
        function renderIndustrialEnergySection() {
            // Copper Radar Chart (Dr. Copper components)
            const copperCtx = document.getElementById('copperDetailChart').getContext('2d');

            if (charts.copperDetail) charts.copperDetail.destroy();

            charts.copperDetail = new Chart(copperCtx, {
                type: 'radar',
                data: {
                    labels: ['China Stimulus', 'Green Demand', 'Mine Supply', 'Global PMI', 'Inventory'],
                    datasets: [{
                        label: 'Bullish Factors',
                        data: [80, 90, 40, 30, 50],
                        borderColor: '#f97316',
                        backgroundColor: 'rgba(249, 115, 22, 0.2)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(18, 32, 58, 0.95)',
                            titleColor: '#f97316',
                            bodyColor: '#ecf0f1'
                        }
                    },
                    scales: {
                        r: {
                            angleLines: { color: '#1e3a5f' },
                            grid: { color: '#1e3a5f' },
                            pointLabels: {
                                color: '#b0b8c8',
                                font: { size: 10 }
                            },
                            ticks: { color: '#b0b8c8' }
                        }
                    }
                }
            });

            // Oil Doughnut Chart (Supply/Demand factors)
            const oilCtx = document.getElementById('oilDetailChart').getContext('2d');

            if (charts.oilDetail) charts.oilDetail.destroy();

            charts.oilDetail = new Chart(oilCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Bearish: Non-OPEC Supply', 'Bearish: Weak Demand', 'Bullish: Geopolitics'],
                    datasets: [{
                        data: [45, 35, 20],
                        backgroundColor: ['#DC143C', '#991b1b', '#00ff88'],
                        borderWidth: 0,
                        cutout: '70%'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: '#ecf0f1',
                                boxWidth: 10,
                                font: { size: 10 }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(18, 32, 58, 0.95)',
                            titleColor: '#DC143C',
                            bodyColor: '#ecf0f1'
                        }
                    }
                }
            });

            document.getElementById('industrialEnergySection').style.display = 'block';
        }

        // ========== END NEW VISUALIZATION FUNCTIONS ==========

        // Update timestamp
        function updateTimestamp() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });

            const oldestDate = marketData['SPY']?.dates[0];
            const newestDate = marketData['SPY']?.dates[marketData['SPY'].dates.length - 1];

            if (oldestDate && newestDate) {
                document.getElementById('dataPeriod').textContent =
                    `${oldestDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${newestDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`;
            }

            document.getElementById('updateInfo').style.display = 'block';
        }

        // Main initialization function
        async function initializeDashboard() {
            console.log('Initializing Intermarket Relationships Dashboard...');

            try {
                // Fetch data
                const success = await fetchAllMarketData();

                if (!success) {
                    throw new Error('Failed to fetch market data');
                }

                // Calculate correlations
                calculateAllCorrelations();

                // Hide loading indicator
                document.getElementById('loadingIndicator').style.display = 'none';

                // Render all components
                updateTimestamp();
                renderRiskMeter();
                renderCorrelationMatrix();
                renderNormalizedChart();
                renderCorrelationsTable();
                renderLeadingLagging();
                renderIndividualCharts();
                renderDivergences();
                renderHistoricalTrends();

                // Render NEW advanced intermarket sections
                renderMacroMechanismSection();
                renderFuturesBondsSection();
                renderPreciousMetalsSection();
                renderIndustrialEnergySection();

                console.log('Dashboard initialized successfully');

            } catch (error) {
                console.error('Error initializing dashboard:', error);
                document.getElementById('loadingIndicator').innerHTML = `
                    <div class="error-message">
                        <h3>‚ö†Ô∏è Data Unavailable</h3>
                        <p>Unable to fetch market data. This may be due to API rate limits or network issues.</p>
                        <p style="margin-top: 15px; font-size: 0.9rem;">
                            The dashboard will attempt to reload in ${CONFIG.updateInterval / 1000} seconds.
                        </p>
                    </div>
                `;
            }
        }

        // Auto-refresh function
        function startAutoRefresh() {
            setInterval(() => {
                console.log('Auto-refreshing data...');
                initializeDashboard();
            }, CONFIG.updateInterval);
        }

        // Start dashboard on page load
        window.addEventListener('DOMContentLoaded', () => {
            initializeDashboard();
            startAutoRefresh();
        });
    </script>
</body>
</html>
