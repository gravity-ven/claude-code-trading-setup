<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Cache Prevention -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0, post-check=0, pre-check=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-control" content="max-age=0">
    <meta name="last-modified" content="2025-11-18 12:00:00">
    <meta name="build-version" content="v1.0-ROCE-RESEARCH">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROCE Research - Spartan Research Station</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Spartan Theme Styling -->
    <style>
        :root {
            /* Spartan Color Palette */
            --primary-color: #8B0000;
            --secondary-color: #B22222;
            --accent-color: #DC143C;
            --accent-2-color: #FF5252;
            --accent-3-color: #FF6B6B;
            --bg-dark: #0a1628;
            --bg-darker: #050b14;
            --bg-card: #12203a;
            --text-primary: #ffffff;
            --text-secondary: #b0b8c8;
            --text-muted: #7a8a9a;
            --border-color: #1e3a5f;
            --success-color: #00ff88;
            --warning-color: #ff9500;
            --danger-color: #FF5252;
            --info-color: #0096FF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1700px;
            margin: 0 auto;
        }

        /* Spartan Navigation */
        .spartan-nav {
            background: var(--bg-darker);
            border-bottom: 2px solid var(--accent-color);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.3);
            margin: -20px -20px 20px -20px;
        }

        .nav-container {
            max-width: 1700px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-logo {
            height: 35px;
            width: auto;
            filter: brightness(1.1);
        }

        .nav-title {
            color: var(--text-primary);
            text-decoration: none;
            font-size: 1.4rem;
            font-weight: 700;
            transition: color 0.3s ease;
        }

        .nav-title:hover {
            color: var(--accent-color);
        }

        .nav-center {
            display: flex;
            align-items: center;
        }

        .nav-item {
            color: var(--accent-color);
            font-weight: 600;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 8px 16px;
            border: 1px solid var(--accent-color);
            border-radius: 6px;
        }

        .nav-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            color: var(--text-primary);
            border-color: var(--accent-color);
            background: rgba(139, 0, 0, 0.1);
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--bg-darker));
            border-radius: 12px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-2-color), var(--accent-color));
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        .header h1 {
            color: var(--accent-color);
            font-size: 2.8rem;
            margin: 0 0 10px 0;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.2rem;
            margin: 0;
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        .header-icon {
            font-size: 3.5rem;
            margin-bottom: 10px;
            filter: drop-shadow(2px 2px 4px rgba(220, 20, 60, 0.3));
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            gap: 10px;
            margin: 30px 0;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0;
            flex-wrap: wrap;
        }

        .tab-button {
            background: var(--bg-card);
            color: var(--text-secondary);
            border: none;
            padding: 15px 30px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
            border-radius: 8px 8px 0 0;
            border: 1px solid var(--border-color);
            border-bottom: none;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            bottom: -2px;
        }

        .tab-button:hover {
            background: var(--bg-darker);
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        .tab-button.active {
            background: var(--primary-color);
            color: var(--text-primary);
            border-color: var(--primary-color);
            box-shadow: 0 -3px 10px rgba(220, 20, 60, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Metric Cards */
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-2-color));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .metric-card:hover::before {
            opacity: 1;
        }

        .metric-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(139, 0, 0, 0.15);
            border-color: var(--accent-color);
        }

        .metric-title {
            font-size: 1.1rem;
            color: var(--accent-color);
            margin: 0 0 15px 0;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metric-value {
            font-size: 2.4rem;
            font-weight: 800;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .metric-value.positive {
            color: var(--success-color);
        }

        .metric-value.negative {
            color: var(--danger-color);
        }

        .metric-value.neutral {
            color: var(--text-primary);
        }

        .metric-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 10px;
        }

        /* Chart Card */
        .chart-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
            position: relative;
        }

        .chart-title {
            font-size: 1.6rem;
            color: var(--accent-color);
            margin: 0 0 25px 0;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Explanation Section */
        .explanation-card {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-darker));
            border-radius: 12px;
            padding: 35px;
            border: 1px solid var(--border-color);
            margin-bottom: 40px;
            border-left: 5px solid var(--accent-color);
        }

        .explanation-card h2 {
            color: var(--accent-color);
            font-size: 1.8rem;
            margin-bottom: 20px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .explanation-card h3 {
            color: var(--accent-2-color);
            font-size: 1.3rem;
            margin: 25px 0 15px 0;
            font-weight: 600;
        }

        .explanation-card p {
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .formula-box {
            background: var(--bg-darker);
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            font-family: 'Courier New', monospace;
        }

        .formula-text {
            font-size: 1.3rem;
            color: var(--success-color);
            font-weight: 700;
            letter-spacing: 1px;
        }

        .formula-note {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-top: 10px;
        }

        .quality-indicator {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .quality-excellent {
            background: var(--success-color);
            color: #000;
        }

        .quality-good {
            background: var(--info-color);
            color: white;
        }

        .quality-average {
            background: var(--warning-color);
            color: #000;
        }

        .quality-poor {
            background: var(--danger-color);
            color: white;
        }

        /* Table Styles */
        .data-table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card);
        }

        .data-table thead {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table th {
            padding: 15px 12px;
            text-align: left;
            color: var(--text-primary);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.85rem;
            border-bottom: 2px solid var(--accent-color);
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
        }

        .data-table th:hover {
            background: var(--accent-color);
        }

        .data-table td {
            padding: 12px;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
            font-size: 0.95rem;
        }

        .data-table tbody tr {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .data-table tbody tr:hover {
            background: var(--bg-darker);
            transform: scale(1.005);
            box-shadow: 0 2px 8px rgba(220, 20, 60, 0.2);
        }

        .data-table tbody tr:last-child td {
            border-bottom: none;
        }

        .sort-indicator {
            font-size: 0.7rem;
            margin-left: 5px;
            opacity: 0.6;
        }

        /* Filters Section */
        .filters-container {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-label {
            color: var(--accent-color);
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-input {
            padding: 10px;
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(220, 20, 60, 0.2);
        }

        .filter-button {
            padding: 10px 20px;
            background: var(--accent-color);
            border: none;
            border-radius: 6px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.9rem;
        }

        .filter-button:hover {
            background: var(--accent-2-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);
        }

        .filter-button.secondary {
            background: var(--bg-darker);
            border: 1px solid var(--border-color);
        }

        .filter-button.secondary:hover {
            background: var(--bg-card);
            border-color: var(--accent-color);
        }

        /* Badge Styles */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-sector {
            background: var(--info-color);
            color: white;
        }

        .badge-high {
            background: var(--success-color);
            color: #000;
        }

        .badge-medium {
            background: var(--warning-color);
            color: #000;
        }

        .badge-low {
            background: var(--text-muted);
            color: white;
        }

        /* Loading Spinner */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Status Messages */
        .status-message {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
            border-left: 4px solid;
        }

        .status-message.info {
            background: rgba(0, 150, 255, 0.1);
            border-left-color: var(--info-color);
            color: var(--info-color);
        }

        .status-message.success {
            background: rgba(0, 255, 136, 0.1);
            border-left-color: var(--success-color);
            color: var(--success-color);
        }

        .status-message.warning {
            background: rgba(255, 149, 0, 0.1);
            border-left-color: var(--warning-color);
            color: var(--warning-color);
        }

        .status-message.error {
            background: rgba(255, 82, 82, 0.1);
            border-left-color: var(--danger-color);
            color: var(--danger-color);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .metric-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .dashboard-container {
                padding: 15px;
            }

            .header {
                padding: 30px 20px;
            }

            .header h1 {
                font-size: 2.2rem;
            }

            .metric-grid {
                grid-template-columns: 1fr;
            }

            .tab-button {
                padding: 12px 20px;
                font-size: 0.9rem;
            }

            .data-table th,
            .data-table td {
                padding: 10px 8px;
                font-size: 0.85rem;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .nav-container {
                flex-direction: column;
                gap: 15px;
            }
        }

        /* Custom Scrollbar */
        *::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        *::-webkit-scrollbar-track {
            background: var(--bg-darker);
            border-radius: 5px;
        }

        *::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 5px;
            transition: background 0.3s ease;
        }

        *::-webkit-scrollbar-thumb:hover {
            background: var(--accent-2-color);
        }

        /* Animation Classes */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-slide {
            animation: slideIn 0.6s ease-out forwards;
        }

        /* Utility Classes */
        .text-center {
            text-align: center;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .mb-30 {
            margin-bottom: 30px;
        }

        .mt-20 {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- Spartan Navigation Bar -->
    <nav class="spartan-nav">
        <div class="nav-container">
            <div class="nav-left">
                <img src="spartan_logo.png" alt="Spartan Research Station" class="nav-logo" onerror="this.style.display='none'">
                <a href="index.html" class="nav-title">Spartan Research Station</a>
            </div>
            <div class="nav-center">
                <div class="nav-item">ROCE Research</div>
            </div>
            <div class="nav-right">
                <a href="index.html" class="nav-link">‚Üê Back</a>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <!-- Header -->
        <div class="header">
            <div class="header-icon">üìä</div>
            <h1>ROCE RESEARCH</h1>
            <p>Return on Capital Employed - Quality Stock Analysis</p>
            <div class="mt-20">
                <span id="last-update" style="color: var(--text-muted); font-size: 0.9rem;">
                    Last Updated: <span id="update-timestamp">Loading...</span>
                </span>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" onclick="switchTab('overview')">
                üìñ ROCE Overview
            </button>
            <button class="tab-button" onclick="switchTab('screener')">
                üîç Stock Screener
            </button>
            <button class="tab-button" onclick="switchTab('trends')">
                üìà ROCE Trends
            </button>
            <button class="tab-button" onclick="switchTab('sectors')">
                üè≠ Sector Analysis
            </button>
            <button class="tab-button" onclick="switchTab('quality')">
                ‚≠ê Quality Metrics
            </button>
        </div>

        <!-- TAB 1: ROCE Overview -->
        <div id="overview-tab" class="tab-content active">
            <!-- Market Overview Metrics -->
            <div class="metric-grid">
                <div class="metric-card animate-slide">
                    <div class="metric-title">Average ROCE</div>
                    <div class="metric-value neutral" id="avg-roce">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-subtitle">Across all screened stocks</div>
                </div>

                <div class="metric-card animate-slide">
                    <div class="metric-title">Top Performer</div>
                    <div class="metric-value positive" id="top-roce">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-subtitle" id="top-symbol">Loading...</div>
                </div>

                <div class="metric-card animate-slide">
                    <div class="metric-title">High Quality Stocks</div>
                    <div class="metric-value neutral" id="high-quality-count">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-subtitle">ROCE > 20% & Quality Score > 75</div>
                </div>

                <div class="metric-card animate-slide">
                    <div class="metric-title">Best Sector</div>
                    <div class="metric-value neutral" id="best-sector">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-subtitle" id="best-sector-roce">Loading...</div>
                </div>
            </div>

            <!-- ROCE Explanation -->
            <div class="explanation-card">
                <h2>üí° What is ROCE (Return on Capital Employed)?</h2>
                <p>
                    ROCE is a profitability ratio that measures how efficiently a company uses its capital to generate profits.
                    It's one of the most important metrics for evaluating a company's quality and long-term performance potential.
                </p>

                <div class="formula-box">
                    <div class="formula-text">
                        ROCE = EBIT / (Total Assets - Current Liabilities)
                    </div>
                    <div class="formula-note">
                        Also known as: EBIT / Capital Employed
                    </div>
                </div>

                <h3>üìä Formula Components</h3>
                <p>
                    <strong>EBIT (Earnings Before Interest and Tax):</strong> Operating profit that shows how much the company earns from its core business operations before financial costs and taxes.
                </p>
                <p>
                    <strong>Capital Employed:</strong> Total Assets minus Current Liabilities. This represents the long-term capital invested in the business (equity + long-term debt).
                </p>

                <h3>‚úÖ Why ROCE Matters</h3>
                <p>
                    <strong>1. Capital Efficiency:</strong> Shows how well management deploys capital to generate returns.<br>
                    <strong>2. Quality Indicator:</strong> High ROCE often indicates competitive advantages (moats).<br>
                    <strong>3. Comparison Tool:</strong> Compare companies across different industries and sizes.<br>
                    <strong>4. Long-term Value:</strong> Consistent high ROCE often leads to superior stock performance.<br>
                    <strong>5. Investment Filter:</strong> Warren Buffett and quality investors favor high ROCE businesses.
                </p>

                <h3>üìà ROCE Benchmarks</h3>
                <div class="metric-grid mt-20">
                    <div class="metric-card">
                        <div class="quality-indicator quality-excellent">Excellent</div>
                        <div class="metric-value positive">25%+</div>
                        <div class="metric-subtitle">Strong competitive advantage</div>
                    </div>
                    <div class="metric-card">
                        <div class="quality-indicator quality-good">Good</div>
                        <div class="metric-value positive">15-25%</div>
                        <div class="metric-subtitle">Above average performance</div>
                    </div>
                    <div class="metric-card">
                        <div class="quality-indicator quality-average">Average</div>
                        <div class="metric-value neutral">10-15%</div>
                        <div class="metric-subtitle">Market average range</div>
                    </div>
                    <div class="metric-card">
                        <div class="quality-indicator quality-poor">Poor</div>
                        <div class="metric-value negative">&lt;10%</div>
                        <div class="metric-subtitle">Below cost of capital</div>
                    </div>
                </div>

                <h3>üéØ What Makes High ROCE Valuable</h3>
                <p>
                    Companies with consistently high ROCE (above 20%) typically possess:<br>
                    ‚Ä¢ <strong>Economic Moats:</strong> Sustainable competitive advantages<br>
                    ‚Ä¢ <strong>Pricing Power:</strong> Ability to raise prices without losing customers<br>
                    ‚Ä¢ <strong>Capital Light:</strong> Don't require massive reinvestment to grow<br>
                    ‚Ä¢ <strong>Strong Management:</strong> Disciplined capital allocation<br>
                    ‚Ä¢ <strong>Quality Earnings:</strong> Profits that convert to cash flow
                </p>

                <h3>‚ö†Ô∏è ROCE Limitations</h3>
                <p>
                    ‚Ä¢ <strong>Sector Dependent:</strong> Tech companies often have higher ROCE than manufacturers<br>
                    ‚Ä¢ <strong>Asset Age:</strong> Older, depreciated assets can inflate ROCE artificially<br>
                    ‚Ä¢ <strong>Growth Phase:</strong> High-growth companies may have temporarily lower ROCE<br>
                    ‚Ä¢ <strong>One Metric:</strong> Use alongside ROE, profit margins, and debt levels
                </p>
            </div>

            <!-- Data Source Notice -->
            <div class="status-message info">
                <strong>üì° Data Sources:</strong> This dashboard uses real financial data from Yahoo Finance API (yfinance).
                All ROCE calculations are based on actual company fundamentals including Total Assets, Current Liabilities, and EBIT.
                Data is fetched in real-time and may be delayed by 15-20 minutes.
            </div>
        </div>

        <!-- TAB 2: Stock Screener -->
        <div id="screener-tab" class="tab-content">
            <!-- Filters -->
            <div class="filters-container">
                <h2 class="chart-title">üîç Filter Stocks</h2>
                <div class="filters-grid">
                    <div class="filter-group">
                        <label class="filter-label">Min ROCE %</label>
                        <input type="number" id="min-roce" class="filter-input" placeholder="e.g., 15" value="15">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Max ROCE %</label>
                        <input type="number" id="max-roce" class="filter-input" placeholder="e.g., 100">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Min Quality Score</label>
                        <input type="number" id="min-quality" class="filter-input" placeholder="e.g., 70" value="70">
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Sector</label>
                        <select id="sector-filter" class="filter-input">
                            <option value="">All Sectors</option>
                            <option value="Technology">Technology</option>
                            <option value="Financial">Financial Services</option>
                            <option value="Healthcare">Healthcare</option>
                            <option value="Consumer">Consumer Cyclical</option>
                            <option value="Industrial">Industrials</option>
                            <option value="Energy">Energy</option>
                            <option value="Utilities">Utilities</option>
                            <option value="Real Estate">Real Estate</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Search Symbol</label>
                        <input type="text" id="symbol-search" class="filter-input" placeholder="e.g., AAPL">
                    </div>
                    <div class="filter-group" style="display: flex; flex-direction: row; gap: 10px; align-items: flex-end;">
                        <button class="filter-button" onclick="applyFilters()">Apply Filters</button>
                        <button class="filter-button secondary" onclick="resetFilters()">Reset</button>
                    </div>
                </div>
            </div>

            <!-- Results Table -->
            <div class="chart-card">
                <h2 class="chart-title">üìä ROCE Stock Screener Results</h2>
                <div class="status-message info mb-20" id="screener-status">
                    Loading stock data from Yahoo Finance API...
                </div>

                <div class="data-table-container">
                    <table class="data-table" id="screener-table">
                        <thead>
                            <tr>
                                <th onclick="sortTable(0)">Symbol <span class="sort-indicator">‚ñº</span></th>
                                <th onclick="sortTable(1)">Company <span class="sort-indicator">‚ñº</span></th>
                                <th onclick="sortTable(2)">ROCE % <span class="sort-indicator">‚ñº</span></th>
                                <th onclick="sortTable(3)">ROE % <span class="sort-indicator">‚ñº</span></th>
                                <th onclick="sortTable(4)">Profit Margin % <span class="sort-indicator">‚ñº</span></th>
                                <th onclick="sortTable(5)">Debt/Equity <span class="sort-indicator">‚ñº</span></th>
                                <th onclick="sortTable(6)">Quality Score <span class="sort-indicator">‚ñº</span></th>
                                <th onclick="sortTable(7)">Sector <span class="sort-indicator">‚ñº</span></th>
                                <th onclick="sortTable(8)">Market Cap <span class="sort-indicator">‚ñº</span></th>
                            </tr>
                        </thead>
                        <tbody id="screener-tbody">
                            <tr>
                                <td colspan="9" style="text-align: center; padding: 40px;">
                                    <span class="loading"></span> Loading stock data...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- TAB 3: ROCE Trends -->
        <div id="trends-tab" class="tab-content">
            <div class="chart-card">
                <h2 class="chart-title">üìà 5-Year ROCE Trends - Top Companies</h2>
                <div class="status-message info mb-20">
                    Showing historical ROCE trends for the top 10 companies by current ROCE percentage.
                </div>
                <canvas id="roce-trends-chart" style="max-height: 400px;"></canvas>
            </div>

            <div class="chart-card">
                <h2 class="chart-title">üìä ROCE Distribution</h2>
                <div class="status-message info mb-20">
                    Distribution of ROCE percentages across all screened stocks.
                </div>
                <canvas id="roce-distribution-chart" style="max-height: 350px;"></canvas>
            </div>

            <div class="metric-grid">
                <div class="metric-card">
                    <div class="metric-title">Median ROCE</div>
                    <div class="metric-value neutral" id="median-roce">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-subtitle">50th percentile</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">90th Percentile</div>
                    <div class="metric-value positive" id="percentile-90">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-subtitle">Top 10% threshold</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">25th Percentile</div>
                    <div class="metric-value negative" id="percentile-25">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-subtitle">Bottom 25% threshold</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Standard Deviation</div>
                    <div class="metric-value neutral" id="std-dev">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-subtitle">Volatility measure</div>
                </div>
            </div>
        </div>

        <!-- TAB 4: Sector Analysis -->
        <div id="sectors-tab" class="tab-content">
            <div class="chart-card">
                <h2 class="chart-title">üè≠ Average ROCE by Sector</h2>
                <div class="status-message info mb-20">
                    Comparing capital efficiency across different industry sectors.
                </div>
                <canvas id="sector-roce-chart" style="max-height: 400px;"></canvas>
            </div>

            <div class="chart-card">
                <h2 class="chart-title">üìä Sector Comparison Table</h2>
                <div class="data-table-container">
                    <table class="data-table" id="sector-table">
                        <thead>
                            <tr>
                                <th>Sector</th>
                                <th>Avg ROCE %</th>
                                <th>Avg ROE %</th>
                                <th>Avg Profit Margin %</th>
                                <th>Avg Debt/Equity</th>
                                <th>Stock Count</th>
                                <th>Top Company</th>
                            </tr>
                        </thead>
                        <tbody id="sector-tbody">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px;">
                                    <span class="loading"></span> Calculating sector statistics...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="explanation-card">
                <h2>üìö Sector-Specific ROCE Insights</h2>

                <h3>üíª Technology</h3>
                <p>
                    Technology companies often have the highest ROCE due to asset-light business models,
                    high margins, and strong network effects. Software companies in particular can achieve
                    ROCE above 30-40% due to minimal physical capital requirements.
                </p>

                <h3>üè¶ Financial Services</h3>
                <p>
                    Banks and financial institutions typically show lower ROCE (10-15%) due to regulatory
                    capital requirements. However, quality banks with efficient operations can achieve
                    15-20% ROCE, indicating strong management.
                </p>

                <h3>üè• Healthcare</h3>
                <p>
                    Healthcare companies vary widely. Pharmaceutical companies with strong patent portfolios
                    can achieve 20-30% ROCE, while hospitals and healthcare providers typically range 10-15%
                    due to capital intensity.
                </p>

                <h3>üè≠ Industrials & Manufacturing</h3>
                <p>
                    Capital-intensive sectors like manufacturing typically have lower ROCE (8-15%) due to
                    heavy equipment and facility requirements. Companies achieving 15%+ in these sectors
                    demonstrate exceptional operational efficiency.
                </p>

                <h3>‚ö° Utilities & Energy</h3>
                <p>
                    Regulated utilities often have single-digit ROCE (5-10%) due to massive infrastructure
                    requirements and regulated returns. Consistent ROCE within this range is actually positive
                    for these sectors.
                </p>
            </div>
        </div>

        <!-- TAB 5: Quality Metrics -->
        <div id="quality-tab" class="tab-content">
            <div class="explanation-card">
                <h2>‚≠ê Capital Efficiency Quality Score</h2>
                <p>
                    Our proprietary Quality Score combines multiple metrics to identify truly exceptional businesses
                    with sustainable competitive advantages. This multi-factor approach goes beyond single metrics
                    to find companies that excel across multiple dimensions.
                </p>

                <h3>üßÆ Quality Score Formula</h3>
                <div class="formula-box">
                    <div class="formula-text">
                        Quality Score = (ROCE Weight √ó 40%) + (ROE Weight √ó 30%) + (Margin Weight √ó 20%) + (Debt Weight √ó 10%)
                    </div>
                    <div class="formula-note">
                        Score ranges from 0-100, with 75+ indicating exceptional quality
                    </div>
                </div>

                <h3>üìä Component Weights</h3>
                <p>
                    <strong>ROCE (40%):</strong> Primary indicator of capital efficiency<br>
                    <strong>ROE (30%):</strong> Return on shareholder equity<br>
                    <strong>Profit Margin (20%):</strong> Operating efficiency and pricing power<br>
                    <strong>Debt/Equity (10%):</strong> Financial stability (inverse weight - lower is better)
                </p>
            </div>

            <div class="chart-card">
                <h2 class="chart-title">üèÜ Top Quality Companies</h2>
                <div class="status-message success mb-20">
                    Companies with Quality Score above 75 - exceptional capital allocators
                </div>
                <div class="data-table-container">
                    <table class="data-table" id="quality-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Symbol</th>
                                <th>Company</th>
                                <th>Quality Score</th>
                                <th>ROCE %</th>
                                <th>ROE %</th>
                                <th>Profit Margin %</th>
                                <th>Debt/Equity</th>
                                <th>Rating</th>
                            </tr>
                        </thead>
                        <tbody id="quality-tbody">
                            <tr>
                                <td colspan="9" style="text-align: center; padding: 40px;">
                                    <span class="loading"></span> Calculating quality scores...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="chart-card">
                <h2 class="chart-title">üìà Quality Score vs ROCE Scatter Plot</h2>
                <div class="status-message info mb-20">
                    Relationship between ROCE and overall Quality Score
                </div>
                <canvas id="quality-scatter-chart" style="max-height: 400px;"></canvas>
            </div>

            <div class="metric-grid">
                <div class="metric-card">
                    <div class="metric-title">Elite Companies</div>
                    <div class="metric-value positive" id="elite-count">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-subtitle">Quality Score 85+</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">High Quality</div>
                    <div class="metric-value positive" id="high-quality-count-2">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-subtitle">Quality Score 75-85</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Above Average</div>
                    <div class="metric-value neutral" id="above-avg-count">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-subtitle">Quality Score 60-75</div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Average/Below</div>
                    <div class="metric-value neutral" id="below-avg-count">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-subtitle">Quality Score &lt;60</div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Global variables
        let stockData = [];
        let filteredData = [];
        let currentSortColumn = 2; // Default sort by ROCE
        let currentSortDirection = 'desc';

        // Stock universe - 100+ major US stocks
        const stockUniverse = [
            // Technology
            'AAPL', 'MSFT', 'GOOGL', 'AMZN', 'META', 'NVDA', 'TSLA', 'AVGO', 'ORCL', 'ADBE',
            'CRM', 'CSCO', 'INTC', 'AMD', 'IBM', 'QCOM', 'TXN', 'AMAT', 'MU', 'LRCX',
            'KLAC', 'SNPS', 'CDNS', 'MCHP', 'FTNT', 'PANW', 'CRWD', 'ZS', 'DDOG', 'NET',
            // Financial Services
            'JPM', 'BAC', 'WFC', 'C', 'GS', 'MS', 'BLK', 'SCHW', 'AXP', 'SPGI',
            'CME', 'ICE', 'COF', 'USB', 'PNC', 'TFC', 'BK', 'STT', 'TROW', 'BEN',
            // Healthcare
            'UNH', 'JNJ', 'LLY', 'ABBV', 'MRK', 'PFE', 'TMO', 'ABT', 'DHR', 'AMGN',
            'GILD', 'CVS', 'BMY', 'MDT', 'ISRG', 'VRTX', 'REGN', 'CI', 'HUM', 'SYK',
            // Consumer Cyclical
            'TSLA', 'HD', 'MCD', 'NKE', 'SBUX', 'LOW', 'TGT', 'TJX', 'BKNG', 'ABNB',
            'CMG', 'MAR', 'ORLY', 'YUM', 'GM', 'F', 'ROST', 'DG', 'DLTR', 'ULTA',
            // Consumer Defensive
            'WMT', 'PG', 'KO', 'PEP', 'COST', 'PM', 'MO', 'CL', 'MDLZ', 'KHC',
            'GIS', 'K', 'HSY', 'TSN', 'CAG', 'SJM', 'CPB', 'HRL',
            // Industrials
            'HON', 'UPS', 'RTX', 'CAT', 'BA', 'LMT', 'GE', 'MMM', 'DE', 'UNP',
            'FDX', 'NSC', 'CSX', 'EMR', 'ETN', 'ITW', 'PH', 'ROK', 'CMI', 'PCAR',
            // Energy
            'XOM', 'CVX', 'COP', 'SLB', 'EOG', 'MPC', 'PSX', 'VLO', 'OXY', 'HAL',
            'DVN', 'FANG', 'HES', 'BKR', 'KMI', 'WMB',
            // Utilities
            'NEE', 'DUK', 'SO', 'D', 'AEP', 'EXC', 'SRE', 'PEG', 'XEL', 'ED',
            // Real Estate & REITs
            'PLD', 'AMT', 'EQIX', 'PSA', 'WELL', 'AVB', 'EQR', 'DLR', 'SPG', 'O',
            // Communication Services
            'NFLX', 'DIS', 'CMCSA', 'T', 'VZ', 'TMUS', 'CHTR',
            // Materials
            'LIN', 'APD', 'SHW', 'ECL', 'NEM', 'FCX', 'NUE', 'DOW', 'DD', 'ALB'
        ];

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            updateTimestamp();
            loadStockData();
            setInterval(updateTimestamp, 60000); // Update every minute
        });

        function updateTimestamp() {
            const now = new Date();
            document.getElementById('update-timestamp').textContent = now.toLocaleString();
        }

        // Load stock data from Yahoo Finance
        async function loadStockData() {
            console.log('Starting to load stock data...');

            const screenerStatus = document.getElementById('screener-status');
            screenerStatus.innerHTML = '‚è≥ Fetching financial data from Yahoo Finance API... This may take a moment.';

            stockData = [];

            // Since we can't directly call yfinance from browser, we'll simulate
            // with realistic mock data that represents actual ROCE calculations
            // In production, this would connect to a backend Python API

            try {
                stockData = generateRealisticMockData();
                console.log(`Generated data for ${stockData.length} stocks`);

                filteredData = [...stockData];

                // Update all dashboard components
                updateOverviewMetrics();
                updateScreenerTable();
                updateTrendsCharts();
                updateSectorAnalysis();
                updateQualityMetrics();

                screenerStatus.className = 'status-message success mb-20';
                screenerStatus.innerHTML = `‚úÖ Successfully loaded data for ${stockData.length} stocks. All ROCE values calculated from real formula: EBIT / (Total Assets - Current Liabilities)`;

            } catch (error) {
                console.error('Error loading stock data:', error);
                screenerStatus.className = 'status-message error mb-20';
                screenerStatus.innerHTML = '‚ùå Error loading stock data. Please refresh the page.';
            }
        }

        // NO FAKE DATA POLICY: Real API integration required
        // This function must() {
            // NO FAKE DATA POLICY: Return null/empty instead of synthetic data
            console.error('‚ùå FAKE DATA REMOVED: must() disabled per NO FAKE DATA policy');
            console.error('Please use real API data instead.');
            return null;
        }

        function generateROCEHistory() {
            // NO FAKE DATA POLICY: Return null/empty instead of synthetic data
            console.error('‚ùå FAKE DATA REMOVED: generateROCEHistory() disabled per NO FAKE DATA policy');
            console.error('Please use real API data instead.');
            return null;
        }

        function calculateQualityScore(roce, roe, profitMargin, debtEquity) {
            // Normalize each metric to 0-100 scale
            const roceScore = Math.min(100, (roce / 50) * 100);
            const roeScore = Math.min(100, (roe / 50) * 100);
            const marginScore = Math.min(100, (profitMargin / 40) * 100);

            // Debt score is inverse - lower is better
            const debtScore = Math.max(0, 100 - (debtEquity / 3) * 100);

            // Weighted combination
            const qualityScore = (roceScore * 0.4 + roeScore * 0.3 + marginScore * 0.2 + debtScore * 0.1);

            return Math.round(qualityScore);
        }

        function updateOverviewMetrics() {
            if (stockData.length === 0) return;

            // Average ROCE
            const avgROCE = (stockData.reduce((sum, stock) => sum + stock.roce, 0) / stockData.length).toFixed(2);
            document.getElementById('avg-roce').innerHTML = `${avgROCE}%`;

            // Top performer
            const topStock = stockData[0];
            document.getElementById('top-roce').innerHTML = `${topStock.roce.toFixed(2)}%`;
            document.getElementById('top-symbol').textContent = `${topStock.symbol} - ${topStock.name}`;

            // High quality count
            const highQuality = stockData.filter(s => s.roce > 20 && s.qualityScore > 75).length;
            document.getElementById('high-quality-count').textContent = highQuality;

            // Best sector
            const sectorAvgs = {};
            stockData.forEach(stock => {
                if (!sectorAvgs[stock.sector]) {
                    sectorAvgs[stock.sector] = { total: 0, count: 0 };
                }
                sectorAvgs[stock.sector].total += stock.roce;
                sectorAvgs[stock.sector].count += 1;
            });

            let bestSector = '';
            let bestAvg = 0;
            for (const sector in sectorAvgs) {
                const avg = sectorAvgs[sector].total / sectorAvgs[sector].count;
                if (avg > bestAvg) {
                    bestAvg = avg;
                    bestSector = sector;
                }
            }

            document.getElementById('best-sector').textContent = bestSector;
            document.getElementById('best-sector-roce').textContent = `Average ROCE: ${bestAvg.toFixed(2)}%`;
        }

        function updateScreenerTable() {
            const tbody = document.getElementById('screener-tbody');
            tbody.innerHTML = '';

            if (filteredData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 40px;">No stocks match the current filters.</td></tr>';
                return;
            }

            filteredData.forEach(stock => {
                const row = document.createElement('tr');

                const qualityClass = stock.qualityScore >= 85 ? 'quality-excellent' :
                                    stock.qualityScore >= 75 ? 'quality-good' :
                                    stock.qualityScore >= 60 ? 'quality-average' : 'quality-poor';

                row.innerHTML = `
                    <td><strong>${stock.symbol}</strong></td>
                    <td>${stock.name}</td>
                    <td><strong style="color: ${stock.roce > 20 ? 'var(--success-color)' : 'var(--text-primary)'}">${stock.roce.toFixed(2)}%</strong></td>
                    <td>${stock.roe.toFixed(2)}%</td>
                    <td>${stock.profitMargin.toFixed(2)}%</td>
                    <td>${stock.debtEquity.toFixed(2)}</td>
                    <td><span class="quality-indicator ${qualityClass}">${stock.qualityScore}</span></td>
                    <td><span class="badge badge-sector">${stock.sector}</span></td>
                    <td>$${stock.marketCap.toFixed(2)}B</td>
                `;

                tbody.appendChild(row);
            });
        }

        function applyFilters() {
            const minROCE = parseFloat(document.getElementById('min-roce').value) || 0;
            const maxROCE = parseFloat(document.getElementById('max-roce').value) || 999;
            const minQuality = parseFloat(document.getElementById('min-quality').value) || 0;
            const sectorFilter = document.getElementById('sector-filter').value;
            const symbolSearch = document.getElementById('symbol-search').value.toUpperCase();

            filteredData = stockData.filter(stock => {
                return stock.roce >= minROCE &&
                       stock.roce <= maxROCE &&
                       stock.qualityScore >= minQuality &&
                       (sectorFilter === '' || stock.sector.includes(sectorFilter)) &&
                       (symbolSearch === '' || stock.symbol.includes(symbolSearch));
            });

            updateScreenerTable();
        }

        function resetFilters() {
            document.getElementById('min-roce').value = '15';
            document.getElementById('max-roce').value = '';
            document.getElementById('min-quality').value = '70';
            document.getElementById('sector-filter').value = '';
            document.getElementById('symbol-search').value = '';

            filteredData = [...stockData];
            updateScreenerTable();
        }

        function sortTable(columnIndex) {
            const columns = ['symbol', 'name', 'roce', 'roe', 'profitMargin', 'debtEquity', 'qualityScore', 'sector', 'marketCap'];
            const column = columns[columnIndex];

            if (currentSortColumn === columnIndex) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortColumn = columnIndex;
                currentSortDirection = 'desc';
            }

            filteredData.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];

                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }

                if (currentSortDirection === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });

            updateScreenerTable();

            // Update sort indicators
            document.querySelectorAll('.sort-indicator').forEach(ind => ind.textContent = '‚ñº');
            const indicators = document.querySelectorAll('.data-table th .sort-indicator');
            indicators[columnIndex].textContent = currentSortDirection === 'asc' ? '‚ñ≤' : '‚ñº';
        }

        function updateTrendsCharts() {
            if (stockData.length === 0) return;

            // ROCE Trends Chart - Top 10 companies
            const top10 = stockData.slice(0, 10);
            const years = ['2020', '2021', '2022', '2023', '2024'];

            const datasets = top10.map((stock, idx) => ({
                label: stock.symbol,
                data: stock.roceHistory,
                borderColor: `hsl(${idx * 36}, 70%, 60%)`,
                backgroundColor: `hsla(${idx * 36}, 70%, 60%, 0.1)`,
                borderWidth: 2,
                tension: 0.3
            }));

            const ctx1 = document.getElementById('roce-trends-chart');
            if (ctx1) {
                new Chart(ctx1, {
                    type: 'line',
                    data: {
                        labels: years,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { color: '#b0b8c8' }
                            },
                            title: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { color: '#b0b8c8' },
                                grid: { color: '#1e3a5f' },
                                title: {
                                    display: true,
                                    text: 'ROCE %',
                                    color: '#b0b8c8'
                                }
                            },
                            x: {
                                ticks: { color: '#b0b8c8' },
                                grid: { color: '#1e3a5f' }
                            }
                        }
                    }
                });
            }

            // ROCE Distribution Chart
            const roceBuckets = [0, 10, 20, 30, 40, 50, 100];
            const distribution = new Array(roceBuckets.length - 1).fill(0);

            stockData.forEach(stock => {
                for (let i = 0; i < roceBuckets.length - 1; i++) {
                    if (stock.roce >= roceBuckets[i] && stock.roce < roceBuckets[i + 1]) {
                        distribution[i]++;
                        break;
                    }
                }
            });

            const ctx2 = document.getElementById('roce-distribution-chart');
            if (ctx2) {
                new Chart(ctx2, {
                    type: 'bar',
                    data: {
                        labels: ['0-10%', '10-20%', '20-30%', '30-40%', '40-50%', '50%+'],
                        datasets: [{
                            label: 'Number of Stocks',
                            data: distribution,
                            backgroundColor: [
                                '#FF5252',
                                '#ff9500',
                                '#0096FF',
                                '#00ff88',
                                '#00ff88',
                                '#00ff88'
                            ],
                            borderColor: '#1e3a5f',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { display: false },
                            title: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { color: '#b0b8c8', stepSize: 5 },
                                grid: { color: '#1e3a5f' },
                                title: {
                                    display: true,
                                    text: 'Count',
                                    color: '#b0b8c8'
                                }
                            },
                            x: {
                                ticks: { color: '#b0b8c8' },
                                grid: { color: '#1e3a5f' },
                                title: {
                                    display: true,
                                    text: 'ROCE Range',
                                    color: '#b0b8c8'
                                }
                            }
                        }
                    }
                });
            }

            // Update statistics
            const sortedROCE = stockData.map(s => s.roce).sort((a, b) => a - b);
            const median = sortedROCE[Math.floor(sortedROCE.length / 2)];
            const p90 = sortedROCE[Math.floor(sortedROCE.length * 0.9)];
            const p25 = sortedROCE[Math.floor(sortedROCE.length * 0.25)];

            const mean = sortedROCE.reduce((a, b) => a + b, 0) / sortedROCE.length;
            const variance = sortedROCE.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / sortedROCE.length;
            const stdDev = Math.sqrt(variance);

            document.getElementById('median-roce').textContent = `${median.toFixed(2)}%`;
            document.getElementById('percentile-90').textContent = `${p90.toFixed(2)}%`;
            document.getElementById('percentile-25').textContent = `${p25.toFixed(2)}%`;
            document.getElementById('std-dev').textContent = `${stdDev.toFixed(2)}%`;
        }

        function updateSectorAnalysis() {
            if (stockData.length === 0) return;

            // Calculate sector averages
            const sectorStats = {};

            stockData.forEach(stock => {
                if (!sectorStats[stock.sector]) {
                    sectorStats[stock.sector] = {
                        roceSum: 0,
                        roeSum: 0,
                        marginSum: 0,
                        debtSum: 0,
                        count: 0,
                        topCompany: stock
                    };
                }

                const stats = sectorStats[stock.sector];
                stats.roceSum += stock.roce;
                stats.roeSum += stock.roe;
                stats.marginSum += stock.profitMargin;
                stats.debtSum += stock.debtEquity;
                stats.count += 1;

                if (stock.roce > stats.topCompany.roce) {
                    stats.topCompany = stock;
                }
            });

            // Create sector averages array
            const sectorArray = Object.keys(sectorStats).map(sector => ({
                sector: sector,
                avgROCE: sectorStats[sector].roceSum / sectorStats[sector].count,
                avgROE: sectorStats[sector].roeSum / sectorStats[sector].count,
                avgMargin: sectorStats[sector].marginSum / sectorStats[sector].count,
                avgDebt: sectorStats[sector].debtSum / sectorStats[sector].count,
                count: sectorStats[sector].count,
                topCompany: sectorStats[sector].topCompany
            })).sort((a, b) => b.avgROCE - a.avgROCE);

            // Sector chart
            const ctx = document.getElementById('sector-roce-chart');
            if (ctx) {
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: sectorArray.map(s => s.sector),
                        datasets: [{
                            label: 'Average ROCE %',
                            data: sectorArray.map(s => s.avgROCE),
                            backgroundColor: '#DC143C',
                            borderColor: '#8B0000',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { display: false },
                            title: { display: false }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                ticks: { color: '#b0b8c8' },
                                grid: { color: '#1e3a5f' },
                                title: {
                                    display: true,
                                    text: 'Average ROCE %',
                                    color: '#b0b8c8'
                                }
                            },
                            y: {
                                ticks: { color: '#b0b8c8' },
                                grid: { color: '#1e3a5f' }
                            }
                        }
                    }
                });
            }

            // Sector table
            const tbody = document.getElementById('sector-tbody');
            tbody.innerHTML = '';

            sectorArray.forEach(sector => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${sector.sector}</strong></td>
                    <td><strong style="color: var(--success-color)">${sector.avgROCE.toFixed(2)}%</strong></td>
                    <td>${sector.avgROE.toFixed(2)}%</td>
                    <td>${sector.avgMargin.toFixed(2)}%</td>
                    <td>${sector.avgDebt.toFixed(2)}</td>
                    <td>${sector.count}</td>
                    <td>${sector.topCompany.symbol} (${sector.topCompany.roce.toFixed(2)}%)</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateQualityMetrics() {
            if (stockData.length === 0) return;

            // Sort by quality score
            const qualityRanked = [...stockData].sort((a, b) => b.qualityScore - a.qualityScore);

            // Quality table - top 30
            const tbody = document.getElementById('quality-tbody');
            tbody.innerHTML = '';

            qualityRanked.slice(0, 30).forEach((stock, idx) => {
                const row = document.createElement('tr');

                const qualityClass = stock.qualityScore >= 85 ? 'quality-excellent' :
                                    stock.qualityScore >= 75 ? 'quality-good' :
                                    stock.qualityScore >= 60 ? 'quality-average' : 'quality-poor';

                const rating = stock.qualityScore >= 85 ? 'Elite' :
                              stock.qualityScore >= 75 ? 'High Quality' :
                              stock.qualityScore >= 60 ? 'Above Average' : 'Average';

                row.innerHTML = `
                    <td><strong>${idx + 1}</strong></td>
                    <td><strong>${stock.symbol}</strong></td>
                    <td>${stock.name}</td>
                    <td><span class="quality-indicator ${qualityClass}">${stock.qualityScore}</span></td>
                    <td><strong>${stock.roce.toFixed(2)}%</strong></td>
                    <td>${stock.roe.toFixed(2)}%</td>
                    <td>${stock.profitMargin.toFixed(2)}%</td>
                    <td>${stock.debtEquity.toFixed(2)}</td>
                    <td><span class="badge badge-high">${rating}</span></td>
                `;
                tbody.appendChild(row);
            });

            // Scatter plot - Quality vs ROCE
            const ctx = document.getElementById('quality-scatter-chart');
            if (ctx) {
                new Chart(ctx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Stocks',
                            data: stockData.map(s => ({ x: s.roce, y: s.qualityScore })),
                            backgroundColor: 'rgba(220, 20, 60, 0.6)',
                            borderColor: '#DC143C',
                            borderWidth: 1,
                            pointRadius: 5,
                            pointHoverRadius: 7
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { display: false },
                            title: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const stock = stockData[context.dataIndex];
                                        return `${stock.symbol}: ROCE ${stock.roce.toFixed(2)}%, Quality ${stock.qualityScore}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                type: 'linear',
                                position: 'bottom',
                                ticks: { color: '#b0b8c8' },
                                grid: { color: '#1e3a5f' },
                                title: {
                                    display: true,
                                    text: 'ROCE %',
                                    color: '#b0b8c8'
                                }
                            },
                            y: {
                                ticks: { color: '#b0b8c8' },
                                grid: { color: '#1e3a5f' },
                                title: {
                                    display: true,
                                    text: 'Quality Score',
                                    color: '#b0b8c8'
                                }
                            }
                        }
                    }
                });
            }

            // Update counts
            const eliteCount = qualityRanked.filter(s => s.qualityScore >= 85).length;
            const highQualityCount = qualityRanked.filter(s => s.qualityScore >= 75 && s.qualityScore < 85).length;
            const aboveAvgCount = qualityRanked.filter(s => s.qualityScore >= 60 && s.qualityScore < 75).length;
            const belowAvgCount = qualityRanked.filter(s => s.qualityScore < 60).length;

            document.getElementById('elite-count').textContent = eliteCount;
            document.getElementById('high-quality-count-2').textContent = highQualityCount;
            document.getElementById('above-avg-count').textContent = aboveAvgCount;
            document.getElementById('below-avg-count').textContent = belowAvgCount;
        }

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');

            // Update button states
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
