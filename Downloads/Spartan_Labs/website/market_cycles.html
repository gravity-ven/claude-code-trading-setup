<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Cache Prevention -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0, post-check=0, pre-check=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-control" content="max-age=0">
    <meta name="last-modified" content="2025-11-18 12:00:00">
    <meta name="build-version" content="v1.0-MARKET-CYCLES">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Cycles - Spartan Research Station</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        :root {
            /* Spartan Color Palette */
            --primary-color: #8B0000;        /* Spartan Red */
            --secondary-color: #B22222;      /* Spartan Firebrick */
            --accent-color: #DC143C;         /* Spartan Crimson */
            --accent-2-color: #FF5252;       /* Bright Red */
            --accent-3-color: #FF6B6B;       /* Light Red */
            --bg-dark: #0a1628;              /* Main Background */
            --bg-darker: #050b14;            /* Darker Background */
            --bg-card: #12203a;              /* Card Background */
            --text-primary: #ffffff;         /* White Text */
            --text-secondary: #b0b8c8;       /* Gray Text */
            --text-muted: #7a8a9a;           /* Muted Gray */
            --border-color: #1e3a5f;         /* Border Color */
            --success-color: #00ff88;        /* Success Green */
            --warning-color: #ff9500;        /* Warning Orange */
            --danger-color: #FF5252;         /* Danger Red */
            --info-color: #0096FF;           /* Info Blue */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1700px;
            margin: 0 auto;
        }

        /* Spartan Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--bg-darker));
            border-radius: 12px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-2-color), var(--accent-color));
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        .header h1 {
            color: var(--accent-color);
            font-size: 2.8rem;
            margin: 0 0 10px 0;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.2rem;
            margin: 0;
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        .header-subtitle {
            margin-top: 15px;
            font-size: 0.95rem;
            color: var(--text-muted);
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
            animation: pulse 2s ease-in-out infinite;
        }

        .status-indicator.live {
            background: var(--success-color);
        }

        .status-indicator.pending {
            background: var(--warning-color);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Back Button */
        .back-nav {
            margin-bottom: 20px;
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            padding: 12px 24px;
            background: var(--primary-color);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);
        }

        /* Current Cycle Phase Card */
        .cycle-phase-card {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-darker));
            border-radius: 12px;
            padding: 40px;
            border: 2px solid var(--accent-color);
            margin-bottom: 40px;
            text-align: center;
            box-shadow: 0 8px 24px rgba(220, 20, 60, 0.3);
        }

        .cycle-phase-title {
            font-size: 1.8rem;
            color: var(--accent-color);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .cycle-phase-value {
            font-size: 3.5rem;
            font-weight: 800;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .cycle-phase-value.expansion {
            color: var(--success-color);
        }

        .cycle-phase-value.peak {
            color: var(--warning-color);
        }

        .cycle-phase-value.contraction {
            color: var(--danger-color);
        }

        .cycle-phase-value.trough {
            color: var(--info-color);
        }

        .cycle-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .cycle-detail-item {
            background: var(--bg-darker);
            padding: 15px;
            border-radius: 8px;
        }

        .cycle-detail-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .cycle-detail-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--info-color);
        }

        /* Metric Cards Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }

        .metric-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-2-color));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .metric-card:hover::before {
            opacity: 1;
        }

        .metric-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(139, 0, 0, 0.15);
            border-color: var(--accent-color);
        }

        .metric-title {
            font-size: 1.4rem;
            color: var(--accent-color);
            margin: 0 0 20px 0;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metric-value {
            font-size: 2.6rem;
            font-weight: 800;
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .metric-value.positive {
            color: var(--success-color);
        }

        .metric-value.negative {
            color: var(--danger-color);
        }

        .metric-value.neutral {
            color: var(--text-primary);
        }

        .metric-description {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-top: 10px;
            line-height: 1.5;
        }

        .metric-source {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-top: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Chart Cards */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(650px, 1fr));
            gap: 35px;
            margin-bottom: 50px;
        }

        .chart-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border-color);
            position: relative;
        }

        .chart-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, transparent 50%, var(--accent-color) 50%);
            border-radius: 0 12px 0 12px;
            opacity: 0.8;
        }

        .chart-title {
            font-size: 1.6rem;
            color: var(--accent-color);
            margin: 0 0 25px 0;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        /* Sector Rotation Clock */
        .sector-clock-container {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 40px;
            border: 1px solid var(--border-color);
            margin-bottom: 50px;
        }

        .sector-clock {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 600px;
            margin: 0 auto;
        }

        .sector-slice {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: 100% 100%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sector-slice:hover {
            transform: scale(1.05);
            z-index: 10;
        }

        .sector-label {
            position: absolute;
            font-weight: 600;
            font-size: 0.9rem;
            text-align: center;
            pointer-events: none;
        }

        /* Presidential Cycle */
        .presidential-cycle-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border-color);
            margin-bottom: 50px;
        }

        .cycle-years-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 25px;
        }

        .year-card {
            background: var(--bg-darker);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .year-card.active {
            border-color: var(--accent-color);
            box-shadow: 0 4px 12px rgba(220, 20, 60, 0.3);
        }

        .year-number {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .year-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .year-stats {
            margin-top: 15px;
        }

        .year-stat {
            margin: 8px 0;
            font-size: 0.85rem;
        }

        .year-stat-label {
            color: var(--text-muted);
        }

        .year-stat-value {
            font-weight: 700;
            margin-left: 5px;
        }

        /* Historical Cycles Table */
        .historical-cycles-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .historical-cycles-table th,
        .historical-cycles-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .historical-cycles-table th {
            background: var(--bg-darker);
            color: var(--accent-color);
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
        }

        .historical-cycles-table tr:hover {
            background: rgba(220, 20, 60, 0.05);
        }

        /* Cycle Strength Meter */
        .strength-meter {
            width: 100%;
            height: 40px;
            background: var(--bg-darker);
            border-radius: 20px;
            overflow: hidden;
            margin: 20px 0;
            position: relative;
        }

        .strength-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--danger-color), var(--warning-color), var(--success-color));
            border-radius: 20px;
            transition: width 1s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .strength-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(220, 20, 60, 0.3);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Strategy Cards */
        .strategy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .strategy-card {
            background: var(--bg-darker);
            border-radius: 8px;
            padding: 25px;
            border-left: 4px solid var(--accent-color);
        }

        .strategy-phase {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 15px;
        }

        .strategy-list {
            list-style: none;
            margin: 15px 0;
        }

        .strategy-list li {
            padding: 8px 0;
            color: var(--text-secondary);
            position: relative;
            padding-left: 20px;
        }

        .strategy-list li:before {
            content: '‚ñ∏';
            position: absolute;
            left: 0;
            color: var(--accent-color);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .charts-container,
            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .cycle-years-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .sector-clock {
                height: 400px;
            }
        }

        /* Tab Navigation */
        .tab-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 12px 24px;
            background: var(--bg-card);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab-button:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--accent-color);
        }

        .tab-button.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Back Navigation -->
        <div class="back-nav">
            <a href="index.html" class="back-btn">
                <span style="margin-right: 8px;">‚Üê</span> Back to Main Dashboard
            </a>
        </div>

        <!-- Spartan Header -->
        <div class="header">
            <h1>üîÑ MARKET CYCLES</h1>
            <p>Real-Time Economic and Market Cycle Tracking</p>
            <div class="header-subtitle">
                <span id="last-update">
                    <span class="status-indicator pending"></span>
                    Initializing dashboard...
                </span>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" onclick="switchTab('overview')">
                üìä Cycle Overview
            </button>
            <button class="tab-button" onclick="switchTab('presidential')">
                üó≥Ô∏è Presidential Cycle
            </button>
            <button class="tab-button" onclick="switchTab('sectors')">
                üîÑ Sector Rotation
            </button>
            <button class="tab-button" onclick="switchTab('historical')">
                üìà Historical Analysis
            </button>
            <button class="tab-button" onclick="switchTab('strategies')">
                üéØ Trading Strategies
            </button>
        </div>

        <!-- TAB 1: Cycle Overview -->
        <div id="overview-tab" class="tab-content active">
            <!-- Current Cycle Phase -->
            <div class="cycle-phase-card">
                <h2 class="cycle-phase-title">Current Economic Cycle Phase</h2>
                <div class="cycle-phase-value expansion" id="current-phase">
                    <span class="loading"></span>
                </div>
                <div class="cycle-details">
                    <div class="cycle-detail-item">
                        <div class="cycle-detail-label">Cycle Month</div>
                        <div class="cycle-detail-value" id="cycle-month">-</div>
                    </div>
                    <div class="cycle-detail-item">
                        <div class="cycle-detail-label">Cycle Duration</div>
                        <div class="cycle-detail-value" id="cycle-duration">-</div>
                    </div>
                    <div class="cycle-detail-item">
                        <div class="cycle-detail-label">Phase Strength</div>
                        <div class="cycle-detail-value" id="phase-strength">-</div>
                    </div>
                    <div class="cycle-detail-item">
                        <div class="cycle-detail-label">Next Phase Est.</div>
                        <div class="cycle-detail-value" id="next-phase">-</div>
                    </div>
                </div>
            </div>

            <!-- Economic Cycle Indicators -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <h3 class="metric-title">Leading Economic Index</h3>
                    <div class="metric-value neutral" id="lei-value">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-description" id="lei-description">
                        The Conference Board Leading Economic Index (LEI) predicts economic turning points.
                    </div>
                    <div class="metric-source">Source: FRED API (Real Economic Data)</div>
                </div>

                <div class="metric-card">
                    <h3 class="metric-title">Unemployment Rate</h3>
                    <div class="metric-value neutral" id="unemployment-value">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-description" id="unemployment-description">
                        Rising unemployment signals economic contraction; falling indicates expansion.
                    </div>
                    <div class="metric-source">Source: FRED API (U.S. Bureau of Labor Statistics)</div>
                </div>

                <div class="metric-card">
                    <h3 class="metric-title">Yield Curve Spread</h3>
                    <div class="metric-value neutral" id="yield-curve-value">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-description" id="yield-curve-description">
                        10Y-2Y Treasury spread. Inversion (negative) often precedes recession.
                    </div>
                    <div class="metric-source">Source: FRED API (U.S. Treasury)</div>
                </div>

                <div class="metric-card">
                    <h3 class="metric-title">GDP Growth Rate</h3>
                    <div class="metric-value neutral" id="gdp-value">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-description" id="gdp-description">
                        Real GDP growth rate (annualized). Strong positive growth indicates expansion.
                    </div>
                    <div class="metric-source">Source: FRED API (Bureau of Economic Analysis)</div>
                </div>

                <div class="metric-card">
                    <h3 class="metric-title">Industrial Production</h3>
                    <div class="metric-value neutral" id="industrial-value">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-description" id="industrial-description">
                        Year-over-year change in industrial production index.
                    </div>
                    <div class="metric-source">Source: FRED API (Federal Reserve)</div>
                </div>

                <div class="metric-card">
                    <h3 class="metric-title">Consumer Confidence</h3>
                    <div class="metric-value neutral" id="confidence-value">
                        <span class="loading"></span>
                    </div>
                    <div class="metric-description" id="confidence-description">
                        University of Michigan Consumer Sentiment Index.
                    </div>
                    <div class="metric-source">Source: FRED API (University of Michigan)</div>
                </div>
            </div>

            <!-- Cycle Strength Meter -->
            <div class="chart-card">
                <h2 class="chart-title">Economic Cycle Strength</h2>
                <div class="strength-meter">
                    <div class="strength-fill" id="strength-fill" style="width: 0%;">
                        <span id="strength-value">0%</span>
                    </div>
                </div>
                <div class="strength-labels">
                    <span>Deep Recession</span>
                    <span>Recession</span>
                    <span>Slowdown</span>
                    <span>Moderate Growth</span>
                    <span>Strong Expansion</span>
                </div>
                <div style="margin-top: 20px; color: var(--text-secondary); font-size: 0.95rem;">
                    Composite indicator based on GDP, unemployment, LEI, and industrial production.
                </div>
            </div>

            <!-- Market Cycle Charts -->
            <div class="charts-container">
                <div class="chart-card">
                    <h2 class="chart-title">SPY with Cycle Overlays</h2>
                    <div class="chart-wrapper">
                        <canvas id="spy-cycle-chart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2 class="chart-title">Economic Indicators Timeline</h2>
                    <div class="chart-wrapper">
                        <canvas id="indicators-timeline-chart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2 class="chart-title">Bull vs Bear Market Periods</h2>
                    <div class="chart-wrapper">
                        <canvas id="bull-bear-chart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2 class="chart-title">Cycle Phase Distribution</h2>
                    <div class="chart-wrapper">
                        <canvas id="phase-distribution-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: Presidential Cycle -->
        <div id="presidential-tab" class="tab-content">
            <div class="presidential-cycle-card">
                <h2 class="chart-title">4-Year Presidential Cycle Analysis</h2>
                <div style="color: var(--text-secondary); margin-bottom: 25px;">
                    Historical analysis shows distinct market patterns across presidential election cycles.
                    We are currently in <span id="current-cycle-year" style="color: var(--accent-color); font-weight: 700;">Year -</span> of the cycle.
                </div>

                <div class="cycle-years-grid">
                    <div class="year-card" id="year-1-card">
                        <div class="year-number" style="color: var(--info-color);">Year 1</div>
                        <div class="year-label">Post-Election</div>
                        <div class="year-stats">
                            <div class="year-stat">
                                <span class="year-stat-label">Avg Return:</span>
                                <span class="year-stat-value" style="color: var(--success-color);" id="year-1-return">+7.2%</span>
                            </div>
                            <div class="year-stat">
                                <span class="year-stat-label">Win Rate:</span>
                                <span class="year-stat-value" id="year-1-winrate">64%</span>
                            </div>
                            <div class="year-stat">
                                <span class="year-stat-label">Volatility:</span>
                                <span class="year-stat-value" id="year-1-vol">Medium</span>
                            </div>
                        </div>
                    </div>

                    <div class="year-card" id="year-2-card">
                        <div class="year-number" style="color: var(--warning-color);">Year 2</div>
                        <div class="year-label">Mid-Term</div>
                        <div class="year-stats">
                            <div class="year-stat">
                                <span class="year-stat-label">Avg Return:</span>
                                <span class="year-stat-value" style="color: var(--success-color);" id="year-2-return">+5.8%</span>
                            </div>
                            <div class="year-stat">
                                <span class="year-stat-label">Win Rate:</span>
                                <span class="year-stat-value" id="year-2-winrate">58%</span>
                            </div>
                            <div class="year-stat">
                                <span class="year-stat-label">Volatility:</span>
                                <span class="year-stat-value" id="year-2-vol">High</span>
                            </div>
                        </div>
                    </div>

                    <div class="year-card" id="year-3-card">
                        <div class="year-number" style="color: var(--success-color);">Year 3</div>
                        <div class="year-label">Pre-Election</div>
                        <div class="year-stats">
                            <div class="year-stat">
                                <span class="year-stat-label">Avg Return:</span>
                                <span class="year-stat-value" style="color: var(--success-color);" id="year-3-return">+16.3%</span>
                            </div>
                            <div class="year-stat">
                                <span class="year-stat-label">Win Rate:</span>
                                <span class="year-stat-value" id="year-3-winrate">88%</span>
                            </div>
                            <div class="year-stat">
                                <span class="year-stat-label">Volatility:</span>
                                <span class="year-stat-value" id="year-3-vol">Low</span>
                            </div>
                        </div>
                    </div>

                    <div class="year-card" id="year-4-card">
                        <div class="year-number" style="color: var(--accent-color);">Year 4</div>
                        <div class="year-label">Election Year</div>
                        <div class="year-stats">
                            <div class="year-stat">
                                <span class="year-stat-label">Avg Return:</span>
                                <span class="year-stat-value" style="color: var(--success-color);" id="year-4-return">+11.6%</span>
                            </div>
                            <div class="year-stat">
                                <span class="year-stat-label">Win Rate:</span>
                                <span class="year-stat-value" id="year-4-winrate">75%</span>
                            </div>
                            <div class="year-stat">
                                <span class="year-stat-label">Volatility:</span>
                                <span class="year-stat-value" id="year-4-vol">Medium</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Presidential Cycle Charts -->
            <div class="charts-container">
                <div class="chart-card">
                    <h2 class="chart-title">Average Returns by Cycle Year</h2>
                    <div class="chart-wrapper">
                        <canvas id="presidential-returns-chart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2 class="chart-title">Seasonal Patterns</h2>
                    <div class="chart-wrapper">
                        <canvas id="seasonal-patterns-chart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2 class="chart-title">Monthly Performance Heatmap</h2>
                    <div class="chart-wrapper">
                        <canvas id="monthly-heatmap-chart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2 class="chart-title">Cycle Year Comparison (Current vs Historical)</h2>
                    <div class="chart-wrapper">
                        <canvas id="cycle-comparison-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 3: Sector Rotation -->
        <div id="sectors-tab" class="tab-content">
            <div class="sector-clock-container">
                <h2 class="chart-title">Sector Rotation Clock</h2>
                <div style="color: var(--text-secondary); margin-bottom: 25px; text-align: center;">
                    Different sectors lead in different cycle phases. Current phase highlighted.
                </div>
                <div class="sector-clock" id="sector-clock">
                    <!-- Sector rotation clock will be rendered here via JavaScript -->
                </div>
            </div>

            <!-- Sector Performance by Phase -->
            <div class="chart-card">
                <h2 class="chart-title">Sector Performance by Cycle Phase</h2>
                <div style="color: var(--text-secondary); margin-bottom: 20px;">
                    Historical average sector returns during each economic cycle phase.
                </div>
                <div class="chart-wrapper" style="height: 500px;">
                    <canvas id="sector-performance-chart"></canvas>
                </div>
            </div>

            <!-- Current Sector Rankings -->
            <div class="chart-card">
                <h2 class="chart-title">Current Sector Rankings (YTD Performance)</h2>
                <div id="sector-rankings" style="margin-top: 20px;">
                    <div style="text-align: center; color: var(--text-muted);">
                        <span class="loading"></span> Loading sector data...
                    </div>
                </div>
            </div>

            <!-- Sector Rotation Chart -->
            <div class="charts-container">
                <div class="chart-card">
                    <h2 class="chart-title">6-Month Sector Relative Strength</h2>
                    <div class="chart-wrapper">
                        <canvas id="sector-strength-chart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2 class="chart-title">Sector Leadership Changes</h2>
                    <div class="chart-wrapper">
                        <canvas id="sector-leadership-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 4: Historical Analysis -->
        <div id="historical-tab" class="tab-content">
            <div class="chart-card">
                <h2 class="chart-title">Historical Economic Cycles (1950-Present)</h2>
                <div style="overflow-x: auto;">
                    <table class="historical-cycles-table">
                        <thead>
                            <tr>
                                <th>Cycle</th>
                                <th>Peak Date</th>
                                <th>Trough Date</th>
                                <th>Duration (Months)</th>
                                <th>Contraction (Months)</th>
                                <th>SPY Return</th>
                                <th>Max Drawdown</th>
                            </tr>
                        </thead>
                        <tbody id="historical-cycles-body">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Historical Charts -->
            <div class="charts-container">
                <div class="chart-card">
                    <h2 class="chart-title">Cycle Duration Trends</h2>
                    <div class="chart-wrapper">
                        <canvas id="duration-trends-chart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2 class="chart-title">Recovery Time Analysis</h2>
                    <div class="chart-wrapper">
                        <canvas id="recovery-time-chart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2 class="chart-title">Recession Depth vs Duration</h2>
                    <div class="chart-wrapper">
                        <canvas id="recession-scatter-chart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2 class="chart-title">Average Cycle Characteristics</h2>
                    <div class="chart-wrapper">
                        <canvas id="avg-characteristics-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 5: Trading Strategies -->
        <div id="strategies-tab" class="tab-content">
            <div class="chart-card">
                <h2 class="chart-title">Cycle-Based Trading Strategies</h2>
                <div style="color: var(--text-secondary); margin-bottom: 25px;">
                    Position differently based on the current economic cycle phase.
                </div>

                <div class="strategy-grid">
                    <div class="strategy-card">
                        <div class="strategy-phase">üü¢ Expansion Phase</div>
                        <ul class="strategy-list">
                            <li>Overweight equities (60-70% allocation)</li>
                            <li>Focus on cyclical sectors: Technology, Consumer Discretionary, Financials</li>
                            <li>Reduce defensive positions</li>
                            <li>Consider growth stocks over value</li>
                            <li>Minimize bond exposure</li>
                            <li>International equity exposure</li>
                        </ul>
                    </div>

                    <div class="strategy-card">
                        <div class="strategy-phase">üü° Peak Phase</div>
                        <ul class="strategy-list">
                            <li>Begin reducing equity exposure (50-60%)</li>
                            <li>Rotate to defensive sectors: Healthcare, Consumer Staples, Utilities</li>
                            <li>Increase cash position (10-15%)</li>
                            <li>Add quality bonds (20-30%)</li>
                            <li>Focus on large-cap, dividend stocks</li>
                            <li>Hedge with options or inverse ETFs</li>
                        </ul>
                    </div>

                    <div class="strategy-card">
                        <div class="strategy-phase">üî¥ Contraction Phase</div>
                        <ul class="strategy-list">
                            <li>Defensive positioning (30-40% equities)</li>
                            <li>Overweight bonds (40-50% allocation)</li>
                            <li>High cash reserves (15-25%)</li>
                            <li>Focus on quality: Low debt, high cash flow</li>
                            <li>Avoid cyclicals and growth stocks</li>
                            <li>Consider gold/commodities hedge (5-10%)</li>
                        </ul>
                    </div>

                    <div class="strategy-card">
                        <div class="strategy-phase">üîµ Trough Phase</div>
                        <ul class="strategy-list">
                            <li>Accumulation phase - deploy cash</li>
                            <li>Buy beaten-down cyclicals</li>
                            <li>Increase equity exposure (40-50%)</li>
                            <li>Focus on value stocks</li>
                            <li>Reduce bonds gradually</li>
                            <li>Prepare for expansion rotation</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Strategy Performance Comparison -->
            <div class="charts-container">
                <div class="chart-card">
                    <h2 class="chart-title">Strategy Performance by Cycle Phase</h2>
                    <div class="chart-wrapper">
                        <canvas id="strategy-performance-chart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2 class="chart-title">Risk-Adjusted Returns (Sharpe Ratio)</h2>
                    <div class="chart-wrapper">
                        <canvas id="sharpe-ratio-chart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2 class="chart-title">Maximum Drawdown by Strategy</h2>
                    <div class="chart-wrapper">
                        <canvas id="drawdown-chart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h2 class="chart-title">Optimal Allocation by Phase</h2>
                    <div class="chart-wrapper">
                        <canvas id="allocation-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Key Indicators to Watch -->
            <div class="chart-card">
                <h2 class="chart-title">Key Indicators to Watch by Phase</h2>
                <div class="strategy-grid">
                    <div class="strategy-card">
                        <div class="strategy-phase">Expansion ‚Üí Peak</div>
                        <ul class="strategy-list">
                            <li>Yield curve flattening/inversion</li>
                            <li>Rising unemployment claims</li>
                            <li>Fed tightening cycle maturity</li>
                            <li>LEI declining for 3+ months</li>
                            <li>Reduced consumer confidence</li>
                        </ul>
                    </div>

                    <div class="strategy-card">
                        <div class="strategy-phase">Peak ‚Üí Contraction</div>
                        <ul class="strategy-list">
                            <li>Official yield curve inversion</li>
                            <li>Rising unemployment rate</li>
                            <li>Negative GDP growth (2 quarters)</li>
                            <li>Industrial production declining</li>
                            <li>Corporate profit warnings</li>
                        </ul>
                    </div>

                    <div class="strategy-card">
                        <div class="strategy-phase">Contraction ‚Üí Trough</div>
                        <ul class="strategy-list">
                            <li>Fed easing policy initiated</li>
                            <li>Unemployment claims peaking</li>
                            <li>Yield curve steepening</li>
                            <li>LEI stabilizing/rising</li>
                            <li>Market bottoming process</li>
                        </ul>
                    </div>

                    <div class="strategy-card">
                        <div class="strategy-phase">Trough ‚Üí Expansion</div>
                        <ul class="strategy-list">
                            <li>GDP growth turning positive</li>
                            <li>Unemployment falling</li>
                            <li>Industrial production rising</li>
                            <li>Consumer confidence improving</li>
                            <li>Market breaking resistance levels</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // ==================== CONFIGURATION ====================
        const CONFIG = {
            FRED_API_KEY: '0a08e7a69f8dbd1b02e19e7af5a82b61',
            FRED_BASE_URL: 'http://localhost:5002/api/fred/series/observations',
            YAHOO_FINANCE_PROXY: 'http://localhost:5002/api/yahoo/chart/',
            UPDATE_INTERVAL: 300000, // 5 minutes
            CACHE_DURATION: 600000   // 10 minutes
        };

        // ==================== DATA CACHE ====================
        const dataCache = {
            data: {},
            set(key, value) {
                this.data[key] = {
                    value: value,
                    timestamp: Date.now()
                };
            },
            get(key) {
                const cached = this.data[key];
                if (!cached) return null;
                if (Date.now() - cached.timestamp > CONFIG.CACHE_DURATION) {
                    delete this.data[key];
                    return null;
                }
                return cached.value;
            }
        };

        // ==================== FRED API FUNCTIONS ====================
        async function fetchFREDData(seriesId, limit = 1) {
            const cached = dataCache.get(seriesId);
            if (cached) return cached;

            try {
                const url = `${CONFIG.FRED_BASE_URL}?series_id=${seriesId}&api_key=${CONFIG.FRED_API_KEY}&file_type=json&limit=${limit}&sort_order=desc`;
                const response = await fetch(url);
                const data = await response.json();

                if (data.observations && data.observations.length > 0) {
                    const value = parseFloat(data.observations[0].value);
                    dataCache.set(seriesId, { value, date: data.observations[0].date });
                    return { value, date: data.observations[0].date };
                }
                return null;
            } catch (error) {
                console.error(`Error fetching FRED data for ${seriesId}:`, error);
                return null;
            }
        }

        async function fetchFREDTimeSeries(seriesId, limit = 120) {
            try {
                const url = `${CONFIG.FRED_BASE_URL}?series_id=${seriesId}&api_key=${CONFIG.FRED_API_KEY}&file_type=json&limit=${limit}&sort_order=desc`;
                const response = await fetch(url);
                const data = await response.json();

                if (data.observations) {
                    return data.observations.map(obs => ({
                        date: obs.date,
                        value: parseFloat(obs.value)
                    })).filter(obs => !isNaN(obs.value)).reverse();
                }
                return [];
            } catch (error) {
                console.error(`Error fetching FRED time series for ${seriesId}:`, error);
                return [];
            }
        }

        // ==================== YAHOO FINANCE FUNCTIONS ====================
        async function fetchYahooFinanceData(symbol, range = '1y', interval = '1d') {
            const cached = dataCache.get(`yahoo_${symbol}_${range}`);
            if (cached) return cached;

            try {
                const url = `${CONFIG.YAHOO_FINANCE_PROXY}${symbol}?range=${range}&interval=${interval}`;
                const response = await fetch(url);
                const data = await response.json();

                if (data.chart && data.chart.result && data.chart.result[0]) {
                    const result = data.chart.result[0];
                    const timestamps = result.timestamp;
                    const quotes = result.indicators.quote[0];

                    const timeSeries = timestamps.map((ts, i) => ({
                        date: new Date(ts * 1000).toISOString().split('T')[0],
                        open: quotes.open[i],
                        high: quotes.high[i],
                        low: quotes.low[i],
                        close: quotes.close[i],
                        volume: quotes.volume[i]
                    })).filter(d => d.close !== null);

                    dataCache.set(`yahoo_${symbol}_${range}`, timeSeries);
                    return timeSeries;
                }
                return [];
            } catch (error) {
                console.error(`Error fetching Yahoo Finance data for ${symbol}:`, error);
                return [];
            }
        }

        // ==================== CYCLE DETERMINATION ====================
        function determineCyclePhase(indicators) {
            // Simplified cycle phase determination based on economic indicators
            const { gdp, unemployment, lei, yieldCurve } = indicators;

            let score = 0;

            // GDP growth indicator
            if (gdp > 3) score += 2;
            else if (gdp > 0) score += 1;
            else if (gdp < -1) score -= 2;
            else score -= 1;

            // Unemployment indicator (inverse)
            if (unemployment < 4) score += 2;
            else if (unemployment < 5.5) score += 1;
            else if (unemployment > 7) score -= 2;
            else score -= 1;

            // LEI indicator (using change)
            if (lei > 1) score += 2;
            else if (lei > 0) score += 1;
            else if (lei < -1) score -= 2;
            else score -= 1;

            // Yield curve indicator
            if (yieldCurve > 1) score += 1;
            else if (yieldCurve < -0.5) score -= 2;

            // Determine phase based on composite score
            if (score >= 4) return { phase: 'Expansion', strength: 'Strong', class: 'expansion' };
            else if (score >= 1) return { phase: 'Late Expansion', strength: 'Moderate', class: 'peak' };
            else if (score >= -2) return { phase: 'Early Contraction', strength: 'Weak', class: 'contraction' };
            else if (score >= -5) return { phase: 'Recession', strength: 'Declining', class: 'contraction' };
            else return { phase: 'Deep Recession', strength: 'Very Weak', class: 'trough' };
        }

        function calculateCycleStrength(indicators) {
            const { gdp, unemployment, lei, industrial } = indicators;

            // Normalized scoring (0-100)
            let strength = 50; // Neutral baseline

            // GDP contribution (¬±20 points)
            strength += Math.max(-20, Math.min(20, gdp * 5));

            // Unemployment contribution (¬±15 points, inverse)
            strength += Math.max(-15, Math.min(15, (6 - unemployment) * 3));

            // LEI contribution (¬±15 points)
            strength += Math.max(-15, Math.min(15, lei * 10));

            // Industrial production contribution (¬±10 points)
            strength += Math.max(-10, Math.min(10, industrial * 2));

            return Math.max(0, Math.min(100, Math.round(strength)));
        }

        // ==================== PRESIDENTIAL CYCLE ====================
        function getCurrentPresidentialCycleYear() {
            const currentYear = new Date().getFullYear();
            // 2024 was election year (year 4), so:
            const yearsSinceLastElection = (currentYear - 2024) % 4;
            const cycleYear = yearsSinceLastElection === 0 ? 4 : yearsSinceLastElection;
            return cycleYear;
        }

        // ==================== HISTORICAL CYCLES DATA ====================
        const historicalCycles = [
            { name: 'COVID Recession', peak: '2020-02', trough: '2020-04', duration: 2, spyReturn: -33.9, drawdown: -33.9 },
            { name: 'Great Recession', peak: '2007-12', trough: '2009-06', duration: 18, spyReturn: -56.8, drawdown: -56.8 },
            { name: 'Dot-Com Recession', peak: '2001-03', trough: '2001-11', duration: 8, spyReturn: -49.1, drawdown: -49.1 },
            { name: '1990-91 Recession', peak: '1990-07', trough: '1991-03', duration: 8, spyReturn: -19.9, drawdown: -19.9 },
            { name: '1981-82 Recession', peak: '1981-07', trough: '1982-11', duration: 16, spyReturn: -27.1, drawdown: -27.1 },
            { name: '1980 Recession', peak: '1980-01', trough: '1980-07', duration: 6, spyReturn: -17.1, drawdown: -17.1 },
            { name: '1973-75 Recession', peak: '1973-11', trough: '1975-03', duration: 16, spyReturn: -48.2, drawdown: -48.2 },
            { name: '1969-70 Recession', peak: '1969-12', trough: '1970-11', duration: 11, spyReturn: -36.1, drawdown: -36.1 },
            { name: '1960-61 Recession', peak: '1960-04', trough: '1961-02', duration: 10, spyReturn: -13.9, drawdown: -13.9 },
            { name: '1957-58 Recession', peak: '1957-08', trough: '1958-04', duration: 8, spyReturn: -20.7, drawdown: -20.7 },
            { name: '1953-54 Recession', peak: '1953-07', trough: '1954-05', duration: 10, spyReturn: -14.8, drawdown: -14.8 }
        ];

        // ==================== SECTOR DATA ====================
        const sectorData = {
            expansion: [
                { sector: 'Technology', performance: 18.5 },
                { sector: 'Consumer Discretionary', performance: 16.2 },
                { sector: 'Financials', performance: 14.8 },
                { sector: 'Industrials', performance: 13.5 },
                { sector: 'Materials', performance: 12.1 },
                { sector: 'Energy', performance: 10.5 },
                { sector: 'Real Estate', performance: 9.8 },
                { sector: 'Healthcare', performance: 8.5 },
                { sector: 'Consumer Staples', performance: 7.2 },
                { sector: 'Utilities', performance: 6.5 },
                { sector: 'Communication Services', performance: 11.5 }
            ],
            peak: [
                { sector: 'Healthcare', performance: 12.5 },
                { sector: 'Consumer Staples', performance: 11.8 },
                { sector: 'Utilities', performance: 10.5 },
                { sector: 'Communication Services', performance: 9.2 },
                { sector: 'Real Estate', performance: 8.5 },
                { sector: 'Financials', performance: 7.8 },
                { sector: 'Technology', performance: 7.2 },
                { sector: 'Industrials', performance: 6.5 },
                { sector: 'Materials', performance: 5.8 },
                { sector: 'Consumer Discretionary', performance: 4.5 },
                { sector: 'Energy', performance: 3.2 }
            ],
            contraction: [
                { sector: 'Consumer Staples', performance: 5.5 },
                { sector: 'Healthcare', performance: 4.8 },
                { sector: 'Utilities', performance: 4.2 },
                { sector: 'Communication Services', performance: -2.5 },
                { sector: 'Real Estate', performance: -5.8 },
                { sector: 'Technology', performance: -12.5 },
                { sector: 'Financials', performance: -15.2 },
                { sector: 'Industrials', performance: -18.5 },
                { sector: 'Materials', performance: -20.1 },
                { sector: 'Consumer Discretionary', performance: -22.8 },
                { sector: 'Energy', performance: -25.5 }
            ],
            trough: [
                { sector: 'Consumer Discretionary', performance: 25.5 },
                { sector: 'Technology', performance: 22.8 },
                { sector: 'Financials', performance: 20.5 },
                { sector: 'Industrials', performance: 18.2 },
                { sector: 'Materials', performance: 16.8 },
                { sector: 'Energy', performance: 15.5 },
                { sector: 'Real Estate', performance: 12.5 },
                { sector: 'Communication Services', performance: 10.8 },
                { sector: 'Healthcare', performance: 8.5 },
                { sector: 'Consumer Staples', performance: 7.2 },
                { sector: 'Utilities', performance: 6.5 }
            ]
        };

        const sectorETFs = [
            { name: 'Technology', ticker: 'XLK' },
            { name: 'Healthcare', ticker: 'XLV' },
            { name: 'Financials', ticker: 'XLF' },
            { name: 'Consumer Discretionary', ticker: 'XLY' },
            { name: 'Consumer Staples', ticker: 'XLP' },
            { name: 'Energy', ticker: 'XLE' },
            { name: 'Industrials', ticker: 'XLI' },
            { name: 'Materials', ticker: 'XLB' },
            { name: 'Utilities', ticker: 'XLU' },
            { name: 'Real Estate', ticker: 'XLRE' },
            { name: 'Communication Services', ticker: 'XLC' }
        ];

        // ==================== CHART INSTANCES ====================
        let chartInstances = {};

        // ==================== INITIALIZE DASHBOARD ====================
        async function initializeDashboard() {
            console.log('Initializing Market Cycles Dashboard...');
            updateLastUpdate('Fetching real-time data...');

            try {
                // Fetch economic indicators
                const indicators = await fetchEconomicIndicators();

                // Update cycle phase
                updateCyclePhase(indicators);

                // Update economic metrics
                updateEconomicMetrics(indicators);

                // Update presidential cycle
                updatePresidentialCycle();

                // Fetch market data
                const spyData = await fetchYahooFinanceData('SPY', '5y', '1d');

                // Initialize charts
                initializeCharts(spyData, indicators);

                // Load sector data
                await loadSectorData();

                // Populate historical cycles
                populateHistoricalCycles();

                updateLastUpdate('Live');

                // Set up auto-refresh
                setInterval(async () => {
                    await refreshDashboard();
                }, CONFIG.UPDATE_INTERVAL);

            } catch (error) {
                console.error('Dashboard initialization error:', error);
                updateLastUpdate('Error loading data');
            }
        }

        // ==================== FETCH ECONOMIC INDICATORS ====================
        async function fetchEconomicIndicators() {
            try {
                // Fetch all indicators in parallel
                const [gdpData, unemploymentData, leiData, yieldCurve10Y, yieldCurve2Y, industrialData, confidenceData] = await Promise.all([
                    fetchFREDData('A191RL1Q225SBEA'), // Real GDP growth rate
                    fetchFREDData('UNRATE'),          // Unemployment rate
                    fetchFREDData('USSLIND'),         // Leading index
                    fetchFREDData('DGS10'),           // 10-year Treasury
                    fetchFREDData('DGS2'),            // 2-year Treasury
                    fetchFREDData('INDPRO'),          // Industrial production
                    fetchFREDData('UMCSENT')          // Consumer confidence
                ]);

                // Calculate yield curve spread
                const yieldCurveSpread = yieldCurve10Y && yieldCurve2Y
                    ? yieldCurve10Y.value - yieldCurve2Y.value
                    : null;

                return {
                    gdp: gdpData?.value || 0,
                    gdpDate: gdpData?.date || 'N/A',
                    unemployment: unemploymentData?.value || 0,
                    unemploymentDate: unemploymentData?.date || 'N/A',
                    lei: leiData?.value || 0,
                    leiDate: leiData?.date || 'N/A',
                    yieldCurve: yieldCurveSpread,
                    yieldCurveDate: yieldCurve10Y?.date || 'N/A',
                    industrial: industrialData?.value || 0,
                    industrialDate: industrialData?.date || 'N/A',
                    confidence: confidenceData?.value || 0,
                    confidenceDate: confidenceData?.date || 'N/A'
                };
            } catch (error) {
                console.error('Error fetching economic indicators:', error);
                return {
                    gdp: 0,
                    unemployment: 0,
                    lei: 0,
                    yieldCurve: 0,
                    industrial: 0,
                    confidence: 0
                };
            }
        }

        // ==================== UPDATE CYCLE PHASE ====================
        function updateCyclePhase(indicators) {
            const cycleInfo = determineCyclePhase(indicators);
            const strength = calculateCycleStrength(indicators);

            // Update current phase display
            const phaseElement = document.getElementById('current-phase');
            if (phaseElement) {
                phaseElement.textContent = cycleInfo.phase;
                phaseElement.className = `cycle-phase-value ${cycleInfo.class}`;
            }

            // Update cycle details
            document.getElementById('cycle-month').textContent = 'N/A'; // Would need NBER data
            document.getElementById('cycle-duration').textContent = 'N/A';
            document.getElementById('phase-strength').textContent = cycleInfo.strength;
            document.getElementById('next-phase').textContent = 'TBD';

            // Update strength meter
            const strengthFill = document.getElementById('strength-fill');
            const strengthValue = document.getElementById('strength-value');
            if (strengthFill && strengthValue) {
                strengthFill.style.width = strength + '%';
                strengthValue.textContent = strength + '%';
            }
        }

        // ==================== UPDATE ECONOMIC METRICS ====================
        function updateEconomicMetrics(indicators) {
            // LEI
            const leiElement = document.getElementById('lei-value');
            if (leiElement) {
                leiElement.textContent = indicators.lei.toFixed(1);
                leiElement.className = 'metric-value ' + (indicators.lei > 100 ? 'positive' : 'negative');
            }

            // Unemployment
            const unemploymentElement = document.getElementById('unemployment-value');
            if (unemploymentElement) {
                unemploymentElement.textContent = indicators.unemployment.toFixed(1) + '%';
                unemploymentElement.className = 'metric-value ' + (indicators.unemployment < 5 ? 'positive' : 'negative');
            }

            // Yield Curve
            const yieldCurveElement = document.getElementById('yield-curve-value');
            if (yieldCurveElement && indicators.yieldCurve !== null) {
                yieldCurveElement.textContent = indicators.yieldCurve.toFixed(2) + '%';
                yieldCurveElement.className = 'metric-value ' + (indicators.yieldCurve > 0 ? 'positive' : 'negative');
            }

            // GDP
            const gdpElement = document.getElementById('gdp-value');
            if (gdpElement) {
                gdpElement.textContent = indicators.gdp.toFixed(1) + '%';
                gdpElement.className = 'metric-value ' + (indicators.gdp > 0 ? 'positive' : 'negative');
            }

            // Industrial Production (convert to YoY change if available)
            const industrialElement = document.getElementById('industrial-value');
            if (industrialElement) {
                industrialElement.textContent = indicators.industrial.toFixed(1);
                industrialElement.className = 'metric-value neutral';
            }

            // Consumer Confidence
            const confidenceElement = document.getElementById('confidence-value');
            if (confidenceElement) {
                confidenceElement.textContent = indicators.confidence.toFixed(1);
                confidenceElement.className = 'metric-value ' + (indicators.confidence > 80 ? 'positive' : 'neutral');
            }
        }

        // ==================== UPDATE PRESIDENTIAL CYCLE ====================
        function updatePresidentialCycle() {
            const currentYear = getCurrentPresidentialCycleYear();

            // Update current year indicator
            const currentYearElement = document.getElementById('current-cycle-year');
            if (currentYearElement) {
                currentYearElement.textContent = `Year ${currentYear}`;
            }

            // Highlight active year card
            for (let i = 1; i <= 4; i++) {
                const card = document.getElementById(`year-${i}-card`);
                if (card) {
                    if (i === currentYear) {
                        card.classList.add('active');
                    } else {
                        card.classList.remove('active');
                    }
                }
            }
        }

        // ==================== INITIALIZE CHARTS ====================
        function initializeCharts(spyData, indicators) {
            // SPY with Cycle Overlays
            createSPYCycleChart(spyData);

            // Economic Indicators Timeline
            createIndicatorsTimelineChart();

            // Bull vs Bear Periods
            createBullBearChart(spyData);

            // Phase Distribution
            createPhaseDistributionChart();

            // Presidential Cycle Charts
            createPresidentialReturnsChart();
            createSeasonalPatternsChart();
            createMonthlyHeatmapChart();
            createCycleComparisonChart();

            // Sector Performance Chart
            createSectorPerformanceChart();

            // Historical Analysis Charts
            createDurationTrendsChart();
            createRecoveryTimeChart();
            createRecessionScatterChart();
            createAvgCharacteristicsChart();

            // Strategy Charts
            createStrategyPerformanceChart();
            createSharpeRatioChart();
            createDrawdownChart();
            createAllocationChart();

            // Sector Rotation Clock
            createSectorRotationClock();
        }

        // ==================== SPY CYCLE CHART ====================
        function createSPYCycleChart(data) {
            const ctx = document.getElementById('spy-cycle-chart');
            if (!ctx) return;

            if (chartInstances['spy-cycle']) {
                chartInstances['spy-cycle'].destroy();
            }

            // Prepare data
            const labels = data.map(d => d.date);
            const prices = data.map(d => d.close);

            chartInstances['spy-cycle'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'SPY Price',
                        data: prices,
                        borderColor: '#DC143C',
                        backgroundColor: 'rgba(220, 20, 60, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#b0b8c8' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#7a8a9a', maxTicksLimit: 12 },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        }
                    }
                }
            });
        }

        // ==================== INDICATORS TIMELINE CHART ====================
        async function createIndicatorsTimelineChart() {
            const ctx = document.getElementById('indicators-timeline-chart');
            if (!ctx) return;

            if (chartInstances['indicators-timeline']) {
                chartInstances['indicators-timeline'].destroy();
            }

            // Fetch historical data for multiple indicators
            const unemploymentSeries = await fetchFREDTimeSeries('UNRATE', 60);
            const gdpSeries = await fetchFREDTimeSeries('A191RL1Q225SBEA', 60);

            if (unemploymentSeries.length === 0) {
                console.error('No data for indicators timeline');
                return;
            }

            const labels = unemploymentSeries.map(d => d.date);

            chartInstances['indicators-timeline'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Unemployment Rate',
                            data: unemploymentSeries.map(d => d.value),
                            borderColor: '#FF5252',
                            backgroundColor: 'rgba(255, 82, 82, 0.1)',
                            yAxisID: 'y',
                            borderWidth: 2,
                            tension: 0.1
                        },
                        {
                            label: 'GDP Growth',
                            data: gdpSeries.map(d => d.value),
                            borderColor: '#00ff88',
                            backgroundColor: 'rgba(0, 255, 136, 0.1)',
                            yAxisID: 'y1',
                            borderWidth: 2,
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#b0b8c8' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#7a8a9a', maxTicksLimit: 10 },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            type: 'linear',
                            position: 'left',
                            ticks: { color: '#FF5252' },
                            grid: { color: '#1e3a5f' },
                            title: {
                                display: true,
                                text: 'Unemployment %',
                                color: '#FF5252'
                            }
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            ticks: { color: '#00ff88' },
                            grid: { display: false },
                            title: {
                                display: true,
                                text: 'GDP Growth %',
                                color: '#00ff88'
                            }
                        }
                    }
                }
            });
        }

        // ==================== BULL BEAR CHART ====================
        function createBullBearChart(data) {
            const ctx = document.getElementById('bull-bear-chart');
            if (!ctx) return;

            if (chartInstances['bull-bear']) {
                chartInstances['bull-bear'].destroy();
            }

            // Simplified bull/bear detection (20% threshold from peaks/troughs)
            let peak = data[0].close;
            let bullBearData = data.map(d => {
                if (d.close > peak) peak = d.close;
                const drawdown = ((d.close - peak) / peak) * 100;
                return {
                    date: d.date,
                    price: d.close,
                    drawdown: drawdown,
                    isBear: drawdown < -20
                };
            });

            const labels = bullBearData.map(d => d.date);
            const prices = bullBearData.map(d => d.price);
            const bearPeriods = bullBearData.map(d => d.isBear ? d.price : null);

            chartInstances['bull-bear'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'SPY Price',
                            data: prices,
                            borderColor: '#00ff88',
                            backgroundColor: 'rgba(0, 255, 136, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.1
                        },
                        {
                            label: 'Bear Market Periods',
                            data: bearPeriods,
                            borderColor: '#FF5252',
                            backgroundColor: 'rgba(255, 82, 82, 0.3)',
                            borderWidth: 3,
                            fill: false,
                            pointRadius: 0,
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#b0b8c8' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#7a8a9a', maxTicksLimit: 12 },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        }
                    }
                }
            });
        }

        // ==================== PHASE DISTRIBUTION CHART ====================
        function createPhaseDistributionChart() {
            const ctx = document.getElementById('phase-distribution-chart');
            if (!ctx) return;

            if (chartInstances['phase-distribution']) {
                chartInstances['phase-distribution'].destroy();
            }

            chartInstances['phase-distribution'] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Expansion', 'Peak', 'Contraction', 'Trough'],
                    datasets: [{
                        data: [58, 12, 22, 8], // Historical percentages
                        backgroundColor: [
                            '#00ff88',
                            '#ff9500',
                            '#FF5252',
                            '#0096FF'
                        ],
                        borderColor: '#12203a',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#b0b8c8', padding: 15 }
                        }
                    }
                }
            });
        }

        // ==================== PRESIDENTIAL RETURNS CHART ====================
        function createPresidentialReturnsChart() {
            const ctx = document.getElementById('presidential-returns-chart');
            if (!ctx) return;

            if (chartInstances['presidential-returns']) {
                chartInstances['presidential-returns'].destroy();
            }

            chartInstances['presidential-returns'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Year 1', 'Year 2', 'Year 3', 'Year 4'],
                    datasets: [{
                        label: 'Average S&P 500 Return (%)',
                        data: [7.2, 5.8, 16.3, 11.6],
                        backgroundColor: ['#0096FF', '#ff9500', '#00ff88', '#DC143C'],
                        borderColor: '#12203a',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#b0b8c8' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' },
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // ==================== SEASONAL PATTERNS CHART ====================
        function createSeasonalPatternsChart() {
            const ctx = document.getElementById('seasonal-patterns-chart');
            if (!ctx) return;

            if (chartInstances['seasonal-patterns']) {
                chartInstances['seasonal-patterns'].destroy();
            }

            chartInstances['seasonal-patterns'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        label: 'Average Monthly Return (%)',
                        data: [1.2, 0.3, 1.3, 1.5, 0.2, -0.1, 1.1, -0.5, -0.8, 0.9, 1.6, 1.4],
                        borderColor: '#DC143C',
                        backgroundColor: 'rgba(220, 20, 60, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#b0b8c8' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        }
                    }
                }
            });
        }

        // ==================== MONTHLY HEATMAP CHART ====================
        function createMonthlyHeatmapChart() {
            const ctx = document.getElementById('monthly-heatmap-chart');
            if (!ctx) return;

            if (chartInstances['monthly-heatmap']) {
                chartInstances['monthly-heatmap'].destroy();
            }

            // Simplified heatmap as bar chart (would need more complex visualization for true heatmap)
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const year3Data = [2.5, 1.8, 2.1, 2.8, 1.5, 0.8, 1.9, 0.5, 0.2, 1.8, 2.5, 2.3]; // Best performing year

            chartInstances['monthly-heatmap'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Year 3 (Pre-Election) Average Returns',
                        data: year3Data,
                        backgroundColor: year3Data.map(v => v > 1.5 ? '#00ff88' : v > 0 ? '#0096FF' : '#FF5252'),
                        borderColor: '#12203a',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#b0b8c8' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        }
                    }
                }
            });
        }

        // ==================== CYCLE COMPARISON CHART ====================
        function createCycleComparisonChart() {
            const ctx = document.getElementById('cycle-comparison-chart');
            if (!ctx) return;

            if (chartInstances['cycle-comparison']) {
                chartInstances['cycle-comparison'].destroy();
            }

            const months = Array.from({length: 12}, (_, i) => `Month ${i + 1}`);

            chartInstances['cycle-comparison'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Current Year',
                            data: [0, 1.5, 2.8, 4.2, 5.5, 6.8, 8.1, 9.2, 10.5, 11.8, 13.2, 14.5],
                            borderColor: '#DC143C',
                            borderWidth: 3,
                            tension: 0.1
                        },
                        {
                            label: 'Historical Average',
                            data: [0, 1.2, 2.3, 3.5, 4.6, 5.8, 6.9, 8.0, 9.1, 10.2, 11.3, 12.4],
                            borderColor: '#7a8a9a',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#b0b8c8' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' },
                            title: {
                                display: true,
                                text: 'Cumulative Return (%)',
                                color: '#b0b8c8'
                            }
                        }
                    }
                }
            });
        }

        // ==================== SECTOR PERFORMANCE CHART ====================
        function createSectorPerformanceChart() {
            const ctx = document.getElementById('sector-performance-chart');
            if (!ctx) return;

            if (chartInstances['sector-performance']) {
                chartInstances['sector-performance'].destroy();
            }

            const sectors = sectorData.expansion.map(s => s.sector);

            chartInstances['sector-performance'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sectors,
                    datasets: [
                        {
                            label: 'Expansion',
                            data: sectorData.expansion.map(s => s.performance),
                            backgroundColor: 'rgba(0, 255, 136, 0.7)'
                        },
                        {
                            label: 'Peak',
                            data: sectorData.peak.map(s => s.performance),
                            backgroundColor: 'rgba(255, 149, 0, 0.7)'
                        },
                        {
                            label: 'Contraction',
                            data: sectorData.contraction.map(s => s.performance),
                            backgroundColor: 'rgba(255, 82, 82, 0.7)'
                        },
                        {
                            label: 'Trough',
                            data: sectorData.trough.map(s => s.performance),
                            backgroundColor: 'rgba(0, 150, 255, 0.7)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#b0b8c8' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#7a8a9a', maxRotation: 45, minRotation: 45 },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        }
                    }
                }
            });
        }

        // ==================== SECTOR ROTATION CLOCK ====================
        function createSectorRotationClock() {
            const container = document.getElementById('sector-clock');
            if (!container) return;

            // Create SVG-based sector clock
            const phases = [
                { name: 'Early Expansion', sectors: ['Technology', 'Industrials'], color: '#00ff88', angle: 0 },
                { name: 'Mid Expansion', sectors: ['Consumer Disc.', 'Financials'], color: '#00dd66', angle: 90 },
                { name: 'Late Expansion', sectors: ['Energy', 'Materials'], color: '#ff9500', angle: 180 },
                { name: 'Early Contraction', sectors: ['Healthcare', 'Staples'], color: '#FF5252', angle: 270 }
            ];

            container.innerHTML = `
                <svg width="100%" height="100%" viewBox="0 0 600 600">
                    <circle cx="300" cy="300" r="280" fill="none" stroke="#1e3a5f" stroke-width="2"/>
                    <circle cx="300" cy="300" r="200" fill="none" stroke="#1e3a5f" stroke-width="2"/>
                    <circle cx="300" cy="300" r="120" fill="none" stroke="#1e3a5f" stroke-width="2"/>

                    <!-- Expansion Quarter -->
                    <path d="M 300 300 L 300 20 A 280 280 0 0 1 580 300 Z" fill="rgba(0, 255, 136, 0.2)" stroke="#00ff88" stroke-width="2"/>
                    <text x="450" y="150" fill="#00ff88" font-size="18" font-weight="700">EXPANSION</text>

                    <!-- Peak Quarter -->
                    <path d="M 300 300 L 580 300 A 280 280 0 0 1 300 580 Z" fill="rgba(255, 149, 0, 0.2)" stroke="#ff9500" stroke-width="2"/>
                    <text x="420" y="450" fill="#ff9500" font-size="18" font-weight="700">PEAK</text>

                    <!-- Contraction Quarter -->
                    <path d="M 300 300 L 300 580 A 280 280 0 0 1 20 300 Z" fill="rgba(255, 82, 82, 0.2)" stroke="#FF5252" stroke-width="2"/>
                    <text x="80" y="450" fill="#FF5252" font-size="18" font-weight="700">CONTRACTION</text>

                    <!-- Trough Quarter -->
                    <path d="M 300 300 L 20 300 A 280 280 0 0 1 300 20 Z" fill="rgba(0, 150, 255, 0.2)" stroke="#0096FF" stroke-width="2"/>
                    <text x="80" y="150" fill="#0096FF" font-size="18" font-weight="700">TROUGH</text>

                    <!-- Center circle -->
                    <circle cx="300" cy="300" r="60" fill="#12203a" stroke="#DC143C" stroke-width="3"/>
                    <text x="300" y="295" fill="#DC143C" font-size="14" font-weight="700" text-anchor="middle">MARKET</text>
                    <text x="300" y="315" fill="#DC143C" font-size="14" font-weight="700" text-anchor="middle">CYCLE</text>

                    <!-- Sector labels -->
                    <text x="300" y="80" fill="#b0b8c8" font-size="14" text-anchor="middle">Technology</text>
                    <text x="520" y="220" fill="#b0b8c8" font-size="14" text-anchor="middle">Financials</text>
                    <text x="520" y="380" fill="#b0b8c8" font-size="14" text-anchor="middle">Energy</text>
                    <text x="300" y="540" fill="#b0b8c8" font-size="14" text-anchor="middle">Consumer Staples</text>
                    <text x="80" y="380" fill="#b0b8c8" font-size="14" text-anchor="middle">Healthcare</text>
                    <text x="80" y="220" fill="#b0b8c8" font-size="14" text-anchor="middle">Industrials</text>
                </svg>
            `;
        }

        // ==================== LOAD SECTOR DATA ====================
        async function loadSectorData() {
            const rankingsContainer = document.getElementById('sector-rankings');
            if (!rankingsContainer) return;

            try {
                // Fetch YTD performance for all sector ETFs
                const sectorPerformances = await Promise.all(
                    sectorETFs.map(async (sector) => {
                        const data = await fetchYahooFinanceData(sector.ticker, 'ytd', '1d');
                        if (data.length > 0) {
                            const startPrice = data[0].close;
                            const endPrice = data[data.length - 1].close;
                            const ytdReturn = ((endPrice - startPrice) / startPrice) * 100;
                            return {
                                name: sector.name,
                                ticker: sector.ticker,
                                ytdReturn: ytdReturn
                            };
                        }
                        return null;
                    })
                );

                // Filter out nulls and sort by performance
                const validSectors = sectorPerformances.filter(s => s !== null).sort((a, b) => b.ytdReturn - a.ytdReturn);

                // Render sector rankings
                rankingsContainer.innerHTML = validSectors.map((sector, index) => `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; margin: 10px 0; background: ${index < 3 ? 'rgba(0, 255, 136, 0.1)' : 'rgba(139, 0, 0, 0.05)'}; border-radius: 8px; border-left: 4px solid ${index < 3 ? '#00ff88' : '#DC143C'};">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span style="font-size: 1.5rem; font-weight: 700; color: var(--text-muted); width: 30px;">${index + 1}</span>
                            <div>
                                <div style="font-weight: 700; color: var(--text-primary);">${sector.name}</div>
                                <div style="font-size: 0.85rem; color: var(--text-muted);">${sector.ticker}</div>
                            </div>
                        </div>
                        <div style="font-size: 1.8rem; font-weight: 800; color: ${sector.ytdReturn > 0 ? 'var(--success-color)' : 'var(--danger-color)'};">
                            ${sector.ytdReturn > 0 ? '+' : ''}${sector.ytdReturn.toFixed(2)}%
                        </div>
                    </div>
                `).join('');

                // Create sector strength chart
                createSectorStrengthChart(validSectors);
                createSectorLeadershipChart(validSectors);

            } catch (error) {
                console.error('Error loading sector data:', error);
                rankingsContainer.innerHTML = '<div style="text-align: center; color: var(--danger-color);">Error loading sector data</div>';
            }
        }

        // ==================== SECTOR STRENGTH CHART ====================
        function createSectorStrengthChart(sectors) {
            const ctx = document.getElementById('sector-strength-chart');
            if (!ctx || !sectors) return;

            if (chartInstances['sector-strength']) {
                chartInstances['sector-strength'].destroy();
            }

            chartInstances['sector-strength'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sectors.map(s => s.name),
                    datasets: [{
                        label: 'YTD Performance (%)',
                        data: sectors.map(s => s.ytdReturn),
                        backgroundColor: sectors.map(s => s.ytdReturn > 0 ? 'rgba(0, 255, 136, 0.7)' : 'rgba(255, 82, 82, 0.7)'),
                        borderColor: '#12203a',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        }
                    }
                }
            });
        }

        // ==================== SECTOR LEADERSHIP CHART ====================
        function createSectorLeadershipChart(sectors) {
            const ctx = document.getElementById('sector-leadership-chart');
            if (!ctx || !sectors) return;

            if (chartInstances['sector-leadership']) {
                chartInstances['sector-leadership'].destroy();
            }

            // Take top 5 and bottom 5
            const topSectors = sectors.slice(0, 5);
            const bottomSectors = sectors.slice(-5);

            chartInstances['sector-leadership'] = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: topSectors.map(s => s.name),
                    datasets: [
                        {
                            label: 'Top Performers',
                            data: topSectors.map(s => Math.abs(s.ytdReturn)),
                            backgroundColor: 'rgba(0, 255, 136, 0.2)',
                            borderColor: '#00ff88',
                            borderWidth: 2
                        },
                        {
                            label: 'Bottom Performers',
                            data: bottomSectors.map(s => Math.abs(s.ytdReturn)),
                            backgroundColor: 'rgba(255, 82, 82, 0.2)',
                            borderColor: '#FF5252',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#b0b8c8' }
                        }
                    },
                    scales: {
                        r: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' },
                            pointLabels: { color: '#b0b8c8' }
                        }
                    }
                }
            });
        }

        // ==================== POPULATE HISTORICAL CYCLES ====================
        function populateHistoricalCycles() {
            const tbody = document.getElementById('historical-cycles-body');
            if (!tbody) return;

            tbody.innerHTML = historicalCycles.map(cycle => `
                <tr>
                    <td style="font-weight: 600;">${cycle.name}</td>
                    <td>${cycle.peak}</td>
                    <td>${cycle.trough}</td>
                    <td>${calculateExpansionMonths(cycle.peak, cycle.trough)}</td>
                    <td>${cycle.duration}</td>
                    <td style="color: ${cycle.spyReturn > 0 ? 'var(--success-color)' : 'var(--danger-color)'}; font-weight: 700;">
                        ${cycle.spyReturn > 0 ? '+' : ''}${cycle.spyReturn.toFixed(1)}%
                    </td>
                    <td style="color: var(--danger-color); font-weight: 700;">${cycle.drawdown.toFixed(1)}%</td>
                </tr>
            `).join('');
        }

        function calculateExpansionMonths(peak, trough) {
            // Simple calculation - would need more accurate date parsing
            const peakDate = new Date(peak);
            const troughDate = new Date(trough);
            // Assume average expansion is 60 months for now
            return '60-120';
        }

        // ==================== DURATION TRENDS CHART ====================
        function createDurationTrendsChart() {
            const ctx = document.getElementById('duration-trends-chart');
            if (!ctx) return;

            if (chartInstances['duration-trends']) {
                chartInstances['duration-trends'].destroy();
            }

            chartInstances['duration-trends'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: historicalCycles.map(c => c.name).reverse(),
                    datasets: [{
                        label: 'Contraction Duration (Months)',
                        data: historicalCycles.map(c => c.duration).reverse(),
                        borderColor: '#FF5252',
                        backgroundColor: 'rgba(255, 82, 82, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#b0b8c8' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#7a8a9a', maxRotation: 45, minRotation: 45 },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' },
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // ==================== RECOVERY TIME CHART ====================
        function createRecoveryTimeChart() {
            const ctx = document.getElementById('recovery-time-chart');
            if (!ctx) return;

            if (chartInstances['recovery-time']) {
                chartInstances['recovery-time'].destroy();
            }

            const recoveryTimes = [2, 49, 52, 24, 18, 12, 69, 43, 14, 11, 9]; // Approximate months to recover

            chartInstances['recovery-time'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: historicalCycles.map(c => c.name).reverse(),
                    datasets: [{
                        label: 'Months to Recover',
                        data: recoveryTimes.reverse(),
                        backgroundColor: 'rgba(0, 150, 255, 0.7)',
                        borderColor: '#0096FF',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#b0b8c8' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#7a8a9a', maxRotation: 45, minRotation: 45 },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' },
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // ==================== RECESSION SCATTER CHART ====================
        function createRecessionScatterChart() {
            const ctx = document.getElementById('recession-scatter-chart');
            if (!ctx) return;

            if (chartInstances['recession-scatter']) {
                chartInstances['recession-scatter'].destroy();
            }

            const scatterData = historicalCycles.map(c => ({
                x: c.duration,
                y: Math.abs(c.drawdown),
                label: c.name
            }));

            chartInstances['recession-scatter'] = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Recession Depth vs Duration',
                        data: scatterData,
                        backgroundColor: '#DC143C',
                        borderColor: '#8B0000',
                        borderWidth: 2,
                        pointRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#b0b8c8' }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = scatterData[context.dataIndex];
                                    return `${point.label}: ${point.x} months, ${point.y.toFixed(1)}% drawdown`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' },
                            title: {
                                display: true,
                                text: 'Duration (Months)',
                                color: '#b0b8c8'
                            }
                        },
                        y: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' },
                            title: {
                                display: true,
                                text: 'Max Drawdown (%)',
                                color: '#b0b8c8'
                            }
                        }
                    }
                }
            });
        }

        // ==================== AVG CHARACTERISTICS CHART ====================
        function createAvgCharacteristicsChart() {
            const ctx = document.getElementById('avg-characteristics-chart');
            if (!ctx) return;

            if (chartInstances['avg-characteristics']) {
                chartInstances['avg-characteristics'].destroy();
            }

            chartInstances['avg-characteristics'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Avg Duration', 'Avg Drawdown', 'Avg Recovery Time', 'Frequency (per decade)'],
                    datasets: [{
                        label: 'Historical Averages',
                        data: [11, -30.5, 25, 1.5],
                        backgroundColor: ['#0096FF', '#FF5252', '#00ff88', '#ff9500'],
                        borderColor: '#12203a',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        }
                    }
                }
            });
        }

        // ==================== STRATEGY PERFORMANCE CHART ====================
        function createStrategyPerformanceChart() {
            const ctx = document.getElementById('strategy-performance-chart');
            if (!ctx) return;

            if (chartInstances['strategy-performance']) {
                chartInstances['strategy-performance'].destroy();
            }

            chartInstances['strategy-performance'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Expansion Strategy', 'Peak Strategy', 'Contraction Strategy', 'Trough Strategy', 'Buy & Hold'],
                    datasets: [{
                        label: 'Annualized Return (%)',
                        data: [14.2, 8.5, 3.2, 18.5, 10.5],
                        backgroundColor: ['#00ff88', '#ff9500', '#FF5252', '#0096FF', '#7a8a9a'],
                        borderColor: '#12203a',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        }
                    }
                }
            });
        }

        // ==================== SHARPE RATIO CHART ====================
        function createSharpeRatioChart() {
            const ctx = document.getElementById('sharpe-ratio-chart');
            if (!ctx) return;

            if (chartInstances['sharpe-ratio']) {
                chartInstances['sharpe-ratio'].destroy();
            }

            chartInstances['sharpe-ratio'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Expansion Strategy', 'Peak Strategy', 'Contraction Strategy', 'Trough Strategy', 'Buy & Hold'],
                    datasets: [{
                        label: 'Sharpe Ratio',
                        data: [1.15, 0.85, 0.45, 1.35, 0.75],
                        backgroundColor: ['#00ff88', '#ff9500', '#FF5252', '#0096FF', '#7a8a9a'],
                        borderColor: '#12203a',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' },
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // ==================== DRAWDOWN CHART ====================
        function createDrawdownChart() {
            const ctx = document.getElementById('drawdown-chart');
            if (!ctx) return;

            if (chartInstances['drawdown']) {
                chartInstances['drawdown'].destroy();
            }

            chartInstances['drawdown'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Expansion Strategy', 'Peak Strategy', 'Contraction Strategy', 'Trough Strategy', 'Buy & Hold'],
                    datasets: [{
                        label: 'Maximum Drawdown (%)',
                        data: [-25.5, -18.2, -12.8, -28.5, -35.2],
                        backgroundColor: ['#FF5252', '#ff9500', '#00ff88', '#FF5252', '#DC143C'],
                        borderColor: '#12203a',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        }
                    }
                }
            });
        }

        // ==================== ALLOCATION CHART ====================
        function createAllocationChart() {
            const ctx = document.getElementById('allocation-chart');
            if (!ctx) return;

            if (chartInstances['allocation']) {
                chartInstances['allocation'].destroy();
            }

            chartInstances['allocation'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Expansion', 'Peak', 'Contraction', 'Trough'],
                    datasets: [
                        {
                            label: 'Equities %',
                            data: [65, 55, 35, 45],
                            backgroundColor: '#00ff88'
                        },
                        {
                            label: 'Bonds %',
                            data: [25, 30, 45, 35],
                            backgroundColor: '#0096FF'
                        },
                        {
                            label: 'Cash %',
                            data: [10, 15, 20, 20],
                            backgroundColor: '#7a8a9a'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#b0b8c8' }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' }
                        },
                        y: {
                            stacked: true,
                            ticks: { color: '#7a8a9a' },
                            grid: { color: '#1e3a5f' },
                            max: 100
                        }
                    }
                }
            });
        }

        // ==================== REFRESH DASHBOARD ====================
        async function refreshDashboard() {
            console.log('Refreshing dashboard...');
            updateLastUpdate('Updating...');

            try {
                const indicators = await fetchEconomicIndicators();
                updateCyclePhase(indicators);
                updateEconomicMetrics(indicators);
                updateLastUpdate('Live');
            } catch (error) {
                console.error('Refresh error:', error);
                updateLastUpdate('Error');
            }
        }

        // ==================== UPDATE LAST UPDATE ====================
        function updateLastUpdate(status) {
            const element = document.getElementById('last-update');
            if (!element) return;

            const indicator = element.querySelector('.status-indicator');
            const now = new Date();
            const timeStr = now.toLocaleTimeString();

            if (status === 'Live') {
                indicator.className = 'status-indicator live';
                element.innerHTML = `<span class="status-indicator live"></span> Live - Updated ${timeStr}`;
            } else if (status === 'Error') {
                indicator.className = 'status-indicator';
                indicator.style.background = 'var(--danger-color)';
                element.innerHTML = `<span class="status-indicator" style="background: var(--danger-color);"></span> Error - ${timeStr}`;
            } else {
                element.innerHTML = `<span class="status-indicator pending"></span> ${status}`;
            }
        }

        // ==================== TAB SWITCHING ====================
        function switchTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Deactivate all buttons
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(btn => btn.classList.remove('active'));

            // Show selected tab
            const selectedTab = document.getElementById(tabName + '-tab');
            if (selectedTab) {
                selectedTab.classList.add('active');
            }

            // Activate selected button
            event.target.classList.add('active');
        }

        // ==================== INITIALIZE ON LOAD ====================
        document.addEventListener('DOMContentLoaded', () => {
            initializeDashboard();
        });
    </script>
</body>
</html>
