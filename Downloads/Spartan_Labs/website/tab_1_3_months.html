<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>1-3 Month Positions | Spartan Research Station</title>

    <!-- Spartan Theme CSS -->
    <link rel="stylesheet" href="spartan_theme.css">

    <style>
        body {
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--spartan-red);
        }

        .page-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: var(--spartan-red);
        }

        .page-header p {
            font-size: 1.2em;
            color: var(--text-secondary);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .dashboard-card {
            background: var(--bg-card);
            border: 2px solid var(--border-subtle);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow-card);
            transition: all 0.3s ease;
        }

        .dashboard-card:hover {
            border-color: var(--spartan-red);
            box-shadow: var(--shadow-red);
            transform: translateY(-4px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-subtle);
        }

        .card-title {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--spartan-gold);
            margin: 0;
        }

        .card-subtitle {
            font-size: 0.9em;
            color: var(--text-muted);
            margin-top: 5px;
        }

        .card-status {
            font-size: 0.85em;
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 600;
        }

        .status-loading {
            background: var(--spartan-navy-glow);
            color: var(--spartan-navy-light);
        }

        .status-success {
            background: var(--success-glow);
            color: var(--success-green);
        }

        .status-error {
            background: var(--spartan-red-glow);
            color: var(--spartan-red-bright);
        }

        /* Economic Cycle Indicator */
        .cycle-score-container {
            text-align: center;
            margin: 20px 0;
        }

        .cycle-score {
            font-size: 4em;
            font-weight: 700;
            color: var(--spartan-gold);
            margin: 10px 0;
        }

        .cycle-regime {
            font-size: 1.8em;
            font-weight: 600;
            margin: 10px 0;
            padding: 10px 20px;
            border-radius: 8px;
            display: inline-block;
        }

        .regime-expansion {
            background: var(--success-glow);
            color: var(--success-green);
            border: 2px solid var(--success-green);
        }

        .regime-slowdown {
            background: rgba(255, 140, 0, 0.3);
            color: var(--warning-orange);
            border: 2px solid var(--warning-orange);
        }

        .regime-recession {
            background: var(--spartan-red-glow);
            color: var(--spartan-red-bright);
            border: 2px solid var(--spartan-red);
        }

        .regime-neutral {
            background: var(--spartan-navy-glow);
            color: var(--spartan-navy-light);
            border: 2px solid var(--spartan-navy);
        }

        .allocation-bars {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .allocation-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .allocation-label {
            min-width: 120px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .allocation-bar {
            flex: 1;
            height: 30px;
            background: var(--bg-hover);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .allocation-fill {
            height: 100%;
            background: var(--gradient-red);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: 600;
        }

        /* Correlation Matrix */
        .correlation-matrix {
            overflow-x: auto;
        }

        .correlation-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .correlation-table th,
        .correlation-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid var(--border-subtle);
        }

        .correlation-table th {
            background: var(--gradient-navy);
            color: white;
            font-weight: 700;
        }

        .correlation-cell {
            font-weight: 600;
            border-radius: 4px;
            padding: 8px;
        }

        .corr-strong-positive {
            background: rgba(34, 139, 34, 0.4);
            color: var(--success-green);
        }

        .corr-positive {
            background: rgba(34, 139, 34, 0.2);
            color: var(--success-green);
        }

        .corr-neutral {
            background: rgba(128, 128, 128, 0.2);
            color: var(--text-secondary);
        }

        .corr-negative {
            background: rgba(139, 0, 0, 0.2);
            color: var(--spartan-red-bright);
        }

        .corr-strong-negative {
            background: rgba(139, 0, 0, 0.4);
            color: var(--spartan-red-bright);
        }

        /* Sector Rotation */
        .sector-rankings {
            margin-top: 20px;
        }

        .sector-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            margin-bottom: 10px;
            background: var(--bg-hover);
            border-radius: 8px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .sector-item:hover {
            border-color: var(--spartan-gold);
            transform: translateX(5px);
        }

        .sector-rank {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--spartan-gold);
            min-width: 40px;
            text-align: center;
        }

        .sector-symbol {
            font-size: 1.2em;
            font-weight: 700;
            min-width: 60px;
            color: var(--text-primary);
        }

        .sector-name {
            flex: 1;
            color: var(--text-secondary);
        }

        .sector-return {
            font-size: 1.3em;
            font-weight: 700;
            min-width: 100px;
            text-align: right;
        }

        .return-positive {
            color: var(--success-green);
        }

        .return-negative {
            color: var(--spartan-red-bright);
        }

        .sector-trend {
            min-width: 80px;
            text-align: center;
            padding: 4px 10px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .trend-up {
            background: var(--success-glow);
            color: var(--success-green);
        }

        .trend-down {
            background: var(--spartan-red-glow);
            color: var(--spartan-red-bright);
        }

        .trend-neutral {
            background: var(--spartan-navy-glow);
            color: var(--spartan-navy-light);
        }

        .recommendation-section {
            margin-top: 20px;
            padding: 15px;
            background: var(--bg-hover);
            border-left: 4px solid var(--spartan-gold);
            border-radius: 6px;
        }

        .recommendation-section h4 {
            margin-top: 0;
            color: var(--spartan-gold);
        }

        /* Trade Setups */
        .setups-grid {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .setup-card {
            background: var(--bg-hover);
            border: 2px solid var(--border-subtle);
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .setup-card:hover {
            border-color: var(--spartan-gold);
            transform: translateY(-2px);
        }

        .setup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .setup-symbol {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--spartan-gold);
        }

        .setup-confidence {
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .confidence-high {
            background: var(--success-glow);
            color: var(--success-green);
        }

        .confidence-medium {
            background: rgba(255, 140, 0, 0.3);
            color: var(--warning-orange);
        }

        .setup-details {
            display: grid;
            gap: 10px;
        }

        .setup-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }

        .setup-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .setup-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        .setup-rationale {
            margin-top: 15px;
            padding: 12px;
            background: var(--bg-card);
            border-radius: 6px;
            font-size: 0.95em;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Indicators Grid */
        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .indicator-box {
            background: var(--bg-hover);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .indicator-label {
            font-size: 0.9em;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .indicator-value {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--spartan-gold);
        }

        .indicator-change {
            font-size: 0.85em;
            margin-top: 5px;
        }

        .loading-spinner {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid var(--border-subtle);
            border-top: 4px solid var(--spartan-red);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: var(--spartan-red-glow);
            border: 2px solid var(--spartan-red);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            color: var(--spartan-red-bright);
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .indicators-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- Top Navigation -->
    <div class="spartan-top-nav">
        <a href="index.html" class="spartan-nav-link">Back to Home</a>
    </div>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1>1-3 Month Positions</h1>
            <p>Intermediate-term trading setups based on economic cycles and sector rotation</p>
            <p style="font-size: 0.9em; color: var(--text-muted); margin-top: 10px;">
                Data: FRED Economic Indicators, Yahoo Finance 90-Day History
            </p>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Economic Cycle Indicator -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div>
                        <h2 class="card-title">Economic Cycle Indicator</h2>
                        <p class="card-subtitle">Composite score from GDP, Unemployment, Inflation, Fed Funds</p>
                    </div>
                    <span id="cycle-status" class="card-status status-loading">Loading...</span>
                </div>
                <div id="economic-cycle-content">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p style="margin-top: 15px; color: var(--text-secondary);">Fetching FRED data...</p>
                    </div>
                </div>
            </div>

            <!-- 90-Day Correlation Matrix -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div>
                        <h2 class="card-title">90-Day Correlation Matrix</h2>
                        <p class="card-subtitle">SPY, TLT, GLD, UUP, USO rolling correlations</p>
                    </div>
                    <span id="correlation-status" class="card-status status-loading">Loading...</span>
                </div>
                <div id="correlation-content">
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                        <p style="margin-top: 15px; color: var(--text-secondary);">Fetching Yahoo Finance data...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sector Rotation Rankings -->
        <div class="dashboard-card" style="margin-bottom: 40px;">
            <div class="card-header">
                <div>
                    <h2 class="card-title">Sector Rotation Rankings</h2>
                    <p class="card-subtitle">3-month performance and trend analysis (9 sector ETFs)</p>
                </div>
                <span id="sector-status" class="card-status status-loading">Loading...</span>
            </div>
            <div id="sector-rotation-content">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p style="margin-top: 15px; color: var(--text-secondary);">Fetching sector ETF data...</p>
                </div>
            </div>
        </div>

        <!-- Intermediate-Term Trade Setups -->
        <div class="dashboard-card">
            <div class="card-header">
                <div>
                    <h2 class="card-title">Intermediate-Term Setups</h2>
                    <p class="card-subtitle">1-3 month hold period, sector-based recommendations</p>
                </div>
                <span id="setups-status" class="card-status status-loading">Loading...</span>
            </div>
            <div id="trade-setups-content">
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p style="margin-top: 15px; color: var(--text-secondary);">Generating setups...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Required Scripts -->
    <script src="js/fred_api_client.js"></script>
    <script src="timeframe_data_fetcher_1_3_months.js"></script>

    <script>
        // Initialize data fetcher
        const fetcher = new TimeframeDataFetcher_1_3_Months();

        // Fetch all data on page load
        async function initializeDashboard() {
            console.log('[1-3M Dashboard] Initializing...');

            try {
                // Fetch all data
                const allData = await fetcher.fetchAllData();

                console.log('[1-3M Dashboard] Data fetched:', allData);

                // Render economic cycle
                if (allData.economicCycle.success) {
                    renderEconomicCycle(allData.economicCycle.data);
                    document.getElementById('cycle-status').textContent = 'Ready';
                    document.getElementById('cycle-status').className = 'card-status status-success';
                } else {
                    renderError('economic-cycle-content', allData.economicCycle.error);
                    document.getElementById('cycle-status').textContent = 'Error';
                    document.getElementById('cycle-status').className = 'card-status status-error';
                }

                // Render correlation matrix
                if (allData.correlationMatrix.success) {
                    renderCorrelationMatrix(allData.correlationMatrix.data);
                    document.getElementById('correlation-status').textContent = 'Ready';
                    document.getElementById('correlation-status').className = 'card-status status-success';
                } else {
                    renderError('correlation-content', allData.correlationMatrix.error);
                    document.getElementById('correlation-status').textContent = 'Error';
                    document.getElementById('correlation-status').className = 'card-status status-error';
                }

                // Render sector rotation
                if (allData.sectorRotation.success) {
                    renderSectorRotation(allData.sectorRotation.data);
                    document.getElementById('sector-status').textContent = 'Ready';
                    document.getElementById('sector-status').className = 'card-status status-success';
                } else {
                    renderError('sector-rotation-content', allData.sectorRotation.error);
                    document.getElementById('sector-status').textContent = 'Error';
                    document.getElementById('sector-status').className = 'card-status status-error';
                }

                // Render trade setups
                renderTradeSetups(allData.tradeSetups);
                document.getElementById('setups-status').textContent = 'Ready';
                document.getElementById('setups-status').className = 'card-status status-success';

            } catch (error) {
                console.error('[1-3M Dashboard] Fatal error:', error);
                alert('Failed to load dashboard: ' + error.message);
            }
        }

        function renderEconomicCycle(data) {
            const html = `
                <div class="cycle-score-container">
                    <div class="cycle-score">${data.compositeScore.toFixed(0)}/100</div>
                    <div class="cycle-regime regime-${data.regime.toLowerCase()}">${data.regime}</div>
                    <p style="margin-top: 15px; color: var(--text-secondary); line-height: 1.6;">
                        ${data.interpretation}
                    </p>
                </div>

                <div class="allocation-bars">
                    <div class="allocation-item">
                        <div class="allocation-label">Stocks</div>
                        <div class="allocation-bar">
                            <div class="allocation-fill" style="width: ${data.allocation.stocks}%;">
                                ${data.allocation.stocks}%
                            </div>
                        </div>
                    </div>
                    <div class="allocation-item">
                        <div class="allocation-label">Bonds</div>
                        <div class="allocation-bar">
                            <div class="allocation-fill" style="width: ${data.allocation.bonds}%; background: var(--gradient-navy);">
                                ${data.allocation.bonds}%
                            </div>
                        </div>
                    </div>
                    <div class="allocation-item">
                        <div class="allocation-label">Cash</div>
                        <div class="allocation-bar">
                            <div class="allocation-fill" style="width: ${data.allocation.cash}%; background: var(--gradient-gold);">
                                ${data.allocation.cash}%
                            </div>
                        </div>
                    </div>
                </div>

                <div class="indicators-grid">
                    <div class="indicator-box">
                        <div class="indicator-label">GDP Growth</div>
                        <div class="indicator-value">${data.indicators.gdp.latest ? data.indicators.gdp.latest.toFixed(1) + '%' : 'N/A'}</div>
                        <div class="indicator-change ${data.indicators.gdp.change >= 0 ? 'return-positive' : 'return-negative'}">
                            ${data.indicators.gdp.change >= 0 ? '▲' : '▼'} ${Math.abs(data.indicators.gdp.change).toFixed(2)}%
                        </div>
                    </div>
                    <div class="indicator-box">
                        <div class="indicator-label">Unemployment</div>
                        <div class="indicator-value">${data.indicators.unemployment.latest ? data.indicators.unemployment.latest.toFixed(1) + '%' : 'N/A'}</div>
                        <div class="indicator-change ${data.indicators.unemployment.change <= 0 ? 'return-positive' : 'return-negative'}">
                            ${data.indicators.unemployment.change >= 0 ? '▲' : '▼'} ${Math.abs(data.indicators.unemployment.change).toFixed(2)}%
                        </div>
                    </div>
                    <div class="indicator-box">
                        <div class="indicator-label">Inflation (CPI)</div>
                        <div class="indicator-value">${data.indicators.inflation.latest ? data.indicators.inflation.latest.toFixed(1) : 'N/A'}</div>
                        <div class="indicator-change ${data.indicators.inflation.change >= 0 ? 'return-positive' : 'return-negative'}">
                            ${data.indicators.inflation.change >= 0 ? '▲' : '▼'} ${Math.abs(data.indicators.inflation.change).toFixed(2)}%
                        </div>
                    </div>
                    <div class="indicator-box">
                        <div class="indicator-label">Fed Funds Rate</div>
                        <div class="indicator-value">${data.indicators.fedFunds.latest ? data.indicators.fedFunds.latest.toFixed(2) + '%' : 'N/A'}</div>
                    </div>
                </div>
            `;
            document.getElementById('economic-cycle-content').innerHTML = html;
        }

        function renderCorrelationMatrix(data) {
            if (!data || !data.matrix) {
                renderError('correlation-content', 'No correlation data available');
                return;
            }

            const symbols = data.symbols;
            let html = `
                <div class="correlation-matrix">
                    <table class="correlation-table">
                        <thead>
                            <tr>
                                <th></th>
                                ${symbols.map(s => `<th>${s}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
            `;

            symbols.forEach(symbol1 => {
                html += '<tr>';
                html += `<th>${symbol1}</th>`;
                symbols.forEach(symbol2 => {
                    const corr = data.matrix[symbol1][symbol2];
                    const corrClass = getCorrelationClass(corr);
                    const displayValue = symbol1 === symbol2 ? '1.00' : corr.toFixed(2);
                    html += `<td><div class="correlation-cell ${corrClass}">${displayValue}</div></td>`;
                });
                html += '</tr>';
            });

            html += `
                        </tbody>
                    </table>
                </div>
                <div class="recommendation-section">
                    <h4>Interpretation</h4>
                    <p>${data.interpretation}</p>
                </div>
            `;

            document.getElementById('correlation-content').innerHTML = html;
        }

        function getCorrelationClass(corr) {
            if (corr >= 0.7) return 'corr-strong-positive';
            if (corr >= 0.3) return 'corr-positive';
            if (corr <= -0.7) return 'corr-strong-negative';
            if (corr <= -0.3) return 'corr-negative';
            return 'corr-neutral';
        }

        function renderSectorRotation(data) {
            if (!data || !data.rankings) {
                renderError('sector-rotation-content', 'No sector data available');
                return;
            }

            let html = '<div class="sector-rankings">';

            data.rankings.forEach((sector, index) => {
                const returnClass = sector.return3M >= 0 ? 'return-positive' : 'return-negative';
                const trendClass = sector.trend === 'Up' ? 'trend-up' : (sector.trend === 'Down' ? 'trend-down' : 'trend-neutral');

                html += `
                    <div class="sector-item">
                        <div class="sector-rank">#${index + 1}</div>
                        <div class="sector-symbol">${sector.symbol}</div>
                        <div class="sector-name">${sector.name}</div>
                        <div class="sector-return ${returnClass}">
                            ${sector.return3M >= 0 ? '+' : ''}${sector.return3M.toFixed(2)}%
                        </div>
                        <div class="sector-trend ${trendClass}">${sector.trend}</div>
                    </div>
                `;
            });

            html += '</div>';

            html += `
                <div class="recommendation-section">
                    <h4>Strategy Recommendation</h4>
                    <p><strong>Buy Top 3:</strong> ${data.buy.map(s => `${s.symbol} (${s.name})`).join(', ')}</p>
                    <p><strong>Sell Bottom 3:</strong> ${data.sell.map(s => `${s.symbol} (${s.name})`).join(', ')}</p>
                    <p style="margin-top: 10px; color: var(--text-muted);">
                        Rotate into outperforming sectors while reducing exposure to underperformers.
                    </p>
                </div>
            `;

            document.getElementById('sector-rotation-content').innerHTML = html;
        }

        function renderTradeSetups(setups) {
            if (!setups || setups.length === 0) {
                document.getElementById('trade-setups-content').innerHTML = `
                    <p style="text-align: center; color: var(--text-muted); padding: 40px;">
                        No trade setups available. Complete data fetch to generate recommendations.
                    </p>
                `;
                return;
            }

            let html = '<div class="setups-grid">';

            setups.forEach(setup => {
                const confidenceClass = setup.confidence === 'High' ? 'confidence-high' : 'confidence-medium';

                html += `
                    <div class="setup-card">
                        <div class="setup-header">
                            <div class="setup-symbol">${setup.symbol}</div>
                            <div class="setup-confidence ${confidenceClass}">${setup.confidence} Confidence</div>
                        </div>
                        <div class="setup-details">
                            <div class="setup-row">
                                <span class="setup-label">Sector:</span>
                                <span class="setup-value">${setup.name}</span>
                            </div>
                            <div class="setup-row">
                                <span class="setup-label">Direction:</span>
                                <span class="setup-value">${setup.direction}</span>
                            </div>
                            <div class="setup-row">
                                <span class="setup-label">Timeframe:</span>
                                <span class="setup-value">${setup.timeframe}</span>
                            </div>
                            <div class="setup-row">
                                <span class="setup-label">Entry:</span>
                                <span class="setup-value">${setup.entry}</span>
                            </div>
                            <div class="setup-row">
                                <span class="setup-label">Target:</span>
                                <span class="setup-value return-positive">${setup.target}</span>
                            </div>
                            <div class="setup-row">
                                <span class="setup-label">Stop Loss:</span>
                                <span class="setup-value return-negative">${setup.stop}</span>
                            </div>
                        </div>
                        <div class="setup-rationale">
                            <strong>Rationale:</strong> ${setup.rationale}
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            document.getElementById('trade-setups-content').innerHTML = html;
        }

        function renderError(containerId, errorMessage) {
            document.getElementById(containerId).innerHTML = `
                <div class="error-message">
                    <h3>⚠ Error Loading Data</h3>
                    <p>${errorMessage || 'Unknown error occurred'}</p>
                    <p style="margin-top: 15px; font-size: 0.9em;">
                        Please check your network connection and API configuration.
                    </p>
                </div>
            `;
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', initializeDashboard);
    </script>
</body>
</html>
