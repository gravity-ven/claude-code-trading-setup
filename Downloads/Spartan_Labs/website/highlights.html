<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Cache Prevention -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0, post-check=0, pre-check=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-control" content="max-age=0">
    <meta name="last-modified" content="2025-11-18 00:00:00">
    <meta name="build-version" content="v1.0-HIGHLIGHTS-DASHBOARD">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spartan Research Station - Market Highlights</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <!-- Spartan Theme -->
    <style>
        :root {
            /* Spartan Color Palette */
            --primary-color: #8B0000;        /* Spartan Red */
            --secondary-color: #B22222;      /* Spartan Firebrick */
            --accent-color: #DC143C;         /* Spartan Crimson */
            --accent-2-color: #FF5252;       /* Bright Red */
            --accent-3-color: #FF6B6B;       /* Light Red */
            --bg-dark: #0a1628;              /* Main Background */
            --bg-darker: #050b14;            /* Darker Background */
            --bg-card: #12203a;              /* Card Background */
            --text-primary: #ffffff;         /* White Text */
            --text-secondary: #b0b8c8;       /* Gray Text */
            --text-muted: #7a8a9a;           /* Muted Gray */
            --border-color: #1e3a5f;         /* Border Color */
            --success-color: #00ff88;        /* Success Green */
            --warning-color: #ff9500;        /* Warning Orange */
            --danger-color: #FF5252;         /* Danger Red */
            --info-color: #0096FF;           /* Info Blue */
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1700px;
            margin: 0 auto;
        }

        /* Spartan Navigation Bar */
        .spartan-nav {
            background: var(--bg-darker);
            border-bottom: 2px solid var(--accent-color);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.3);
        }

        .nav-container {
            max-width: 1700px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-logo {
            height: 35px;
            width: auto;
            filter: brightness(1.1);
        }

        .nav-title {
            color: var(--text-primary);
            text-decoration: none;
            font-size: 1.4rem;
            font-weight: 700;
            transition: color 0.3s ease;
        }

        .nav-title:hover {
            color: var(--accent-color);
        }

        .nav-center {
            display: flex;
            align-items: center;
        }

        .nav-item {
            color: var(--accent-color);
            font-weight: 600;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 8px 16px;
            border: 1px solid var(--accent-color);
            border-radius: 6px;
        }

        .nav-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            color: var(--text-primary);
            border-color: var(--accent-color);
            background: rgba(139, 0, 0, 0.1);
        }

        /* Spartan Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--bg-darker));
            border-radius: 12px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-2-color), var(--accent-color));
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        .header h1 {
            color: var(--accent-color);
            font-size: 2.8rem;
            margin: 0 0 10px 0;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.2rem;
            margin: 0;
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        /* Summary Cards */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .summary-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-2-color));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .summary-card:hover::before {
            opacity: 1;
        }

        .summary-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(139, 0, 0, 0.15);
            border-color: var(--accent-color);
        }

        .summary-title {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin: 0 0 15px 0;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-value {
            font-size: 2.2rem;
            font-weight: 800;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .summary-value.positive {
            color: var(--success-color);
        }

        .summary-value.negative {
            color: var(--danger-color);
        }

        .summary-value.neutral {
            color: var(--text-primary);
        }

        /* Table Styles */
        .highlights-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: var(--bg-card);
            border-radius: 8px;
            overflow: hidden;
        }

        .highlights-table thead {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        .highlights-table th {
            padding: 15px;
            text-align: left;
            color: var(--text-primary);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.85rem;
            border-bottom: 2px solid var(--accent-color);
        }

        .highlights-table td {
            padding: 12px 15px;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
        }

        .highlights-table tbody tr {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .highlights-table tbody tr:hover {
            background: var(--bg-darker);
            transform: scale(1.01);
            box-shadow: 0 2px 8px rgba(220, 20, 60, 0.2);
        }

        .highlights-table tbody tr:last-child td {
            border-bottom: none;
        }

        .table-container {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border-color);
            margin-bottom: 40px;
            overflow-x: auto;
        }

        .table-title {
            font-size: 1.6rem;
            color: var(--accent-color);
            margin: 0 0 25px 0;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Loading Text */
        .loading {
            display: inline-block;
            color: var(--text-secondary);
            font-style: italic;
        }

        .loading::after {
            content: 'Loading...';
        }

        /* Sector Performance */
        .sector-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .sector-card {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .sector-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(139, 0, 0, 0.15);
            border-color: var(--accent-color);
        }

        .sector-name {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .sector-value {
            font-size: 1.8rem;
            font-weight: 700;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 15px;
            }

            .header {
                padding: 30px 20px;
            }

            .header h1 {
                font-size: 2.2rem;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }

            .sector-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .summary-card {
            animation: slideIn 0.6s ease-out forwards;
        }

        .summary-card:nth-child(1) { animation-delay: 0.1s; }
        .summary-card:nth-child(2) { animation-delay: 0.2s; }
        .summary-card:nth-child(3) { animation-delay: 0.3s; }
        .summary-card:nth-child(4) { animation-delay: 0.4s; }

        /* Custom Scrollbar */
        *::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        *::-webkit-scrollbar-track {
            background: var(--bg-darker);
            border-radius: 5px;
        }

        *::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 5px;
            transition: background 0.3s ease;
        }

        *::-webkit-scrollbar-thumb:hover {
            background: var(--accent-2-color);
        }

        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.live {
            background: var(--success-color);
            color: #000;
        }

        .status-badge.loading {
            background: var(--warning-color);
            color: #000;
        }

        .status-badge.error {
            background: var(--danger-color);
            color: white;
        }
    </style>
</head>
<body>
    <!-- Spartan Navigation Bar -->
    <nav class="spartan-nav">
        <div class="nav-container">
            <div class="nav-left">
                <img src="spartan_logo.png" alt="Spartan Research Station" class="nav-logo">
                <a href="index.html" class="nav-title">Spartan Research Station</a>
            </div>
            <div class="nav-center">
                <div class="nav-item active">Market Highlights</div>
            </div>
            <div class="nav-right">
                <a href="index.html" class="nav-link">← Back</a>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <!-- Back Navigation -->
        <div style="margin-bottom: 20px;">
            <a href="index.html" style="display: inline-flex; align-items: center; padding: 10px 20px; background: var(--primary-color); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: all 0.3s ease;">
                <span style="margin-right: 8px;">←</span> Back to Main Dashboard
            </a>
        </div>

        <!-- Spartan Header -->
        <div class="header">
            <h1>MARKET HIGHLIGHTS</h1>
            <p>Real-Time Market Movers, Volume Leaders & Sector Performance</p>
            <div style="margin-top: 15px;">
                <span id="status-indicator" class="status-badge loading">Loading...</span>
                <span id="last-update" style="color: var(--text-muted); margin-left: 10px; font-size: 0.9rem;">
                    Fetching real-time data...
                </span>
            </div>
        </div>

        <!-- Market Summary Cards -->
        <div class="summary-grid">
            <div class="summary-card">
                <div class="summary-title">Market Trend</div>
                <div class="summary-value neutral" id="market-trend">
                    <span class="loading"></span>
                </div>
                <div style="color: var(--text-muted); font-size: 0.85rem; margin-top: 10px;" id="market-trend-desc">
                    Analyzing market direction...
                </div>
            </div>

            <div class="summary-card">
                <div class="summary-title">Avg Gainer Change</div>
                <div class="summary-value positive" id="avg-gainer">
                    <span class="loading"></span>
                </div>
                <div style="color: var(--text-muted); font-size: 0.85rem; margin-top: 10px;">
                    Top 10 average
                </div>
            </div>

            <div class="summary-card">
                <div class="summary-title">Avg Loser Change</div>
                <div class="summary-value negative" id="avg-loser">
                    <span class="loading"></span>
                </div>
                <div style="color: var(--text-muted); font-size: 0.85rem; margin-top: 10px;">
                    Bottom 10 average
                </div>
            </div>

            <div class="summary-card">
                <div class="summary-title">Avg Volume</div>
                <div class="summary-value neutral" id="avg-volume">
                    <span class="loading"></span>
                </div>
                <div style="color: var(--text-muted); font-size: 0.85rem; margin-top: 10px;">
                    Top volume leaders
                </div>
            </div>
        </div>

        <!-- Top 10 Gainers -->
        <div class="table-container">
            <h3 class="table-title">Top 10 Market Gainers</h3>
            <table class="highlights-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Symbol</th>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Change</th>
                        <th>% Change</th>
                        <th>Volume</th>
                    </tr>
                </thead>
                <tbody id="gainers-table">
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 30px;">
                            <span class="loading"></span>
                            <div style="margin-top: 15px; color: var(--text-secondary);">
                                Fetching real-time gainer data from yfinance API...
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Top 10 Losers -->
        <div class="table-container">
            <h3 class="table-title">Top 10 Market Losers</h3>
            <table class="highlights-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Symbol</th>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Change</th>
                        <th>% Change</th>
                        <th>Volume</th>
                    </tr>
                </thead>
                <tbody id="losers-table">
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 30px;">
                            <span class="loading"></span>
                            <div style="margin-top: 15px; color: var(--text-secondary);">
                                Fetching real-time loser data from yfinance API...
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Volume Leaders -->
        <div class="table-container">
            <h3 class="table-title">Top 10 Volume Leaders</h3>
            <table class="highlights-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Symbol</th>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Change</th>
                        <th>% Change</th>
                        <th>Volume</th>
                    </tr>
                </thead>
                <tbody id="volume-table">
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 30px;">
                            <span class="loading"></span>
                            <div style="margin-top: 15px; color: var(--text-secondary);">
                                Fetching real-time volume data from yfinance API...
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Sector Performance Overview -->
        <div class="table-container">
            <h3 class="table-title">Sector Performance Overview</h3>
            <div class="sector-grid" id="sector-grid">
                <div class="sector-card">
                    <div class="sector-name">Technology</div>
                    <div class="sector-value neutral">
                        <span class="loading"></span>
                    </div>
                </div>
                <div class="sector-card">
                    <div class="sector-name">Healthcare</div>
                    <div class="sector-value neutral">
                        <span class="loading"></span>
                    </div>
                </div>
                <div class="sector-card">
                    <div class="sector-name">Financials</div>
                    <div class="sector-value neutral">
                        <span class="loading"></span>
                    </div>
                </div>
                <div class="sector-card">
                    <div class="sector-name">Energy</div>
                    <div class="sector-value neutral">
                        <span class="loading"></span>
                    </div>
                </div>
                <div class="sector-card">
                    <div class="sector-name">Consumer</div>
                    <div class="sector-value neutral">
                        <span class="loading"></span>
                    </div>
                </div>
                <div class="sector-card">
                    <div class="sector-name">Industrials</div>
                    <div class="sector-value neutral">
                        <span class="loading"></span>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Market Highlights Data Fetcher -->
    <script>
        // Market Highlights Dashboard - Real-Time Data Integration
        // NO FAKE DATA - Uses yfinance API for real market data

        const HighlightsDashboard = {
            apiEndpoint: 'http://localhost:5000/api/highlights',
            updateInterval: 60000, // Update every 60 seconds

            // Major stock symbols for monitoring (S&P 500 components)
            symbols: [
                'AAPL', 'MSFT', 'GOOGL', 'AMZN', 'NVDA', 'META', 'TSLA', 'BRK-B',
                'JPM', 'V', 'JNJ', 'WMT', 'PG', 'MA', 'HD', 'UNH', 'BAC', 'DIS',
                'ADBE', 'CRM', 'NFLX', 'CMCSA', 'PFE', 'CSCO', 'KO', 'PEP', 'TMO',
                'ABBV', 'COST', 'MRK', 'CVX', 'ABT', 'ACN', 'NKE', 'LLY', 'AVGO',
                'DHR', 'NEE', 'TXN', 'PM', 'UPS', 'RTX', 'QCOM', 'HON', 'ORCL',
                'IBM', 'AMGN', 'SBUX', 'LOW', 'INTU', 'SPGI', 'AMAT', 'MDT', 'GE',
                'CAT', 'ISRG', 'AXP', 'NOW', 'BA', 'GILD', 'BLK', 'MMM', 'DE',
                'BKNG', 'AMT', 'TJX', 'SYK', 'ZTS', 'PLD', 'MO', 'ADP', 'CI',
                'MDLZ', 'VRTX', 'CB', 'REGN', 'SCHW', 'SO', 'TGT', 'BMY', 'USB',
                'BSX', 'DUK', 'MU', 'EQIX', 'SLB', 'PNC', 'CL', 'LRCX', 'EOG',
                'ITW', 'AON', 'HUM', 'MMC', 'EL', 'APD', 'ICE', 'GD', 'NSC'
            ],

            // Sector ETFs for sector performance
            sectorETFs: {
                'Technology': 'XLK',
                'Healthcare': 'XLV',
                'Financials': 'XLF',
                'Energy': 'XLE',
                'Consumer': 'XLY',
                'Industrials': 'XLI'
            },

            init() {
                console.log('Initializing Market Highlights Dashboard...');
                this.fetchMarketData();
                setInterval(() => this.fetchMarketData(), this.updateInterval);
            },

            async fetchMarketData() {
                try {
                    // Fetch data from all symbols
                    const promises = this.symbols.map(symbol => this.fetchSymbolData(symbol));
                    const results = await Promise.all(promises);

                    // Filter out failed fetches
                    const validData = results.filter(data => data !== null);

                    if (validData.length === 0) {
                        this.showError('No market data available. API may be unavailable.');
                        return;
                    }

                    // Process and display data
                    this.processMarketData(validData);

                    // Update status
                    this.updateStatus('LIVE', new Date().toLocaleString());

                    // Fetch sector performance
                    this.fetchSectorPerformance();

                } catch (error) {
                    console.error('Error fetching market data:', error);
                    this.showError(`Failed to fetch market data: ${error.message}`);
                }
            },

            async fetchSymbolData(symbol) {
                try {
                    // In production, this would call a backend API that uses yfinance
                    // For now, we'll return null to indicate API is needed
                    const response = await fetch(`${this.apiEndpoint}/symbol/${symbol}`);

                    if (!response.ok) {
                        return null;
                    }

                    const data = await response.json();
                    return {
                        symbol: symbol,
                        name: data.name || symbol,
                        price: data.price || 0,
                        change: data.change || 0,
                        changePercent: data.changePercent || 0,
                        volume: data.volume || 0
                    };
                } catch (error) {
                    console.warn(`Failed to fetch ${symbol}:`, error.message);
                    return null;
                }
            },

            processMarketData(data) {
                // Sort by percent change for gainers/losers
                const sortedByChange = [...data].sort((a, b) => b.changePercent - a.changePercent);
                const gainers = sortedByChange.slice(0, 10);
                const losers = sortedByChange.slice(-10).reverse();

                // Sort by volume for volume leaders
                const volumeLeaders = [...data].sort((a, b) => b.volume - a.volume).slice(0, 10);

                // Update tables
                this.updateGainersTable(gainers);
                this.updateLosersTable(losers);
                this.updateVolumeTable(volumeLeaders);

                // Update summary cards
                this.updateSummaryCards(gainers, losers, volumeLeaders, data);
            },

            updateGainersTable(gainers) {
                const tbody = document.getElementById('gainers-table');

                if (gainers.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">
                                No gainer data available. Please ensure backend API is running.
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = gainers.map((stock, index) => `
                    <tr>
                        <td>${index + 1}</td>
                        <td style="font-weight: 700; color: var(--accent-color);">${stock.symbol}</td>
                        <td>${stock.name}</td>
                        <td>$${stock.price.toFixed(2)}</td>
                        <td style="color: var(--success-color);">+${stock.change.toFixed(2)}</td>
                        <td style="color: var(--success-color); font-weight: 700;">+${stock.changePercent.toFixed(2)}%</td>
                        <td>${this.formatVolume(stock.volume)}</td>
                    </tr>
                `).join('');
            },

            updateLosersTable(losers) {
                const tbody = document.getElementById('losers-table');

                if (losers.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">
                                No loser data available. Please ensure backend API is running.
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = losers.map((stock, index) => `
                    <tr>
                        <td>${index + 1}</td>
                        <td style="font-weight: 700; color: var(--accent-color);">${stock.symbol}</td>
                        <td>${stock.name}</td>
                        <td>$${stock.price.toFixed(2)}</td>
                        <td style="color: var(--danger-color);">${stock.change.toFixed(2)}</td>
                        <td style="color: var(--danger-color); font-weight: 700;">${stock.changePercent.toFixed(2)}%</td>
                        <td>${this.formatVolume(stock.volume)}</td>
                    </tr>
                `).join('');
            },

            updateVolumeTable(volumeLeaders) {
                const tbody = document.getElementById('volume-table');

                if (volumeLeaders.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 20px; color: var(--text-muted);">
                                No volume data available. Please ensure backend API is running.
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = volumeLeaders.map((stock, index) => `
                    <tr>
                        <td>${index + 1}</td>
                        <td style="font-weight: 700; color: var(--accent-color);">${stock.symbol}</td>
                        <td>${stock.name}</td>
                        <td>$${stock.price.toFixed(2)}</td>
                        <td style="color: ${stock.change >= 0 ? 'var(--success-color)' : 'var(--danger-color)'};">
                            ${stock.change >= 0 ? '+' : ''}${stock.change.toFixed(2)}
                        </td>
                        <td style="color: ${stock.changePercent >= 0 ? 'var(--success-color)' : 'var(--danger-color)'}; font-weight: 700;">
                            ${stock.changePercent >= 0 ? '+' : ''}${stock.changePercent.toFixed(2)}%
                        </td>
                        <td style="font-weight: 700;">${this.formatVolume(stock.volume)}</td>
                    </tr>
                `).join('');
            },

            updateSummaryCards(gainers, losers, volumeLeaders, allData) {
                // Average gainer change
                const avgGainerChange = gainers.reduce((sum, s) => sum + s.changePercent, 0) / gainers.length;
                document.getElementById('avg-gainer').innerHTML = `+${avgGainerChange.toFixed(2)}%`;

                // Average loser change
                const avgLoserChange = losers.reduce((sum, s) => sum + s.changePercent, 0) / losers.length;
                document.getElementById('avg-loser').innerHTML = `${avgLoserChange.toFixed(2)}%`;

                // Average volume
                const avgVolume = volumeLeaders.reduce((sum, s) => sum + s.volume, 0) / volumeLeaders.length;
                document.getElementById('avg-volume').innerHTML = this.formatVolume(avgVolume);

                // Market trend
                const positiveStocks = allData.filter(s => s.changePercent > 0).length;
                const totalStocks = allData.length;
                const positiveRatio = positiveStocks / totalStocks;

                const trendEl = document.getElementById('market-trend');
                const trendDescEl = document.getElementById('market-trend-desc');

                if (positiveRatio > 0.6) {
                    trendEl.innerHTML = 'BULLISH';
                    trendEl.className = 'summary-value positive';
                    trendDescEl.innerHTML = `${(positiveRatio * 100).toFixed(0)}% stocks positive`;
                } else if (positiveRatio < 0.4) {
                    trendEl.innerHTML = 'BEARISH';
                    trendEl.className = 'summary-value negative';
                    trendDescEl.innerHTML = `${((1 - positiveRatio) * 100).toFixed(0)}% stocks negative`;
                } else {
                    trendEl.innerHTML = 'NEUTRAL';
                    trendEl.className = 'summary-value neutral';
                    trendDescEl.innerHTML = 'Mixed market sentiment';
                }
            },

            async fetchSectorPerformance() {
                const sectorGrid = document.getElementById('sector-grid');

                for (const [sector, etf] of Object.entries(this.sectorETFs)) {
                    try {
                        const data = await this.fetchSymbolData(etf);

                        if (data) {
                            const sectorCard = Array.from(sectorGrid.children).find(
                                card => card.querySelector('.sector-name').textContent === sector
                            );

                            if (sectorCard) {
                                const valueEl = sectorCard.querySelector('.sector-value');
                                valueEl.innerHTML = `${data.changePercent >= 0 ? '+' : ''}${data.changePercent.toFixed(2)}%`;
                                valueEl.className = `sector-value ${data.changePercent >= 0 ? 'positive' : 'negative'}`;
                            }
                        }
                    } catch (error) {
                        console.warn(`Failed to fetch sector ${sector}:`, error);
                    }
                }
            },

            formatVolume(volume) {
                if (volume >= 1e9) return (volume / 1e9).toFixed(2) + 'B';
                if (volume >= 1e6) return (volume / 1e6).toFixed(2) + 'M';
                if (volume >= 1e3) return (volume / 1e3).toFixed(2) + 'K';
                return volume.toString();
            },

            updateStatus(status, timestamp) {
                const statusEl = document.getElementById('status-indicator');
                const updateEl = document.getElementById('last-update');

                statusEl.className = `status-badge ${status.toLowerCase()}`;
                statusEl.textContent = status;
                updateEl.textContent = `Last updated: ${timestamp}`;
            },

            showError(message) {
                this.updateStatus('ERROR', new Date().toLocaleString());

                // Show error in all tables
                const errorHtml = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 30px;">
                            <div style="color: var(--danger-color); font-size: 1.2rem; margin-bottom: 10px;">Data Unavailable</div>
                            <div style="color: var(--text-muted);">${message}</div>
                            <div style="color: var(--text-secondary); margin-top: 15px; font-size: 0.9rem;">
                                Please ensure the backend API server is running on http://localhost:5000
                            </div>
                        </td>
                    </tr>
                `;

                document.getElementById('gainers-table').innerHTML = errorHtml;
                document.getElementById('losers-table').innerHTML = errorHtml;
                document.getElementById('volume-table').innerHTML = errorHtml;
            }
        };

        // Initialize dashboard on page load
        document.addEventListener('DOMContentLoaded', () => {
            HighlightsDashboard.init();
        });
    </script>
</body>
</html>
