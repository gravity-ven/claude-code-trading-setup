<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Cache Prevention -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0, post-check=0, pre-check=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-control" content="max-age=0">
    <meta name="last-modified" content="2025-11-18 12:00:00">
    <meta name="build-version" content="v1.0-SEASONALITY-RESEARCH">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spartan Research Station - Seasonality Analysis</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <!-- Spartan Theme -->
    <style>
        :root {
            /* Spartan Color Palette */
            --primary-color: #8B0000;        /* Spartan Red */
            --secondary-color: #B22222;      /* Spartan Firebrick */
            --accent-color: #DC143C;         /* Spartan Crimson */
            --accent-2-color: #FF5252;       /* Bright Red */
            --accent-3-color: #FF6B6B;       /* Light Red */
            --bg-dark: #0a1628;              /* Main Background */
            --bg-darker: #050b14;            /* Darker Background */
            --bg-card: #12203a;              /* Card Background */
            --text-primary: #ffffff;         /* White Text */
            --text-secondary: #b0b8c8;       /* Gray Text */
            --text-muted: #7a8a9a;           /* Muted Gray */
            --border-color: #1e3a5f;         /* Border Color */
            --success-color: #00ff88;        /* Success Green */
            --warning-color: #ff9500;        /* Warning Orange */
            --danger-color: #FF5252;         /* Danger Red */
            --info-color: #0096FF;           /* Info Blue */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1700px;
            margin: 0 auto;
        }

        /* Spartan Navigation */
        .spartan-nav {
            background: var(--bg-darker);
            border-bottom: 2px solid var(--accent-color);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.3);
            margin: -20px -20px 20px -20px;
        }

        .nav-container {
            max-width: 1700px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-logo {
            height: 35px;
            width: auto;
            filter: brightness(1.1);
        }

        .nav-title {
            color: var(--text-primary);
            text-decoration: none;
            font-size: 1.4rem;
            font-weight: 700;
            transition: color 0.3s ease;
        }

        .nav-title:hover {
            color: var(--accent-color);
        }

        .nav-center {
            display: flex;
            align-items: center;
        }

        .nav-item {
            color: var(--accent-color);
            font-weight: 600;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 8px 16px;
            border: 1px solid var(--accent-color);
            border-radius: 6px;
        }

        .nav-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            color: var(--text-primary);
            border-color: var(--accent-color);
            background: rgba(139, 0, 0, 0.1);
        }

        /* Spartan Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--bg-darker));
            border-radius: 12px;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-2-color), var(--accent-color));
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        .header h1 {
            color: var(--accent-color);
            font-size: 2.8rem;
            margin: 0 0 10px 0;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.2rem;
            margin: 0;
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        .header-subtitle {
            margin-top: 15px;
            font-size: 0.95rem;
            color: var(--text-muted);
        }

        /* Metric Cards */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-2-color));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .metric-card:hover::before {
            opacity: 1;
        }

        .metric-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(139, 0, 0, 0.15);
            border-color: var(--accent-color);
        }

        .metric-title {
            font-size: 1.2rem;
            color: var(--accent-color);
            margin: 0 0 15px 0;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metric-value {
            font-size: 2.2rem;
            font-weight: 800;
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .metric-value.positive {
            color: var(--success-color);
        }

        .metric-value.negative {
            color: var(--danger-color);
        }

        .metric-value.neutral {
            color: var(--text-primary);
        }

        .metric-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        /* Chart Cards */
        .chart-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid var(--border-color);
            margin-bottom: 30px;
        }

        .chart-title {
            font-size: 1.6rem;
            color: var(--accent-color);
            margin: 0 0 25px 0;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Heatmap */
        .heatmap-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        .heatmap {
            display: grid;
            gap: 8px;
            margin-top: 15px;
        }

        .heatmap-row {
            display: grid;
            grid-template-columns: 120px repeat(12, 1fr);
            gap: 8px;
            align-items: center;
        }

        .heatmap-label {
            font-weight: 600;
            color: var(--text-secondary);
            text-align: right;
            padding-right: 10px;
            font-size: 0.9rem;
        }

        .heatmap-cell {
            padding: 12px 8px;
            text-align: center;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .heatmap-cell:hover {
            transform: scale(1.1);
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .heatmap-header {
            font-weight: 700;
            color: var(--accent-color);
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 1px;
            padding: 8px;
        }

        /* Calendar Grid */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .calendar-card {
            background: var(--bg-darker);
            border-radius: 8px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .calendar-card-title {
            font-size: 1.1rem;
            color: var(--accent-color);
            margin-bottom: 15px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .calendar-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .calendar-stat:last-child {
            border-bottom: none;
        }

        .calendar-stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .calendar-stat-value {
            font-weight: 700;
            font-size: 1.1rem;
        }

        /* Probability Chart */
        .probability-bars {
            margin-top: 20px;
        }

        .probability-bar-item {
            margin-bottom: 20px;
        }

        .probability-bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .probability-bar-bg {
            background: var(--bg-darker);
            height: 30px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            border: 1px solid var(--border-color);
        }

        .probability-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-2-color));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.85rem;
            transition: width 0.6s ease;
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table thead {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        .data-table th {
            padding: 15px;
            text-align: left;
            color: var(--text-primary);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.85rem;
        }

        .data-table td {
            padding: 12px 15px;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
        }

        .data-table tbody tr {
            transition: all 0.2s ease;
        }

        .data-table tbody tr:hover {
            background: var(--bg-darker);
            transform: scale(1.01);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .heatmap-row {
                grid-template-columns: 80px repeat(12, 1fr);
            }

            .heatmap-cell {
                padding: 8px 4px;
                font-size: 0.75rem;
            }
        }

        /* Scrollbar */
        *::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        *::-webkit-scrollbar-track {
            background: var(--bg-darker);
            border-radius: 5px;
        }

        *::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 5px;
            transition: background 0.3s ease;
        }

        *::-webkit-scrollbar-thumb:hover {
            background: var(--accent-2-color);
        }

        /* Status Indicator */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .status-indicator.success {
            background: var(--success-color);
            box-shadow: 0 0 8px var(--success-color);
        }

        .status-indicator.pending {
            background: var(--warning-color);
            box-shadow: 0 0 8px var(--warning-color);
        }
    </style>
</head>
<body>
    <!-- Spartan Navigation Bar -->
    <nav class="spartan-nav">
        <div class="nav-container">
            <div class="nav-left">
                <img src="spartan_logo.png" alt="Spartan Research Station" class="nav-logo">
                <a href="index.html" class="nav-title">Spartan Research Station</a>
            </div>
            <div class="nav-center">
                <div class="nav-item">Seasonality Research</div>
            </div>
            <div class="nav-right">
                <a href="index.html" class="nav-link">‚Üê Back</a>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <!-- Header -->
        <div class="header">
            <h1>üìÖ SEASONALITY RESEARCH</h1>
            <p>Historical Seasonal Patterns & Calendar Effects Analysis</p>
            <div class="header-subtitle">
                <span id="data-status">
                    <span class="status-indicator pending"></span>
                    Loading historical data...
                </span>
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="metrics-grid" id="key-metrics">
            <div class="metric-card">
                <div class="metric-title">Best Month (S&P 500)</div>
                <div class="metric-value neutral" id="best-month">
                    <span class="loading"></span>
                </div>
                <div class="metric-subtitle" id="best-month-perf"></div>
            </div>

            <div class="metric-card">
                <div class="metric-title">Worst Month (S&P 500)</div>
                <div class="metric-value neutral" id="worst-month">
                    <span class="loading"></span>
                </div>
                <div class="metric-subtitle" id="worst-month-perf"></div>
            </div>

            <div class="metric-card">
                <div class="metric-title">Most Consistent</div>
                <div class="metric-value neutral" id="most-consistent">
                    <span class="loading"></span>
                </div>
                <div class="metric-subtitle" id="most-consistent-win"></div>
            </div>

            <div class="metric-card">
                <div class="metric-title">Data Period</div>
                <div class="metric-value neutral" id="data-period">
                    <span class="loading"></span>
                </div>
                <div class="metric-subtitle">Years of Historical Data</div>
            </div>
        </div>

        <!-- Monthly Performance Heatmap -->
        <div class="chart-card">
            <h2 class="chart-title">üìä Monthly Performance Heatmap - S&P 500</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Average monthly returns based on <span id="sp500-years">-</span> years of historical data
            </p>
            <div class="heatmap-container">
                <div class="heatmap" id="sp500-heatmap">
                    <div style="text-align: center; padding: 40px;">
                        <span class="loading"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- NASDAQ & Dow Heatmaps -->
        <div class="chart-card">
            <h2 class="chart-title">üìà NASDAQ Monthly Performance</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Technology-focused index seasonality patterns
            </p>
            <div class="heatmap-container">
                <div class="heatmap" id="nasdaq-heatmap">
                    <div style="text-align: center; padding: 40px;">
                        <span class="loading"></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="chart-card">
            <h2 class="chart-title">üìä Dow Jones Monthly Performance</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Blue-chip index seasonality patterns
            </p>
            <div class="heatmap-container">
                <div class="heatmap" id="dow-heatmap">
                    <div style="text-align: center; padding: 40px;">
                        <span class="loading"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Monthly Win Rate -->
        <div class="chart-card">
            <h2 class="chart-title">üéØ Monthly Win Rate - S&P 500</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Percentage of time each month closes positive
            </p>
            <div class="probability-bars" id="win-rate-bars">
                <div style="text-align: center; padding: 40px;">
                    <span class="loading"></span>
                </div>
            </div>
        </div>

        <!-- Calendar Effects -->
        <div class="chart-card">
            <h2 class="chart-title">üìÖ Calendar Effects Analysis</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Famous calendar anomalies and their historical performance
            </p>
            <div class="calendar-grid" id="calendar-effects">
                <div style="text-align: center; padding: 40px; grid-column: 1/-1;">
                    <span class="loading"></span>
                </div>
            </div>
        </div>

        <!-- Sector Seasonality -->
        <div class="chart-card">
            <h2 class="chart-title">üè¢ Sector Seasonality Matrix</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Best months for major market sectors
            </p>
            <div class="heatmap-container">
                <div class="heatmap" id="sector-heatmap">
                    <div style="text-align: center; padding: 40px;">
                        <span class="loading"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Best/Worst Months Detail -->
        <div class="chart-card">
            <h2 class="chart-title">üìä Best & Worst Months Statistical Summary</h2>
            <div style="overflow-x: auto;">
                <table class="data-table" id="month-stats-table">
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Avg Return</th>
                            <th>Win Rate</th>
                            <th>Best Year</th>
                            <th>Worst Year</th>
                            <th>Std Dev</th>
                            <th>Ranking</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 30px;">
                                <span class="loading"></span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- Seasonality Analysis Script -->
    <script>
        // Seasonality Analysis Engine
        class SeasonalityAnalyzer {
            constructor() {
                this.monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                this.fullMonthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                                       'July', 'August', 'September', 'October', 'November', 'December'];
                this.data = {};
                this.initialized = false;
            }

            async initialize() {
                if (this.initialized) return;

                try {
                    // Fetch historical data for major indices
                    await Promise.all([
                        this.fetchIndexData('SPY', 'sp500'),
                        this.fetchIndexData('QQQ', 'nasdaq'),
                        this.fetchIndexData('DIA', 'dow'),
                        this.fetchSectorData()
                    ]);

                    this.initialized = true;
                    this.updateStatus('Data loaded successfully', true);
                    this.renderAll();
                } catch (error) {
                    console.error('Seasonality initialization error:', error);
                    this.updateStatus('Error loading data', false);
                }
            }

            async fetchIndexData(symbol, key) {
                try {
                    // Using yfinance proxy - fetch 20 years of monthly data
                    const endDate = new Date();
                    const startDate = new Date(endDate.getFullYear() - 20, 0, 1);

                    const url = `http://localhost:5002/api/yahoo/chart/${symbol}?period1=${Math.floor(startDate.getTime()/1000)}&period2=${Math.floor(endDate.getTime()/1000)}&interval=1mo`;

                    const response = await fetch(url);
                    const data = await response.json();

                    if (data.chart && data.chart.result && data.chart.result[0]) {
                        const result = data.chart.result[0];
                        const timestamps = result.timestamp;
                        const closes = result.indicators.quote[0].close;

                        // Calculate monthly returns
                        const monthlyReturns = [];
                        for (let i = 1; i < closes.length; i++) {
                            if (closes[i] && closes[i-1]) {
                                const date = new Date(timestamps[i] * 1000);
                                const returnPct = ((closes[i] - closes[i-1]) / closes[i-1]) * 100;
                                monthlyReturns.push({
                                    year: date.getFullYear(),
                                    month: date.getMonth(),
                                    return: returnPct
                                });
                            }
                        }

                        this.data[key] = this.analyzeMonthlyReturns(monthlyReturns);
                        console.log(`${key} data loaded:`, this.data[key].summary);
                    }
                } catch (error) {
                    console.error(`Error fetching ${symbol}:`, error);
                }
            }

            analyzeMonthlyReturns(returns) {
                // Group by month
                const byMonth = {};
                for (let i = 0; i < 12; i++) {
                    byMonth[i] = [];
                }

                returns.forEach(r => {
                    byMonth[r.month].push({
                        year: r.year,
                        return: r.return
                    });
                });

                // Calculate statistics for each month
                const monthStats = [];
                for (let month = 0; month < 12; month++) {
                    const values = byMonth[month];
                    if (values.length === 0) continue;

                    const returns = values.map(v => v.return);
                    const avg = returns.reduce((a, b) => a + b, 0) / returns.length;
                    const positive = returns.filter(v => v > 0).length;
                    const winRate = (positive / returns.length) * 100;
                    const max = Math.max(...returns);
                    const min = Math.min(...returns);

                    // Find best and worst years
                    const sorted = [...values].sort((a, b) => b.return - a.return);
                    const bestYear = sorted[0];
                    const worstYear = sorted[sorted.length - 1];

                    // Standard deviation
                    const variance = returns.reduce((sum, val) => sum + Math.pow(val - avg, 2), 0) / returns.length;
                    const stdDev = Math.sqrt(variance);

                    monthStats.push({
                        month: month,
                        avg: avg,
                        winRate: winRate,
                        max: max,
                        min: min,
                        stdDev: stdDev,
                        count: returns.length,
                        bestYear: bestYear,
                        worstYear: worstYear
                    });
                }

                // Find best and worst
                const sorted = [...monthStats].sort((a, b) => b.avg - a.avg);
                const best = sorted[0];
                const worst = sorted[sorted.length - 1];
                const mostConsistent = [...monthStats].sort((a, b) => b.winRate - a.winRate)[0];

                return {
                    monthStats: monthStats,
                    best: best,
                    worst: worst,
                    mostConsistent: mostConsistent,
                    summary: {
                        years: Math.floor(returns.length / 12),
                        totalMonths: returns.length
                    }
                };
            }

            async fetchSectorData() {
                // Major sector ETFs
                const sectors = {
                    'XLK': 'Technology',
                    'XLF': 'Financials',
                    'XLV': 'Healthcare',
                    'XLE': 'Energy',
                    'XLY': 'Consumer Disc',
                    'XLP': 'Consumer Staples',
                    'XLI': 'Industrials',
                    'XLB': 'Materials',
                    'XLU': 'Utilities',
                    'XLRE': 'Real Estate'
                };

                this.data.sectors = {};

                for (const [symbol, name] of Object.entries(sectors)) {
                    try {
                        const endDate = new Date();
                        const startDate = new Date(endDate.getFullYear() - 10, 0, 1);

                        const url = `http://localhost:5002/api/yahoo/chart/${symbol}?period1=${Math.floor(startDate.getTime()/1000)}&period2=${Math.floor(endDate.getTime()/1000)}&interval=1mo`;

                        const response = await fetch(url);
                        const data = await response.json();

                        if (data.chart && data.chart.result && data.chart.result[0]) {
                            const result = data.chart.result[0];
                            const timestamps = result.timestamp;
                            const closes = result.indicators.quote[0].close;

                            const monthlyReturns = [];
                            for (let i = 1; i < closes.length; i++) {
                                if (closes[i] && closes[i-1]) {
                                    const date = new Date(timestamps[i] * 1000);
                                    const returnPct = ((closes[i] - closes[i-1]) / closes[i-1]) * 100;
                                    monthlyReturns.push({
                                        month: date.getMonth(),
                                        return: returnPct
                                    });
                                }
                            }

                            // Average by month
                            const monthAvg = new Array(12).fill(0);
                            const monthCount = new Array(12).fill(0);

                            monthlyReturns.forEach(r => {
                                monthAvg[r.month] += r.return;
                                monthCount[r.month]++;
                            });

                            for (let i = 0; i < 12; i++) {
                                if (monthCount[i] > 0) {
                                    monthAvg[i] /= monthCount[i];
                                }
                            }

                            this.data.sectors[name] = monthAvg;
                        }
                    } catch (error) {
                        console.error(`Error fetching sector ${symbol}:`, error);
                    }
                }
            }

            updateStatus(message, success) {
                const statusEl = document.getElementById('data-status');
                if (statusEl) {
                    statusEl.innerHTML = `
                        <span class="status-indicator ${success ? 'success' : 'pending'}"></span>
                        ${message}
                    `;
                }
            }

            renderAll() {
                if (!this.data.sp500) return;

                this.renderKeyMetrics();
                this.renderHeatmap('sp500', 'sp500-heatmap');
                this.renderHeatmap('nasdaq', 'nasdaq-heatmap');
                this.renderHeatmap('dow', 'dow-heatmap');
                this.renderWinRateBars();
                this.renderCalendarEffects();
                this.renderSectorHeatmap();
                this.renderMonthStatsTable();
            }

            renderKeyMetrics() {
                const sp500 = this.data.sp500;

                // Best Month
                document.getElementById('best-month').innerHTML = this.fullMonthNames[sp500.best.month];
                document.getElementById('best-month').className = 'metric-value positive';
                document.getElementById('best-month-perf').innerHTML = `Avg: +${sp500.best.avg.toFixed(2)}%`;

                // Worst Month
                document.getElementById('worst-month').innerHTML = this.fullMonthNames[sp500.worst.month];
                document.getElementById('worst-month').className = 'metric-value negative';
                document.getElementById('worst-month-perf').innerHTML = `Avg: ${sp500.worst.avg.toFixed(2)}%`;

                // Most Consistent
                document.getElementById('most-consistent').innerHTML = this.fullMonthNames[sp500.mostConsistent.month];
                document.getElementById('most-consistent').className = 'metric-value positive';
                document.getElementById('most-consistent-win').innerHTML = `${sp500.mostConsistent.winRate.toFixed(1)}% Win Rate`;

                // Data Period
                document.getElementById('data-period').innerHTML = `${sp500.summary.years} Years`;
                document.getElementById('data-period').className = 'metric-value neutral';

                // Update year spans
                document.getElementById('sp500-years').textContent = sp500.summary.years;
            }

            renderHeatmap(dataKey, containerId) {
                const data = this.data[dataKey];
                if (!data) return;

                const container = document.getElementById(containerId);
                if (!container) return;

                // Find min/max for color scaling
                const values = data.monthStats.map(m => m.avg);
                const minVal = Math.min(...values);
                const maxVal = Math.max(...values);

                // Create header row
                let html = '<div class="heatmap-row">';
                html += '<div class="heatmap-label"></div>';
                for (let month = 0; month < 12; month++) {
                    html += `<div class="heatmap-header">${this.monthNames[month]}</div>`;
                }
                html += '</div>';

                // Create data row
                html += '<div class="heatmap-row">';
                html += '<div class="heatmap-label">Avg Return</div>';

                for (let month = 0; month < 12; month++) {
                    const stat = data.monthStats.find(m => m.month === month);
                    if (stat) {
                        const color = this.getHeatmapColor(stat.avg, minVal, maxVal);
                        const sign = stat.avg >= 0 ? '+' : '';
                        html += `
                            <div class="heatmap-cell" style="background: ${color}; color: white;"
                                 title="${this.fullMonthNames[month]}: ${sign}${stat.avg.toFixed(2)}% (Win Rate: ${stat.winRate.toFixed(1)}%)">
                                ${sign}${stat.avg.toFixed(1)}%
                            </div>
                        `;
                    } else {
                        html += '<div class="heatmap-cell" style="background: #333;">N/A</div>';
                    }
                }
                html += '</div>';

                container.innerHTML = html;
            }

            getHeatmapColor(value, min, max) {
                // Normalize to 0-1
                const range = max - min;
                const normalized = (value - min) / range;

                if (value < 0) {
                    // Red shades for negative
                    const intensity = Math.abs(value) / Math.abs(min);
                    return `rgba(220, 20, 60, ${0.3 + intensity * 0.7})`;
                } else {
                    // Green shades for positive
                    const intensity = value / max;
                    return `rgba(0, 255, 136, ${0.3 + intensity * 0.7})`;
                }
            }

            renderWinRateBars() {
                const container = document.getElementById('win-rate-bars');
                if (!container || !this.data.sp500) return;

                let html = '';

                // Sort by win rate
                const sorted = [...this.data.sp500.monthStats].sort((a, b) => b.winRate - a.winRate);

                sorted.forEach(stat => {
                    const color = stat.winRate >= 60 ? 'var(--success-color)' :
                                 stat.winRate >= 50 ? 'var(--warning-color)' :
                                 'var(--danger-color)';

                    html += `
                        <div class="probability-bar-item">
                            <div class="probability-bar-label">
                                <span>${this.fullMonthNames[stat.month]}</span>
                                <span>${stat.winRate.toFixed(1)}%</span>
                            </div>
                            <div class="probability-bar-bg">
                                <div class="probability-bar-fill" style="width: ${stat.winRate}%; background: ${color};">
                                    ${stat.winRate.toFixed(1)}% positive
                                </div>
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
            }

            renderCalendarEffects() {
                const container = document.getElementById('calendar-effects');
                if (!container || !this.data.sp500) return;

                const effects = this.calculateCalendarEffects();

                let html = '';

                // January Effect
                html += `
                    <div class="calendar-card">
                        <div class="calendar-card-title">üìà January Effect</div>
                        <div class="calendar-stat">
                            <span class="calendar-stat-label">Average Return</span>
                            <span class="calendar-stat-value ${effects.january.avg >= 0 ? 'positive' : 'negative'}">
                                ${effects.january.avg >= 0 ? '+' : ''}${effects.january.avg.toFixed(2)}%
                            </span>
                        </div>
                        <div class="calendar-stat">
                            <span class="calendar-stat-label">Win Rate</span>
                            <span class="calendar-stat-value">${effects.january.winRate.toFixed(1)}%</span>
                        </div>
                    </div>
                `;

                // Santa Rally (last 5 days of Dec + first 2 days of Jan)
                html += `
                    <div class="calendar-card">
                        <div class="calendar-card-title">üéÖ Santa Rally Period</div>
                        <div class="calendar-stat">
                            <span class="calendar-stat-label">Dec Performance</span>
                            <span class="calendar-stat-value ${effects.december.avg >= 0 ? 'positive' : 'negative'}">
                                ${effects.december.avg >= 0 ? '+' : ''}${effects.december.avg.toFixed(2)}%
                            </span>
                        </div>
                        <div class="calendar-stat">
                            <span class="calendar-stat-label">Historical Strength</span>
                            <span class="calendar-stat-value">${effects.december.winRate.toFixed(1)}% Win Rate</span>
                        </div>
                    </div>
                `;

                // Sell in May
                html += `
                    <div class="calendar-card">
                        <div class="calendar-card-title">üå∏ "Sell in May" Analysis</div>
                        <div class="calendar-stat">
                            <span class="calendar-stat-label">May-Oct Avg</span>
                            <span class="calendar-stat-value ${effects.sellInMay.summerAvg >= 0 ? 'positive' : 'negative'}">
                                ${effects.sellInMay.summerAvg >= 0 ? '+' : ''}${effects.sellInMay.summerAvg.toFixed(2)}%
                            </span>
                        </div>
                        <div class="calendar-stat">
                            <span class="calendar-stat-label">Nov-Apr Avg</span>
                            <span class="calendar-stat-value ${effects.sellInMay.winterAvg >= 0 ? 'positive' : 'negative'}">
                                ${effects.sellInMay.winterAvg >= 0 ? '+' : ''}${effects.sellInMay.winterAvg.toFixed(2)}%
                            </span>
                        </div>
                        <div class="calendar-stat">
                            <span class="calendar-stat-label">Strategy Validity</span>
                            <span class="calendar-stat-value">
                                ${effects.sellInMay.winterAvg > effects.sellInMay.summerAvg ? '‚úì Confirmed' : '‚úó Debunked'}
                            </span>
                        </div>
                    </div>
                `;

                // September Effect
                html += `
                    <div class="calendar-card">
                        <div class="calendar-card-title">üçÇ September Effect</div>
                        <div class="calendar-stat">
                            <span class="calendar-stat-label">Average Return</span>
                            <span class="calendar-stat-value ${effects.september.avg >= 0 ? 'positive' : 'negative'}">
                                ${effects.september.avg >= 0 ? '+' : ''}${effects.september.avg.toFixed(2)}%
                            </span>
                        </div>
                        <div class="calendar-stat">
                            <span class="calendar-stat-label">Worst Month?</span>
                            <span class="calendar-stat-value">
                                ${effects.september.isWorst ? '‚úì Yes' : '‚úó No'}
                            </span>
                        </div>
                    </div>
                `;

                container.innerHTML = html;
            }

            calculateCalendarEffects() {
                const stats = this.data.sp500.monthStats;

                // January
                const january = stats.find(m => m.month === 0);

                // December
                const december = stats.find(m => m.month === 11);

                // September
                const september = stats.find(m => m.month === 8);
                const worstMonth = this.data.sp500.worst;

                // Sell in May (May-Oct vs Nov-Apr)
                const summerMonths = [4, 5, 6, 7, 8, 9]; // May-Oct
                const winterMonths = [10, 11, 0, 1, 2, 3]; // Nov-Apr

                const summerAvg = stats.filter(m => summerMonths.includes(m.month))
                    .reduce((sum, m) => sum + m.avg, 0) / 6;
                const winterAvg = stats.filter(m => winterMonths.includes(m.month))
                    .reduce((sum, m) => sum + m.avg, 0) / 6;

                return {
                    january: january,
                    december: december,
                    september: {
                        ...september,
                        isWorst: september.month === worstMonth.month
                    },
                    sellInMay: {
                        summerAvg: summerAvg,
                        winterAvg: winterAvg
                    }
                };
            }

            renderSectorHeatmap() {
                const container = document.getElementById('sector-heatmap');
                if (!container || !this.data.sectors) return;

                const sectors = Object.keys(this.data.sectors);
                if (sectors.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: var(--text-muted);">Sector data loading...</p>';
                    return;
                }

                // Find global min/max
                let minVal = Infinity;
                let maxVal = -Infinity;
                Object.values(this.data.sectors).forEach(monthData => {
                    monthData.forEach(val => {
                        if (val < minVal) minVal = val;
                        if (val > maxVal) maxVal = val;
                    });
                });

                // Create header
                let html = '<div class="heatmap-row">';
                html += '<div class="heatmap-label"></div>';
                for (let month = 0; month < 12; month++) {
                    html += `<div class="heatmap-header">${this.monthNames[month]}</div>`;
                }
                html += '</div>';

                // Create rows for each sector
                sectors.forEach(sector => {
                    html += '<div class="heatmap-row">';
                    html += `<div class="heatmap-label">${sector}</div>`;

                    const monthData = this.data.sectors[sector];
                    for (let month = 0; month < 12; month++) {
                        const value = monthData[month];
                        const color = this.getHeatmapColor(value, minVal, maxVal);
                        const sign = value >= 0 ? '+' : '';

                        html += `
                            <div class="heatmap-cell" style="background: ${color}; color: white;"
                                 title="${sector} - ${this.fullMonthNames[month]}: ${sign}${value.toFixed(2)}%">
                                ${sign}${value.toFixed(1)}%
                            </div>
                        `;
                    }

                    html += '</div>';
                });

                container.innerHTML = html;
            }

            renderMonthStatsTable() {
                const tbody = document.querySelector('#month-stats-table tbody');
                if (!tbody || !this.data.sp500) return;

                const sorted = [...this.data.sp500.monthStats].sort((a, b) => b.avg - a.avg);

                let html = '';
                sorted.forEach((stat, index) => {
                    const sign = stat.avg >= 0 ? '+' : '';
                    const winRateClass = stat.winRate >= 60 ? 'positive' : stat.winRate >= 50 ? 'neutral' : 'negative';

                    html += `
                        <tr>
                            <td style="font-weight: 700;">${this.fullMonthNames[stat.month]}</td>
                            <td class="${stat.avg >= 0 ? 'positive' : 'negative'}" style="font-weight: 600;">
                                ${sign}${stat.avg.toFixed(2)}%
                            </td>
                            <td class="${winRateClass}">${stat.winRate.toFixed(1)}%</td>
                            <td class="positive">+${stat.bestYear.return.toFixed(2)}% (${stat.bestYear.year})</td>
                            <td class="negative">${stat.worstYear.return.toFixed(2)}% (${stat.worstYear.year})</td>
                            <td>${stat.stdDev.toFixed(2)}%</td>
                            <td>${index + 1} / 12</td>
                        </tr>
                    `;
                });

                tbody.innerHTML = html;
            }
        }

        // Initialize on page load
        const analyzer = new SeasonalityAnalyzer();

        document.addEventListener('DOMContentLoaded', () => {
            analyzer.initialize();
        });
    </script>
</body>
</html>
